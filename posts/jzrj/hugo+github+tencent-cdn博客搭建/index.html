<!doctype html><html lang=zh><meta charset=utf-8><meta name=generator content="Hugo 0.92.1"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name=color-scheme content="light dark">
<meta name=supported-color-schemes content="light dark">
<title>[建站日记] Hugo+Github+Tencent CDN博客搭建&nbsp;&ndash;&nbsp;yibocat</title>
<link rel=stylesheet href=/css/core.min.6e237c6b519f5c1512ac22e534e338ae965c72c80418418cf7b96c716cf8da0582be415e73c648a236baf718efc507d0.css integrity=sha384-biN8a1GfXBUSrCLlNOM4rpZccsgEGEGM97lscWz42gWCvkFec8ZIoja69xjvxQfQ><meta name=twitter:card content="summary">
<meta name=twitter:title content="[建站日记] Hugo+Github+Tencent CDN博客搭建"><body><section id=header>
<div class="header wrap"><span class="header left-side"><a class="site home" href=/><img class="site logo" src=/images/yibo.jpeg alt><span class="site name">yibocat</span></a></span>
<span class="header right-side"><div class="nav wrap">
<nav class=nav><a class="nav item" href=/posts/> 文章 </a><a class="nav item" href=/archives/> 归档 </a><a class="nav item" href=/categories/> 分类 </a><a class="nav item" href=/search/> 搜索 </a><a class="nav item" href></a>
</nav>
</div></span></div><div class="site slogan"><span class=title>cout<<" Hello world! "<< endl;</span></div></section><section id=content><div class=article-container><section class="article header">
<h1 class="article title">[建站日记] Hugo+Github+Tencent CDN博客搭建</h1><p class="article date">2022-01-29
<span class=wordcount>&nbsp;•&nbsp;共&nbsp;3947&nbsp;个字</span><span class=reading-time> • 预计阅读时间 8 分钟</span></p></section><aside id=toc-container class="toc-container wide">
<div class=toc>
<h3>文章目录</h3>
<div class=inner><ul>
<li>
<a href=#%e5%ae%89%e8%a3%85-hugo-%e5%b9%b6%e6%96%b0%e5%bb%ba%e7%ab%99%e7%82%b9 aria-label="安装 Hugo 并新建站点">安装 Hugo 并新建站点</a></li>
<li>
<a href=#%e5%ae%89%e8%a3%85-git aria-label="安装 git">安装 git</a></li>
<li>
<a href=#%e5%88%9d%e5%a7%8b%e5%8c%96-git-%e5%ad%98%e5%82%a8%e5%ba%93%e5%ae%89%e8%a3%85%e4%b8%bb%e9%a2%98%e8%bf%9b%e8%a1%8c%e9%85%8d%e7%bd%ae aria-label="初始化 git 存储库，安装主题进行配置">初始化 git 存储库，安装主题进行配置</a></li>
<li>
<a href=#%e7%94%9f%e6%88%90%e7%ab%99%e7%82%b9%e5%b9%b6%e5%8f%91%e5%b8%83 aria-label=生成站点并发布>生成站点并发布</a></li>
<li>
<a href=#%e6%89%98%e7%ae%a1%e5%88%b0-github aria-label="托管到 Github">托管到 Github</a></li>
<li>
<a href=#github-action-%e8%87%aa%e5%8a%a8%e9%83%a8%e7%bd%b2%e5%b9%b6%e5%8f%91%e5%b8%83 aria-label="Github Action 自动部署并发布">Github Action 自动部署并发布</a></li>
<li>
<a href=#%e5%9f%9f%e5%90%8d%e8%ae%be%e7%bd%ae aria-label=域名设置>域名设置</a><ul>
<ul>
<li>
<a href=#%e5%9f%9f%e5%90%8d%e8%87%aa%e5%8a%a8%e6%9b%b4%e6%96%b0%e9%97%ae%e9%a2%98 aria-label=域名自动更新问题>域名自动更新问题</a></li></ul>
</ul>
</li>
<li>
<a href=#cdn-%e9%9d%99%e6%80%81%e7%bd%91%e9%a1%b5%e5%8a%a0%e9%80%9f aria-label="CDN 静态网页加速">CDN 静态网页加速</a><ul>
<ul>
<li>
<a href=#%e6%b3%a8%e6%84%8f aria-label=注意>注意</a></li></ul>
</ul>
</li>
<li>
<a href=#%e6%80%bb%e7%bb%93%e4%b8%8e%e5%85%b6%e4%bb%96 aria-label=总结与其他>总结与其他</a></li>
<li>
<a href=#%e5%8f%82%e8%80%83 aria-label=参考>参考</a>
</li>
</ul>
</div>
</div>
</aside>
<article class="article markdown-body"><div><p>最近花费了近一周搭建自己的网站，准确的说是静态网页。这是网站的第一篇文章，也可以说是近一周来搭建个人博客的踩坑总结。</p>
<p>网站采用的是 hugo 框架，只是因为 hugo 号称是 &ldquo;The world’s fastest framework for building websites&rdquo;，而其特点就在于轻。因为静态网页无需加载太多插件（wordpress 太重了）， 不需要访问数据库，不需要编写太多的网站功能，并且静态网页使用的是纯 html，对于博客系统来说是完全足够了，这也是我放弃 wordpress 的原因。另外一个原因是 wordpress 虽然拥有各种各样眼花缭乱的插件，但是其维护麻烦，不光 wordpress 本身需要版本更新，插件也需要更新，并且更新起来很艰难，常常自动更新失败从而转为手工更新。并且wordpress 很多主题插件是收费的。</p>
<p>使用 hugo 搭建个人博客网站，其实理论上来说 hugo 不止可以搭建博客，还可以搭建任何静态网站（甚至是动态网站，不过这也就失去了 hugo 本身的意义了）。而且还有一个更主要的原因：可以学习 git 和 Github。</p>
<p>hugo 搭建好之后需要进行部署。通常的做法是托管到 Github Pages，也可以部署在腾讯云的静态网页托管（阿里云也有相同的业务），活或者 Gitee Pages，或者自建服务器等等。所以本文从一开始 hugo 与 git 的安装到最后 CDN 网页加速全过程进行总结。</p>
<h3 id=安装-hugo-并新建站点>安装 Hugo 并新建站点</h3>
<p>Mac OS 下安装 Hugo 非常方便</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>$ brew install hugo
</code></pre></div><p>查看版本是否安装正确</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>$ hugo version
hugo v0.86.1+extended darwin/amd64 <span class=nv>BuildDate</span><span class=o>=</span>unknown
</code></pre></div><p>Hugo 安装好之后，就可以创建站点了</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>$ hugo new site myfirsthugo
Congratulations! Your new Hugo site is created in /Users/your_name_path/myfirsthugo.

Just a few more steps and you<span class=err>&#39;</span>re ready to go:

1. Download a theme into the same-named folder.
   Choose a theme from https://themes.gohugo.io/ or
   create your own with the <span class=s2>&#34;hugo new theme &lt;THEMENAME&gt;&#34;</span> command.
2. Perhaps you want to add some content. You can add single files
   with <span class=s2>&#34;hugo new &lt;SECTIONNAME&gt;/&lt;FILENAME&gt;.&lt;FORMAT&gt;&#34;</span>.
3. Start the built-in live server via <span class=s2>&#34;hugo server&#34;</span>.

Visit https://gohugo.io/ <span class=k>for</span> quickstart guide and full documentation.
</code></pre></div><p>进入站点目录，然后查看目录下包含的文件</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>$ <span class=nb>cd</span> myfirsthugo
$ ls -l
archetypes	content		layouts		themes
config.toml	data		static
</code></pre></div><p>这里可以看到 Hugo 自动生成了一堆文件，这些文件也就是 Hugo 站点的结构。</p>
<p>archetypes：站点要发表的文章的文章模板，在 Hugo官网上称为模板的 <code>Front Matter</code>；</p>
<p>content：发布的文章在这个目录下生成；</p>
<p>layouts：Hugo 站点的布局结构，即 html 布局都要在这个文件夹中编写；</p>
<p>themes：站点主题；</p>
<p>config.toml：站点配置；</p>
<p>data：存放站点的一些数据文件；</p>
<p>static：静态文件则保存在这个文件夹中。</p>
<h3 id=安装-git>安装 git</h3>
<p>git 的安装可以从官方网站上直接下载安装： Mac OS <a href=https://git-scm.com/download/mac target=_blank rel="noopener noreferrer">https://git-scm.com/download/mac</a>
或者 Windows <a href=https://git-scm.com/download/win target=_blank rel="noopener noreferrer">https://git-scm.com/download/win</a>
</p>
<p>Mac OS 也可以直接终端运行</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>$ brew install git
</code></pre></div><p>安装好之后查看 git 版本</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>$ git --version
git version 2.32.0 <span class=o>(</span>Apple Git-132<span class=o>)</span>
</code></pre></div><h3 id=初始化-git-存储库安装主题进行配置>初始化 git 存储库，安装主题进行配置</h3>
<p>Hugo 建站有两种 Github 托管方式，一种先是直接 git 初始化站点目录，在托管部署时直接将整个目录上传至 Github，这种方法可以很方便的在终端下载安装主题；第二种是先从 Github 上下载好主题并安装，然后运行 Hugo 终端命令 <code>hugo</code> 生成 public 文件夹，进入 public 并 git 初始化，然后将 public 托管部署到 Github 上。推荐使用第一种方法，以下文章也是采用第一种方法。</p>
<p>在 Hugo 站点目录下，进行 git 初始化</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>myfirsthugo $ git init
</code></pre></div><p>然后下载主题，可以从 git 命令 <code>clone</code> 一个主题，也可以从 Github 直接下载，将下载好的主题解压并放在 themes 文件夹中。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>myfirsthugo $ git submodule add https://Github.com/budparr/gohugo-theme-ananke.git themes/ananke
</code></pre></div><p>下载好的 anake 主题直接放在了 themes 文件夹中，但是主题还并不能加载使用，需要在配置文件中进行主题配置。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>myfirsthugo $ <span class=nb>echo</span> <span class=nv>theme</span> <span class=o>=</span> <span class=se>\&#34;</span>ananke<span class=se>\&#34;</span> &gt;&gt; config.toml
</code></pre></div><p>或者直接打开 <code>config.toml</code> 在最后一行添加一句：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=nx>baseURL</span> <span class=p>=</span> <span class=s2>&#34;http://example.org/&#34;</span>
<span class=nx>languageCode</span> <span class=p>=</span> <span class=s2>&#34;en-us&#34;</span>
<span class=nx>title</span> <span class=p>=</span> <span class=s2>&#34;My New Hugo Site&#34;</span>
<span class=nx>theme</span> <span class=p>=</span> <span class=s2>&#34;ananke&#34;</span>
</code></pre></div><p>然后可以新建一个 post 文章</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>myfirsthugo $ hugo new posts/my-first-post.md
/Users/your_name_path/myfirsthugo/content/posts/my-first-post.md created
</code></pre></div><p>这时可以看到在 content 文件夹中自动创建了一个 posts 文件夹，并且生成了 <code>my-first-post</code> 文章。</p>
<p>启动 Hugo server</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>myfirsthugo $ hugo server -D
Start building sites … 
hugo v0.86.1+extended darwin/amd64 <span class=nv>BuildDate</span><span class=o>=</span>unknown

                   <span class=p>|</span> EN  
-------------------+-----
  Pages            <span class=p>|</span> <span class=m>10</span>  
  Paginator pages  <span class=p>|</span>  <span class=m>0</span>  
  Non-page files   <span class=p>|</span>  <span class=m>0</span>  
  Static files     <span class=p>|</span>  <span class=m>1</span>  
  Processed images <span class=p>|</span>  <span class=m>0</span>  
  Aliases          <span class=p>|</span>  <span class=m>1</span>  
  Sitemaps         <span class=p>|</span>  <span class=m>1</span>  
  Cleaned          <span class=p>|</span>  <span class=m>0</span>  

Built in <span class=m>72</span> ms
Watching <span class=k>for</span> changes in /Users/your_name_path/myfirsthugo/<span class=o>{</span>archetypes,content,data,layouts,static,themes<span class=o>}</span>
Watching <span class=k>for</span> config changes in /Users/your_name_path/myfirsthugo/config.toml, /Users/your_name_path/myfirsthugo/themes/ananke/config.yaml
Environment: <span class=s2>&#34;development&#34;</span>
Serving pages from memory
Running in Fast Render Mode. For full rebuilds on change: hugo server --disableFastRender
Web Server is available at http://localhost:1313/ <span class=o>(</span><span class=nb>bind</span> address 127.0.0.1<span class=o>)</span>
</code></pre></div><p>此时在浏览器上打开 <code>http://localhost:1313/</code> 就可以直接访问了。</p>
<img src=/images/jzrj/jzrj-20220129-1.png alt=jzrj-2022129-1 style=zoom:50%>
<h3 id=生成站点并发布>生成站点并发布</h3>
<p>以上步骤只是表示网站可以正常运行了，并不意味着这就是 Hugo 要发布的站点。还要通过 hugo 命令发布站点。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>myfirsthugo $ hugo -D
Start building sites … 
hugo v0.86.1+extended darwin/amd64 <span class=nv>BuildDate</span><span class=o>=</span>unknown

                   <span class=p>|</span> EN  
-------------------+-----
  Pages            <span class=p>|</span> <span class=m>10</span>  
  Paginator pages  <span class=p>|</span>  <span class=m>0</span>  
  Non-page files   <span class=p>|</span>  <span class=m>0</span>  
  Static files     <span class=p>|</span>  <span class=m>1</span>  
  Processed images <span class=p>|</span>  <span class=m>0</span>  
  Aliases          <span class=p>|</span>  <span class=m>1</span>  
  Sitemaps         <span class=p>|</span>  <span class=m>1</span>  
  Cleaned          <span class=p>|</span>  <span class=m>0</span>  

Total in <span class=m>102</span> ms
</code></pre></div><p>注意：这里 <code>-D</code> 表示以草稿（draft）形式发布站点，所有的草稿文章都会显示。</p>
<p>这时就会在站点目录下生成一个 public 文件夹</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>myfirsthugo $ ls
archetypes	content		layouts		resources	themes
config.toml	data		public		static
</code></pre></div><p>所有要发布的内容都保存在 public 文件夹中，也就是说，站点呈现的所有内容都已经保存在 public 中了，此时可以将 public 托管到 Github。</p>
<blockquote>
<p>注意：Github Pages 可以使用 Github Action 自动部署并发布，这意味着并不需要运行 <code>hugo</code> 命令生成 public，我们可以将生成 public 的过程直接部署在 Github 自动发布上。所以可以直接删除掉 public 文件夹，并且在日常浏览中直接使用 <code>hugo server -D</code> 命令就可以了。</p>
</blockquote>
<h3 id=托管到-github>托管到 Github</h3>
<p>浏览器打开网址可以访问，说明网站已经可以正常运行了，但是还需要托管到 Github 上才能进行随时访问。</p>
<p>Github Pages 是 Github 官方的博客发布系统，其项目名称需要遵循 <code>username.github.io</code> 形式。在 Github 上新建一个存储库，任何选项都不要勾选，注意：repository name 要和 Owner 名称相同。如下所示</p>
<img src=/images/jzrj/jzrj-20220129-2.png alt=jzrj-20220129-2 style=zoom:50%>
<p>点击 <code>create repository</code> 创建存储库，会看到这样的界面</p>
<img src=/images/jzrj/jzrj-20220129-3.png alt=jzrj-20220129-2 style=zoom:50%>
<p>因为之前已经初始化过站点 git 库了，所以只要将远程库的地址加进来就可以了，此时的 Github 库是一个空库。上图中已经告诉了基本步骤，先在本地站点目录创建一个 README.md 文件</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>$ <span class=nb>echo</span> <span class=s2>&#34;# accoppo.github.io&#34;</span> &gt;&gt; README.md
</code></pre></div><p>然后创建 <code>master</code> 分支并提交</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>$ git add .
$ git commit -m <span class=s2>&#34;first commit&#34;</span>
$ git branch -M master
$ git remote add origin git@github.com:accoppo/accoppo.github.io.git
</code></pre></div><p>然后 <code>push</code> 上去</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>$ git push -u origin master
</code></pre></div><p><code>-u</code> 表示库为空，需要整体提交，之后就可以使用 <code>git push</code> 直接 <code>push</code> 了。</p>
<p>注意：在进行提交推送之前，需要先在 Github 账户设置中新增 SSH 秘钥。</p>
<p>然后回到 Github 库中，就可以看到所有内容推送上来了。对于 <code>xxx.github.io</code> 这样的项目库名称，Github 直接认定是采用 GIthub Pages 发布的，所以在浏览器直接输入 <code>accoppo.github.io</code> 也是可以显示内容的，只不过显示的 README.md 中的内容。</p>
<h3 id=github-action-自动部署并发布>Github Action 自动部署并发布</h3>
<p>Action 是 Github 提供的仓库中自动化、自定义和执行软件开发工作流程。</p>
<p>官方网站 <a href=https://docs.github.com/cn/actions target=_blank rel="noopener noreferrer">https://docs.github.com/cn/actions</a>
</p>
<p>Hugo + Github Action 可以参考 <a href=https://gohugo.io/hosting-and-deployment/hosting-on-github/#build-hugo-with-github-action target=_blank rel="noopener noreferrer">https://gohugo.io/hosting-and-deployment/hosting-on-github/#build-hugo-with-github-action</a>
</p>
<p>官方提供了一个 yml 文件，文件存在<code>.github/workflows/gh-pages.yml</code> 里，在项目库中选择 Action 并点击 <code>new workflow</code></p>
<img src=/images/jzrj/jzrj-20220129-4.png alt=jzrj-20220129-2 style=zoom:50%>
<p>然后点击 <code>set up a workflow yourself</code></p>
<img src=/images/jzrj/jzrj-20220129-5.png alt=jzrj-20220129-2 style=zoom:50%>
<p>然后进入到工作流文件设置中，将 <code>main.yml</code> 更改为 <code>gh-pages.yml</code> ，然后将下面代码复制到 <code>Edit new file</code> 中</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>github pages</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=l>master </span><span class=w> </span><span class=c># Set a branch to deploy</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-18.04</span><span class=w>
</span><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v2</span><span class=w>
</span><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>submodules</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>  </span><span class=c># Fetch Hugo themes (true OR recursive)</span><span class=w>
</span><span class=w>          </span><span class=nt>fetch-depth</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>    </span><span class=c># Fetch all history for .GitInfo and .Lastmod</span><span class=w>
</span><span class=w>
</span><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Setup Hugo</span><span class=w>
</span><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>peaceiris/actions-hugo@v2</span><span class=w>
</span><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>hugo-version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;latest&#39;</span><span class=w>
</span><span class=w>          </span><span class=c># extended: true</span><span class=w>
</span><span class=w>
</span><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build</span><span class=w>
</span><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>hugo --minify</span><span class=w>
</span><span class=w>
</span><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deploy</span><span class=w>
</span><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>peaceiris/actions-gh-pages@v3</span><span class=w>
</span><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>github_token</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.GITHUB_TOKEN }}</span><span class=w>
</span><span class=w>          </span><span class=nt>publish_dir</span><span class=p>:</span><span class=w> </span><span class=l>./public</span><span class=w>
</span></code></pre></div><p>如下所示</p>
<img src=/images/jzrj/jzrj-20220129-6.png alt=jzrj-20220129-2 style=zoom:50%>
<p>然后 <code>Start commit</code> <code>Commit new file</code> ，</p>
<img src=/images/jzrj/jzrj-20220129-7.png alt=jzrj-20220129-2 style=zoom:50%>
<p>回到 Action 会触发一次构建发布任务，等待几分钟左侧圆圈变成✅</p>
<img src=/images/jzrj/jzrj-20220129-8.png alt=jzrj-20220129-2 style=zoom:50%>
<p>以上任务完成以后，回到 <code>Code</code> ，并没有看到 public 目录，但是会发现多了一条分支，新增加的这条分支就是 Github Pages 要发布的内容</p>
<img src=/images/jzrj/jzrj-20220129-9.png alt=jzrj-20220129-2 style=zoom:50%>
<p>然后回到 Setting 的 Pages 选项里将发布源改成 <code>gh-pages.yml</code></p>
<img src=/images/jzrj/jzrj-20220129-10.png alt=jzrj-20220129-2 style=zoom:50%>
<p>等待几分钟就可以在浏览器中查看了。</p>
<p>在发布的站点网页中，并没有看到发布的文章，这是因为在文章的 <code>Front Matter</code> 设置中将 Draft 设置成了 true，这表示文章现在是草稿形式，并没有发布。</p>
<p>而且因为远程库中的内容已经发生变化，所以先从远程将项目库 <code>pull</code> 下来</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>myfirsthugo $ git pull
</code></pre></div><p>然后查看所有分支会发现多出来一条分支 <code>gh-pages</code></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>$ git branch -a
* master
  remotes/origin/gh-pages
  remotes/origin/master
</code></pre></div><p>修改发布文章的 <code>Front Matter</code> 的 Draft 选项，并且在 <code>config.toml</code> 中将 <code>baseURL</code> 修改成 <code>xxx.github.io</code> ,再 <code>push </code> 到 Github</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=nx>baseURL</span> <span class=p>=</span> <span class=s2>&#34;http://xxx.github.io&#34;</span>
<span class=nx>languageCode</span> <span class=p>=</span> <span class=s2>&#34;en-us&#34;</span>
<span class=nx>title</span> <span class=p>=</span> <span class=s2>&#34;My New Hugo Site&#34;</span>
<span class=nx>theme</span> <span class=p>=</span> <span class=s2>&#34;ananke&#34;</span>
</code></pre></div><p>最后就可以正常访问了。</p>
<h3 id=域名设置>域名设置</h3>
<p>Github Pages 支持设置自定义域名，如下图所示 <code>custom domain </code> 可以设置自定义域名</p>
<img src=/images/jzrj/jzrj-20220129-10.png alt=jzrj-20220129-2 style=zoom:50%>
<p>首先在任意的域名注册商那里注册一个域名，腾讯云域名注册链接 <a href=https://buy.cloud.tencent.com/domain target=_blank rel="noopener noreferrer">https://buy.cloud.tencent.com/domain</a>
，或者进入网站 <a href=https://www.dnspod.cn target=_blank rel="noopener noreferrer">https://www.dnspod.cn</a>
进行域名注册，然后进行备案。</p>
<p>等待备案好之后进入 <code>DNSPod</code> 云解析控制台 <a href=https://www.dnspod.cn target=_blank rel="noopener noreferrer">https://www.dnspod.cn</a>
，可以看到域名已经添加到我的域名中，然后要做的是对域名添加解析，点击域名，进入我的域名管理，点击快速添加解析</p>
<img src=/images/jzrj/jzrj-20220129-11.png alt=jzrj-20220129-2 style=zoom:50%>
<p>然后将 <code>xxx.github.io</code> 添加到域名映射CNAME 中，点击确认，就会自动生成四条记录。</p>
<p>回到 GIthub 站点项目库的 <code>setting pages</code> ，将新的域名填入自定义域名框中</p>
<img src=/images/jzrj/jzrj-20220129-12.png alt=jzrj-20220129-2 style=zoom:50%>
<p>等待几分钟，就可以使用自定义域名访问站点了。</p>
<h5 id=域名自动更新问题>域名自动更新问题</h5>
<p>每次将站点 <code>push</code> 到 Github 并进行 Action 自动发布时，自定义域名总是会丢失，导致每 <code>push</code> 一次，就要手动设置一次域名，很是麻烦。后来查阅资料才知道，Github Action 将项目库主分支进行自动部署时，总是重新部署，这使得我们设置好的域名总会刷新掉。解决办法是在本地站点目录的 <code>static</code> 目录下创建一个 CNAME 文件（注意：没有后缀），写入自定义域名</p>
<img src=/images/jzrj/jzrj-20220129-13.png alt=jzrj-20220129-2 style=zoom:50%>
<p>这样，在每次 Action 自动发布时，<code>static</code> 目录下的文件会部署到发布目录（即 public目录下）的根目录下，每次进行 <code>push </code> 就不会丢失自定义域名了。</p>
<h3 id=cdn-静态网页加速>CDN 静态网页加速</h3>
<p>由于 Github 服务器位于国外，所以访问加载时间是非常长的，这反而失去了静态网页的特点。所以我们可以通过 CDN 内容分发网络对我们的网站进行加速，实现快速访问。</p>
<p>不管是腾讯云还是阿里云或者其他 CDN 服务商，都是一样的流程。我们进入腾讯云 CDN 内容分发网络控制台，进入域名管理，然后添加域名进行域名配置</p>
<img src=/images/jzrj/jzrj-20220129-14.png alt=jzrj-20220129-2 style=zoom:50%>
<p>然后进行源站配置，注意：源站配置的回源协议再没有设置 SSL 时选择 HTTP，腾讯云有一年的免费 SSL ，等配置完 SSL 修改源站协议即可。</p>
<img src=/images/jzrj/jzrj-20220129-15.png alt=jzrj-20220129-2 style=zoom:50%>
<p>提交等待几分钟后，需要将生成的加速域名 CNAME 覆盖到 DNSPod 记录管理的 @ 主机记录，这个步骤一般腾讯云会自动替换。</p>
<img src=/images/jzrj/jzrj-20220129-16.png alt=jzrj-20220129-2 style=zoom:50%>
<p>等待 CDN 部署几分钟后，就可以流畅的浏览自己的博客了。</p>
<img src=/images/jzrj/jzrj-20220129-17.png alt=jzrj-20220129-2 style=zoom:50%>
<h5 id=注意>注意</h5>
<p>CDN 静态网页加速以后，虽然网页浏览速度加快，但是更新缓存资源是延后的，这样造成的后果是发表一篇文章，却不能即时在客户端浏览器看到。幸运的是，在腾讯云的 CDN控制台是有刷新预热功能的，也就是说当网站的源站有资源更新、需要清理违规资源、域名有配置变更的，为避免全网用户受节点缓存影响仍访问到旧的资源、受旧配置的影响，可提交刷新任务，保证全网用户可访问到最新资源或正常访问。</p>
<p>这里有三种刷新预热方法</p>
<img src=/images/jzrj/jzrj-20220129-18.png alt=jzrj-20220129-2 style=zoom:50%>
<blockquote>
<p>URL 刷新：表示某一个网页例如主页有信息变化时，通常使用 URL 刷新</p>
<p>目录刷新：网站目录下的信息刷新，例如列表、Hugo 的 Posts 目录等</p>
<p>URL 预热：当有安装包或者升级包发布时，常采用 URL 预热</p>
</blockquote>
<p>虽然刷新暂时解决了网页最新的浏览，但是每次手动刷新依然很麻烦。</p>
<p>很幸运，腾讯云的 CDN 控制台的插件中心中有一项功能是定时刷新预热</p>
<img src=/images/jzrj/jzrj-20220129-19.png alt=jzrj-20220129-2 style=zoom:50%>
<p>我们可以设置一定的时间或者时间间隔进行自动刷新，避免了每次手动刷新的麻烦。</p>
<h3 id=总结与其他>总结与其他</h3>
<ol>
<li>添加网页后台统计分析，当前的流形的统计平台包括百度统计、友盟+、腾讯统计等等，都是很不错的。</li>
<li>通过学习 Hugo 的结构，我们不难发现 Hugo 是比较简单的，通过布局嵌套，Hugo 最后部署会将所有的嵌套结构合并成一个网站，这从理论上来说 Hugo 可以搭建任何的网站或者是系统。</li>
<li>有时间有机会了可以自己写一个主题。</li>
</ol>
<h3 id=参考>参考</h3>
<ol>
<li><a href=https://zhuanlan.zhihu.com/p/350977057 target=_blank rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/350977057</a>
</li>
<li><a href=https://gohugo.io/documentation/ target=_blank rel="noopener noreferrer">https://gohugo.io/documentation/</a>
</li>
<li><a href=https://docs.github.com/cn target=_blank rel="noopener noreferrer">https://docs.github.com/cn</a>
</li>
<li><a href=https://docs.github.com/cn/pages target=_blank rel="noopener noreferrer">https://docs.github.com/cn/pages</a>
</li>
</ol></div>
</article><section class="article labels"><a class=category href=/categories/%E5%BB%BA%E7%AB%99%E6%97%A5%E8%AE%B0/>建站日记</a><a class=tag href=/tags/hugo/>Hugo</a><a class=tag href=/tags/github/>Github</a><a class=tag href=/tags/%E5%8D%9A%E5%AE%A2/>博客</a></section><section class="article license">版权声明：如果转发请带上本文链接和注明来源。</section><section class="article author">
<script src=https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js></script>
<lottie-player class=avatar src=/json/77907-vault.json background=transparent speed=1 style=max-width:280px; loop autoplay></lottie-player><p class=name>yibocat</p><div class=bio>脑子不够键盘来凑</div><div class=details><a class=item href=https://github.com/yibocat target=_blank rel="noopener noreferrer"><span class="iconfont icon-github"></span>&nbsp;yibocat</a><a class=item href=mailto:yibocat@yeah.net target=_blank rel="noopener noreferrer"><span class="iconfont icon-mail"></span>&nbsp;yibocat@yeah.net</a></div>
</section>
</div>
<div class="article bottom">
<div class="article bottom title">更多文章</div><section class="article navigation"><p><a class=link href=/posts/jzrj/hugo%E4%BB%A3%E7%A0%81%E6%8B%B7%E8%B4%9D%E6%8F%92%E4%BB%B6/><span class="iconfont icon-article"></span>[建站日记] Hugo代码拷贝插件</a></p><p><a class=link href=/posts/cdn-%E5%88%B7%E6%96%B0%E5%88%97%E8%A1%A8/><span class="iconfont icon-article"></span>CDN 刷新列表</a></p></section><div class=nav-bottom><div class="nav wrap bottom">
<nav class=nav><a class="nav item" href=/posts/> 文章 </a><a class="nav item" href=/archives/> 归档 </a><a class="nav item" href=/categories/> 分类 </a><a class="nav item" href=/search/> 搜索 </a>
</nav>
</div></div></div></section><section id=footer><div class=footer-wrap>
<p class=copyright>©2022 Yibocat.</p>
<p class=powerby>
<span>Powered&nbsp;by&nbsp;</span><a href=https://gohugo.io target=_blank rel="noopener noreferrer">Hugo</a>
<span>&nbsp;Accelerate with Tencent Cloud CDN.</span>
<a href="https://ipv6-test.com/validate.php?url=referer"><img src=https://ipv6-test.com/button-ipv6-80x15.png alt="ipv6 ready" title="ipv6 ready" border=0></a>
</p><p style=font-size:12px><a href=http://beian.miit.gov.cn/ target=_blank rel="noopener noreferrer">陇ICP备2021003237号-1</a></p></div></section><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:'$$',right:'$$',display:!0},{left:'$',right:'$',display:!1},{left:'\\(',right:'\\)',display:!1},{left:'\\[',right:'\\]',display:!0}],throwOnError:!1})})</script><script src=/js/core.min.45bc6f7686a5f99de05699008e2608053161016a4ce37a6b899e6fd78870c210a3239372eaedcb90385626ad3dafe267.js integrity=sha384-Rbxvdoal+Z3gVpkAjiYIBTFhAWpM43priZ5v14hwwhCjI5Ny6u3LkDhWJq09r+Jn></script></body>
</html>