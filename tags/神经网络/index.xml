<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>ç¥ç»ç½‘ç»œ on Yibocat</title><link>https://yibocat.github.io/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/</link><description>Recent content in ç¥ç»ç½‘ç»œ on Yibocat</description><generator>Hugo -- gohugo.io</generator><copyright>Â©2022 Yibocat.</copyright><lastBuildDate>Thu, 17 Feb 2022 21:48:32 +0800</lastBuildDate><atom:link href="https://yibocat.github.io/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/index.xml" rel="self" type="application/rss+xml"/><item><title>[å»ºç«™æ—¥è®°] Hugo æ·»åŠ æ–‡ç« æ—¥æœŸçƒ­åŠ›å›¾</title><link>https://yibocat.github.io/posts/jzrj/jzrj_4/</link><pubDate>Fri, 25 Feb 2022 20:11:23 +0800</pubDate><guid>https://yibocat.github.io/posts/jzrj/jzrj_4/</guid><description>&lt;p>æ¯æ¬¡çœ‹åˆ° Github ä¸Šçš„ä»£ç è´¡çŒ®å›¾æ—¶ï¼Œæ€»æƒ³è‡ªå·±æä¸€ä¸ªã€‚ä½†æ˜¯ç›´æ¥æä¼¼ä¹å¾ˆéº»çƒ¦ï¼Œäºæ˜¯ä¸Šç½‘ä¸€æœï¼Œå˜¿ï¼Œæœ‰ä¸¤ä¸ªå¼€æºå›¾è¡¨åº“æ­£å¥½æ»¡è¶³æˆ‘çš„éœ€æ±‚ï¼Œæœæ–­å¼€æã€‚&lt;/p>
&lt;p>è¿™ä¸¤ä¸ªå›¾å›¾è¡¨åº“å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>èš‚èšæ•°æ®å¯è§†åŒ– AntV &lt;a href="https://antv-2018.alipay.com/zh-cn/index.html"target="_blank" rel="noopener noreferrer">https://antv-2018.alipay.com/zh-cn/index.html&lt;/a>
&lt;/p>
&lt;p>Apache ECharts &lt;a href="https://echarts.apache.org/zh/index.html"target="_blank" rel="noopener noreferrer">https://echarts.apache.org/zh/index.html&lt;/a>
&lt;/p>
&lt;p>è¿™ä¸¤ä¸ªéƒ½æ˜¯éå¸¸å¥½çš„å›¾è¡¨åº“ï¼Œè€Œæˆ‘ä½¿ç”¨çš„ EChartsï¼ˆåªæ˜¯å› ä¸ºç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„æ˜¯ EChartsï¼‰ã€‚ä¸è¿‡æœ‰ä¸€äº›åŠŸèƒ½è¿˜æ˜¯æ²¡èƒ½å®ç°ï¼Œæœ‰æœºä¼šå°è¯•ç”¨ AntV å†å®ç°ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>æ”¹é€ åæœ€åçš„æ•ˆæœå›¾å¦‚ä¸‹&lt;/p>
&lt;p style="text-align:center">&lt;img src="https://yibocat.github.io/images/jzrj/jzrj-20220225-01.png" style="width:80%" />&lt;/p>
&lt;/br>
&lt;h3 id="è·å–">è·å–&lt;/h3>
&lt;p>ECharts å®˜æ–¹ç»™çš„å®‰è£…æ–¹å¼æœ‰ä¸‰ç§ï¼š Github è·å–ã€npm å®‰è£…å’Œ CDN è·å–ï¼Œå®˜æ–¹å»ºè®®ä½¿ç”¨ npm å®‰è£…ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨ CDN è·å–ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;https://cdn.jsdelivr.net/npm/echarts@5.3.0/dist/echarts.min.js&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è€Œä¸‹è½½ç½‘å€æ˜¯åœ¨ &lt;a href="https://www.jsdelivr.com/package/npm/echarts"target="_blank" rel="noopener noreferrer">https://www.jsdelivr.com/package/npm/echarts&lt;/a>
ã€‚&lt;/p>
&lt;p>npm ä¸‹è½½å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">npm install echarts --save
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦å¤–ï¼Œå®˜ç½‘è¿˜æä¾›åœ¨çº¿æ„å»ºï¼Œå…·ä½“å¯ä»¥å‰å¾€ &lt;a href="https://echarts.apache.org/zh/builder.html"target="_blank" rel="noopener noreferrer">https://echarts.apache.org/zh/builder.html&lt;/a>
ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="é…ç½®æ–‡ç« æ•°æ®">é…ç½®æ–‡ç« æ•°æ®&lt;/h3>
&lt;p>é¦–å…ˆé…ç½®ç”Ÿæˆçƒ­åŠ›å›¾çš„æ¨¡å—&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;heatmap&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åç¼–å†™ javascript è„šæœ¬ã€‚&lt;/p>
&lt;p>åˆå§‹åŒ–å›¾æ ‡å¹¶ç»‘å®šåˆ°çƒ­åŠ›å›¾æ¨¡å—ï¼Œå¹¶è®¾å®šå›¾è¡¨å“åº”å®¹å™¨çš„å¤§å°å˜åŒ–&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="kd">var&lt;/span> &lt;span class="nx">myChart&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">echarts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">init&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getElementById&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;heatmap&amp;#39;&lt;/span>&lt;span class="p">));&lt;/span>
&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">onresize&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">myChart&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">resize&lt;/span>&lt;span class="p">();&lt;/span>
&lt;span class="p">};&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;h3 id="ç”Ÿæˆæ–‡ç« æ•°æ®">ç”Ÿæˆæ–‡ç« æ•°æ®&lt;/h3>
&lt;p>ç”Ÿæˆçƒ­åŠ›å›¾çš„ option ç»“æ„åœ¨ &lt;a href="https://echarts.apache.org/zh/option.html#calendar"target="_blank" rel="noopener noreferrer">https://echarts.apache.org/zh/option.html#calendar&lt;/a>
ã€‚è¿™é‡Œæˆ‘ä»¬ä¸»è¦è¦è§£å†³çš„æ˜¯ä¸¤ä¸ªé—®é¢˜ï¼š&lt;/p>
&lt;blockquote>
&lt;p>1.å¦‚ä½•å°†æ—¥å†çš„æ—¥æœŸè®¾ç½®ä¸ºå»å¹´ä»Šæ—¥åˆ°ä»Šæ—¥æ—¥æœŸåŒºé—´&lt;/p>
&lt;p>2.å°†æ–‡ç« çš„æ—¥æœŸå’Œå­—æ•°ä¼ å…¥ ECharts&lt;/p>
&lt;/blockquote>
&lt;p>æ—¥å†æ—¶é—´åœ¨ &lt;code>series&lt;/code> çš„ &lt;code>data&lt;/code> ä¸­è®¾ç½®ï¼Œæ”¯æŒ &lt;code>data([day,number])&lt;/code> çš„åˆ—è¡¨å½¢å¼ï¼Œæˆ‘ä»¬çš„ç›®çš„åˆ™æ˜¯å°†æ‰€æœ‰å‘å¸ƒçš„æ–‡ç« çš„æ•°å­—ä½œç»Ÿè®¡ï¼Œç„¶åä¼ å…¥åˆ—è¡¨ &lt;code>data&lt;/code> ä¸­ã€‚&lt;/p>
&lt;p>å¥½æ¶ˆæ¯æ˜¯ Hugo æ”¯æŒåœ¨ &lt;code>html&lt;/code> ä¸­å†™å…¥ä»£ç ï¼Œéšå Hugo ä¼šè‡ªåŠ¨å¯¹å…¶è¿›è¡Œç¼–ç ã€‚æ¥ç€ä¸Šé¢ä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="kd">var&lt;/span> &lt;span class="nx">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[];&lt;/span>
&lt;span class="p">{{&lt;/span> &lt;span class="nx">range&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Site&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">RegularPages&lt;/span> &lt;span class="p">}}&lt;/span>
&lt;span class="nx">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">push&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="p">[&lt;/span>
&lt;span class="p">{{&lt;/span> &lt;span class="p">.&lt;/span>&lt;span class="nx">PublishDate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Format&lt;/span> &lt;span class="s2">&amp;#34;2006-01-02&amp;#34;&lt;/span> &lt;span class="p">}},&lt;/span>
&lt;span class="p">{{&lt;/span> &lt;span class="p">.&lt;/span>&lt;span class="nx">WordCount&lt;/span> &lt;span class="p">}},&lt;/span>
&lt;span class="p">],&lt;/span>
&lt;span class="p">);&lt;/span>
&lt;span class="p">{{&lt;/span>&lt;span class="o">-&lt;/span> &lt;span class="nx">end&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="p">}}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œæˆ‘ä»¬å°†æ‰€æœ‰å‘å¸ƒæ–‡ç« çš„æ•°æ®ä¿å­˜åœ¨äº† &lt;code>data&lt;/code> ä¸­ï¼ˆæ³¨æ„ï¼šè¯¥æ®µä»£ç éœ€è¦å†™åœ¨ html ä¸­ï¼Œè‹¥å•ç‹¬ç¼–å†™ js æ–‡ä»¶ï¼Œæœ€åå¹¶ä¸ä¼šå¥æ•ˆï¼Œå› ä¸º Hugo å¹¶ä¸ä¼šå»ç¼–è¯‘ js æ–‡ä»¶ï¼‰ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="è®¾ç½®æ—¥æœŸæ—¶é—´">è®¾ç½®æ—¥æœŸæ—¶é—´&lt;/h3>
&lt;p>å®˜æ–¹ç»™å‡ºçš„æ—¥æœŸè®¾ç½®æ—¶é—´éå¸¸ç®€å•ï¼Œä»å½“å‰ä¸€å¹´çš„ä¸€æœˆä¸€æ—¥å¼€å§‹ï¼Œéšæœºç”Ÿæˆ 365 ä¸ªæ•°æ®ã€‚è€Œ javascript ä¸­æœ‰ä¸€æ®µä»£ç å¯ä»¥è·å–å½“å‰æ—¶é—´å’Œå½“å‰æ—¶é—´å‰æ¨ä»»æ„æ—¶é—´&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="kd">var&lt;/span> &lt;span class="nx">sdtime2&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">setHours&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">sdtime1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getHours&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">//å°æ—¶
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">var&lt;/span> &lt;span class="nx">sdtime3&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">setDate&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">getDate&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="c1">//7å¤©
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">var&lt;/span> &lt;span class="nx">sdtime4&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">setMonth&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">getMonth&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="c1">//ä¸€ä¸ªæœˆ
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">var&lt;/span> &lt;span class="nx">sdtime5&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">setFullYear&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">getFullYear&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="c1">//ä¸€å¹´
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">sdtime2&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">Format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;yyyy-MM-dd HH:mm:ss&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬å¯ä»¥ä¸‹ä¸€ä¸ªå‡½æ•°ï¼Œç”Ÿæˆå½“å‰æ—¶é—´æ¨è‡³å‰è‹¥å¹²ä¸ªæœˆçš„æ—¥å†åŒºé—´&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="kd">function&lt;/span> &lt;span class="nx">heatmap_width&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">months&lt;/span>&lt;span class="p">){&lt;/span> &lt;span class="c1">// è®¡ç®—è½¬æ¢æ—¥æœŸ
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="kd">var&lt;/span> &lt;span class="nx">startDate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">();&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">mill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">startDate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setMonth&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">startDate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getMonth&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="nx">months&lt;/span>&lt;span class="p">));&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">endDate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">();&lt;/span>
&lt;span class="nx">startDate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">mill&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nx">endDate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">echarts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">format&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">formatTime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;yyyy-MM-dd&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">endDate&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nx">startDate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">echarts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">format&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">formatTime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;yyyy-MM-dd&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">startDate&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">showmonth&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[];&lt;/span>
&lt;span class="nx">showmonth&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">push&lt;/span>&lt;span class="p">([&lt;/span>
&lt;span class="nx">startDate&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">endDate&lt;/span>
&lt;span class="p">]);&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">showmonth&lt;/span>
&lt;span class="p">};&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¯¥å‡½æ•°è¿”å›ä¸€ä¸ª &lt;code>[startDate,endDate]&lt;/code> æ•°æ®ï¼Œè¡¨ç¤ºæ—¥å†çš„å¼€å§‹æ—¥æœŸå’Œç»“æŸæ—¥æœŸã€‚&lt;/p>
&lt;/br>
&lt;h3 id="å›¾è¡¨é…ç½®">å›¾è¡¨é…ç½®&lt;/h3>
&lt;p>ä¸Šæ–‡å·²ç»æåˆ°è¿‡ï¼Œæ—¥å†çš„é…ç½®åœ¨ &lt;a href="https://echarts.apache.org/zh/option.html#calendar"target="_blank" rel="noopener noreferrer">https://echarts.apache.org/zh/option.html#calendar&lt;/a>
æœ‰éå¸¸è¯¦ç»†çš„è¯´æ˜ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å®˜ç½‘æ ·ä¾‹ç»™å‡ºçš„é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="nx">option&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">title&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">top&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">30&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">left&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;center&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">text&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;æ•°æ•°æ•²äº†å‡ ä¸ªå­—ï¼Ÿ&amp;#39;&lt;/span>
&lt;span class="p">},&lt;/span>
&lt;span class="nx">tooltip&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{},&lt;/span>
&lt;span class="nx">visualMap&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">min&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">max&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">5000&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">type&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;piecewise&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">orient&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;horizontal&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">left&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;center&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">top&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">65&lt;/span>
&lt;span class="p">},&lt;/span>
&lt;span class="nx">calendar&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">top&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">120&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">left&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">30&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">right&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">30&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">cellSize&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;auto&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">12&lt;/span>&lt;span class="p">],&lt;/span>
&lt;span class="nx">range&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">heatmap_width&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="c1">// è®¾ç½®è½¬æ¢çš„æ—¥å†æ—¥æœŸåŒºé—´
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">itemStyle&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">borderWidth&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mf">0.5&lt;/span>
&lt;span class="p">},&lt;/span>
&lt;span class="nx">yearLabel&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">show&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">false&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="p">},&lt;/span>
&lt;span class="nx">series&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">type&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;heatmap&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">coordinateSystem&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;calendar&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">data&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">data&lt;/span> &lt;span class="c1">// åŠ è½½æ–‡ç« æ•°æ®
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="p">};&lt;/span>
&lt;span class="nx">myChart&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setOption&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">option&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¤§åŠŸå‘Šæˆï¼æ—¥å†è´¡çŒ®å›¾å°±å®Œæˆäº†ï¼æ‰€æœ‰ä»£ç  &lt;a href="https://shared.snipper.app/snippet/D67FD48F-2089-4A13-9A2B-37E6B48D3F06"target="_blank" rel="noopener noreferrer">https://shared.snipper.app/snippet/D67FD48F-2089-4A13-9A2B-37E6B48D3F06&lt;/a>
æˆ–è€…ä¸‹é¢çš„æœªè®¾ç½® hugo è·å–æ–‡ç« æ•°æ®çš„ä»£ç ï¼Œè½¬è€Œä½¿ç”¨éšæœºæ•°æ®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;ttt&amp;#34;&lt;/span> &lt;span class="na">style&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;
&lt;/span>&lt;span class="s"> width: 600px;
&lt;/span>&lt;span class="s"> height: 300px;
&lt;/span>&lt;span class="s"> margin-top: 15px;
&lt;/span>&lt;span class="s"> margin-bottom: 10px;
&lt;/span>&lt;span class="s"> padding: 2px;
&lt;/span>&lt;span class="s"> border: 1px solid;
&lt;/span>&lt;span class="s"> border-radius: 10px;
&lt;/span>&lt;span class="s"> border-width: 0.5px;
&lt;/span>&lt;span class="s"> text-align: center;&amp;#34;&lt;/span>
&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;https://cdn.jsdelivr.net/npm/echarts@5.3.0/dist/echarts.min.js&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;text/javascript&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">chartDom&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getElementById&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;ttt&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">myChart&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">echarts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">init&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">chartDom&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">option&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="c1">// è®¡ç®—æ—¥æœŸå¹¶è½¬æ¢æ ¼å¼
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="kd">var&lt;/span> &lt;span class="nx">startDate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">();&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">year_Mill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">startDate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setFullYear&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">startDate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getFullYear&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">));&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">startDate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">year_Mill&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">endDate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">();&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">dayTime&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">3600&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">24&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">1000&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[];&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kd">var&lt;/span> &lt;span class="nx">time&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">startDate&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">time&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="nx">endDate&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">time&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="nx">dayTime&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">push&lt;/span>&lt;span class="p">([&lt;/span>
&lt;span class="nx">echarts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">format&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">formatTime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;yyyy-MM-dd&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nx">time&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="nb">Math&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">floor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">Math&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">random&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">10000&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">]);&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">startDate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">echarts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">format&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">formatTime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;yyyy-MM-dd&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">startDate&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nx">endDate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">echarts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">format&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">formatTime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;yyyy-MM-dd&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">endDate&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">rangeArr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">startDate&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nx">endDate&lt;/span>&lt;span class="p">];&lt;/span>
&lt;span class="nx">option&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">title&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">top&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">30&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">left&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;center&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">text&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;Daily Step Count&amp;#39;&lt;/span>
&lt;span class="p">},&lt;/span>
&lt;span class="nx">tooltip&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{},&lt;/span>
&lt;span class="nx">visualMap&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">min&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">max&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">10000&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">type&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;piecewise&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">orient&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;horizontal&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">left&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;center&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">top&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">65&lt;/span>
&lt;span class="p">},&lt;/span>
&lt;span class="nx">calendar&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">top&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">120&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">left&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">30&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">right&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">30&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">cellSize&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;auto&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">13&lt;/span>&lt;span class="p">],&lt;/span>
&lt;span class="nx">range&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">rangeArr&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">itemStyle&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">borderWidth&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mf">0.5&lt;/span>
&lt;span class="p">},&lt;/span>
&lt;span class="nx">yearLabel&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">show&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">false&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="p">},&lt;/span>
&lt;span class="nx">series&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">type&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;heatmap&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">coordinateSystem&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;calendar&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">data&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">data&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">};&lt;/span>
&lt;span class="nx">option&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">myChart&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setOption&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">option&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>ä½†æ˜¯ï¼Œä½†æ˜¯ï¼ç­‰ç­‰&amp;hellip;è¿™æ ·é…ç½®çš„çƒ­åŠ›å›¾ä¼¼ä¹å¹¶ä¸å®Œç¾ï¼Œåœ¨ä¸åŒå±å¹•å®½åº¦ä¸‹çš„å±•ç¤ºæ•ˆæœä¼šéå¸¸å·®ï¼Œæ‰€ä»¥è¦è®¾ç½®ä¸€ä¸‹é€‚é…å±å¹•å®½åº¦çš„çƒ­åŠ›å›¾ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="ä¼˜åŒ–">ä¼˜åŒ–&lt;/h3>
&lt;p>æˆ‘ä»¬åˆ†åˆ«è®¾ç½®åœ¨ä¸åŒå±å¹•å®½åº¦ä¸‹è¦æ˜¾ç¤ºçš„æ—¥æœŸåŒºé—´ï¼Œå°†å¦‚ä¸‹ä»£ç æ”¾è‡³ &lt;code>heatmap_width&lt;/code> å‡½æ•°ä¸‹é¢ï¼Œ&lt;code>option&lt;/code> ä¸Šé¢(javascript å¹¶ä¸æ˜¯ç‰¹åˆ«æ‹¿æ‰‹ï¼Œåªèƒ½ä½¿ç”¨æœ€ç¬¨çš„æ–¹æ³•äº†ğŸ˜¥)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">matchMedia&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;(max-width: 320px)&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">matches&lt;/span>&lt;span class="p">){&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">rangeArr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">heatmap_width&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">matchMedia&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;(max-width: 400px)&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">matches&lt;/span>&lt;span class="p">){&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">rangeArr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">heatmap_width&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">matchMedia&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;(max-width: 550px)&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">matches&lt;/span>&lt;span class="p">){&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">rangeArr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">heatmap_width&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">matchMedia&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;(max-width: 1021px)&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">matches&lt;/span>&lt;span class="p">){&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">rangeArr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">heatmap_width&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">matchMedia&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;(max-width: 1400px)&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">matches&lt;/span>&lt;span class="p">){&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">rangeArr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">heatmap_width&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">matchMedia&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;(max-width: 1920px)&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">matches&lt;/span>&lt;span class="p">){&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">rangeArr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">heatmap_width&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">matchMedia&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;(max-width: 2560px)&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">matches&lt;/span>&lt;span class="p">){&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">rangeArr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">heatmap_width&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">24&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;h3 id="æš—æ¨¡å¼">æš—æ¨¡å¼&lt;/h3>
&lt;p>è¯¥å›¾è¡¨å…¶å®æœ¬èº«è‡ªå¸¦æš—æ¨¡å¼ï¼Œä½†æ˜¯ä¸ºäº†å’Œæœ¬ç½‘ç«™ç›¸åŒ¹é…ï¼Œæ‰€ä»¥å†³å®šè‡ªå·±åŠ¨æ‰‹å®ç°æš—æ¨¡å¼ã€‚&lt;/p>
&lt;p>ä¸ºæ­¤æˆ‘åˆ†åˆ«å†™äº†ä¸¤ä¸ªå‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="kd">function&lt;/span> &lt;span class="nx">LightOption&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="kd">function&lt;/span> &lt;span class="nx">DarkOption&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å°† &lt;code>option&lt;/code> é…ç½®åˆ†åˆ«æ”¾å…¥ä¸¤ä¸ªå‡½æ•°ä¸­ï¼Œå†å•ç‹¬è¿›è¡Œé¢œè‰²é…ç½®&lt;/p>
&lt;p>ç„¶åä½¿ç”¨ &lt;code>(window.matchMedia('(prefers-color-scheme: dark)').matches)&lt;/code> è·å–å½“å‰ç³»ç»Ÿçš„æš—æ¨¡å¼æ–¹æ³•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">matchMedia&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;(prefers-color-scheme: dark)&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">matches&lt;/span>&lt;span class="p">){&lt;/span> &lt;span class="c1">// æš—æ¨¡å¼
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">DarkOption&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">else&lt;/span>&lt;span class="p">{&lt;/span> &lt;span class="c1">// äº®æ¨¡å¼
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">LightOption&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>åŠ å…¥å±å¹•ç›‘å¬åŠŸèƒ½&lt;/strong>&lt;/p>
&lt;p>å½“æˆ‘ä»¬åˆ‡æ¢æ˜æš—æ¨¡å¼æ—¶ï¼Œä»¥ä¸Šä»£ç å¯¹äºç½‘ç«™å¹¶ä¸ä¼šç›´æ¥ç”Ÿæ•ˆï¼Œéœ€è¦åˆ·æ–°ä¸€éæ‰å¯ä»¥ç”Ÿæ•ˆã€‚æ‰€ä»¥åŠ å…¥ç›‘å¬åŠŸèƒ½ä½¿å¾—ç½‘ç«™ä¸€æ—¦åˆ‡æ¢æ˜æš—æ¨¡å¼åˆ™ç†ç§‘ç”Ÿæ•ˆ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="kd">var&lt;/span> &lt;span class="nx">listeners&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span> &lt;span class="c1">// æ¨¡å¼ç›‘å¬
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">dark&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">mediaQueryList&lt;/span> &lt;span class="p">)=&amp;gt;{&lt;/span> &lt;span class="c1">// æš—æ¨¡å¼
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">mediaQueryList&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">matches&lt;/span>&lt;span class="p">){&lt;/span>
&lt;span class="nx">DarkOption&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">},&lt;/span>
&lt;span class="nx">light&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">mediaQueryList&lt;/span>&lt;span class="p">)=&amp;gt;{&lt;/span> &lt;span class="c1">// äº®æ¨¡å¼
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">mediaQueryList&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">matches&lt;/span>&lt;span class="p">){&lt;/span>
&lt;span class="nx">LightOption&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">},&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">matchMedia&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;(prefers-color-scheme: dark)&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">addListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">listeners&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">dark&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">matchMedia&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;(prefers-color-scheme: light)&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">addListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">listeners&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">light&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>è‡³æ­¤ï¼Œæ€»ç®—å®Œæˆäº†ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="æ€»ç»“">æ€»ç»“&lt;/h3>
&lt;p>ECharts åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œä½†æ˜¯å´å¹¶ä¸èƒ½ç”Ÿæˆå¦‚åŒ Github ä»£ç è´¡çŒ®å›¾çš„æ ·å­ï¼Œå¯¹äºæ¯ä¸€å¤©çš„å°æ–¹å—ä¸èƒ½è®¾ç½®æ›´å¥½çš„æ ·å¼ã€‚ä¸çŸ¥é“ AntV è¡Œä¸è¡Œã€‚æ€»ä¹‹ï¼Œä»¥åæœ‰æ—¶é—´å†ç ”ç©¶ç ”ç©¶ã€‚&lt;/p></description></item><item><title>[å»ºç«™æ—¥è®°] åŠ¨æ€æ‰“å­—ç‰¹æ•ˆ</title><link>https://yibocat.github.io/posts/jzrj/jzrj_3/</link><pubDate>Sat, 19 Feb 2022 00:32:35 +0800</pubDate><guid>https://yibocat.github.io/posts/jzrj/jzrj_3/</guid><description>&lt;p>åœ¨ç½‘ç«™ä¸Šæœ‰ä¸€ä¸ªåŠ¨æ€æ‰“å­—ç‰¹æ•ˆå½“ç„¶æ˜¯ä¸€ä»¶å¾ˆé…·çš„äº‹å•Šã€‚æ— æ„ä¹‹é—´æ‰¾åˆ°äº†ä¸€ä¸ªåŠ¨æ€æ‰“å­—ç‰¹æ•ˆæ’ä»¶ &lt;a href="https://mattboldt.com/demos/typed-js/"target="_blank" rel="noopener noreferrer">Typed-js&lt;/a>
ã€‚è¯¥æ’ä»¶è¿˜å®ç°äº†å„ç§è‡ªå®šä¹‰æ»¡è¶³ä¸åŒçš„éœ€æ±‚ã€‚å¯ä»¥è¯´æ˜¯éå¸¸éå¸¸å¥½ç”¨äº†ï¼Œè€Œä¸”å®‰è£…ä½¿ç”¨ä¹Ÿæ˜¯éå¸¸çš„ç®€å•ã€‚&lt;/p>
&lt;p>è¯¥æ’ä»¶çš„ä½œè€…æ˜¯ Matt Boldtï¼Œè¿™æ˜¯ä»–çš„ä¸»é¡µï¼š&lt;a href="https://mattboldt.com/"target="_blank" rel="noopener noreferrer">https://mattboldt.com/&lt;/a>
ã€‚&lt;/p>
&lt;p>Typed-js çš„ Githubï¼š&lt;a href="https://github.com/mattboldt/typed.js/"target="_blank" rel="noopener noreferrer">https://github.com/mattboldt/typed.js/&lt;/a>
ã€‚&lt;/p>
&lt;p>è¯¥æ’ä»¶çš„è‡ªå®šä¹‰ Demo å¦‚ä¸‹ï¼š&lt;a href="http://mattboldt.github.io/typed.js/"target="_blank" rel="noopener noreferrer">http://mattboldt.github.io/typed.js/&lt;/a>
ã€‚&lt;/p>
&lt;p>ä¸‹é¢æˆ‘ä»¬å¤§æ¦‚è®²ä¸€ä¸‹è¯¥æ’ä»¶çš„ä½¿ç”¨æ–¹æ³•ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="å®‰è£…æ–¹æ³•">å®‰è£…æ–¹æ³•&lt;/h3>
&lt;p>å®˜æ–¹æä¾›äº†ä¸‰ç§å®‰è£…æ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">npm install typed.js
yarn add typed.js
bower install typed.js
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…ä½¿ç”¨ &lt;code>script&lt;/code> CDN å¯¼å…¥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;https://cdn.jsdelivr.net/npm/typed.js@2.0.12&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;h3 id="ä½¿ç”¨">ä½¿ç”¨&lt;/h3>
&lt;p>ä»å®˜æ–¹ç»™å‡ºçš„ä¾‹å­æ¥çœ‹&lt;/p>
&lt;p>This is really all you need to get going.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="c1">// Can also be included with a regular script tag
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kr">import&lt;/span> &lt;span class="nx">Typed&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;typed.js&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">options&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">strings&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;&amp;lt;i&amp;gt;First&amp;lt;/i&amp;gt; sentence.&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;amp;amp; a second sentence.&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;span class="nx">typeSpeed&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">40&lt;/span>
&lt;span class="p">};&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">typed&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Typed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;.element&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">options&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šé¢è¿™ä¸ªä¾‹å­å±•ç¤ºäº†åŸºæœ¬çš„ä½¿ç”¨æ–¹æ³•ã€‚æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªæ›´å…·ä½“çš„ä¾‹å­&lt;/p>
&lt;script>
var typed = new Typed('#typed', {
stringsElement: '#typed-strings'
});
&lt;/script>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;https://cdn.jsdelivr.net/npm/typed.js@2.0.12&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">typed&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Typed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;#typed&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">stringsElement&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;#typed-strings&amp;#39;&lt;/span>
&lt;span class="p">});&lt;/span>
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;typed-strings&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>Typed.js is a &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">strong&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>JavaScript&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">strong&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> library.&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>It &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">em&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>types&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">em&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> out sentences.&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">span&lt;/span> &lt;span class="na">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;typed&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">span&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>stringElement&lt;/code> ä¸ºå®šä¹‰çš„å¤–éƒ¨åŠ¨æ€æ‰“å­—æ–‡å­—ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ &lt;code>strings:[]&lt;/code> æ¥æ›¿ä»£ã€‚ &lt;code>typed-strings&lt;/code> è¡¨ç¤ºè¦æ’å…¥åŠ¨æ€æ‰“å­—ç‰¹æ•ˆçš„æ¨¡å—ã€‚ä¸€èˆ¬çš„è‡ªå®šä¹‰åˆ™åœ¨ &lt;code>new Typed()&lt;/code> ä¸­è®¾ç½®ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="æ ·å¼è®¾ç½®">æ ·å¼è®¾ç½®&lt;/h3>
&lt;p>&lt;code>css&lt;/code> åŠ¨ç”»æ˜¯åŸºäº &lt;code>javascript&lt;/code> åˆå§‹åŒ–æ„å»ºçš„ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ &lt;code>css&lt;/code> ä¸­è®¾ç½®å„ç§æ ·å¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-css" data-lang="css">&lt;span class="c">/* å…‰æ ‡ */&lt;/span>
&lt;span class="p">.&lt;/span>&lt;span class="nc">typed-cursor&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c">/* å¦‚æœè®¾ç½®äº†æ·¡å‡ºé€‰é¡¹ */&lt;/span>
&lt;span class="p">.&lt;/span>&lt;span class="nc">typed-fade-out&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;h3 id="è‡ªå®šä¹‰">è‡ªå®šä¹‰&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="kd">var&lt;/span> &lt;span class="nx">typed&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Typed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;.element&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * @property {array} strings è¦è¾“å…¥çš„å­—ç¬¦
&lt;/span>&lt;span class="cm"> * @property {string} stringsElement åŒ…å«å­—ç¬¦ä¸² children çš„å…ƒç´ çš„ ID
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">strings&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;span class="s1">&amp;#39;These are the default values...&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;You know what you should do?&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;Use your own!&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;Have a great day!&amp;#39;&lt;/span>
&lt;span class="p">],&lt;/span>
&lt;span class="nx">stringsElement&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * @property {number} typeSpeed ç±»å‹é€Ÿåº¦ï¼Œå•ä½ï¼šæ¯«ç§’
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">typeSpeed&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * @property {number} startDelay è¾“å…¥å¼€å§‹å‰çš„æ—¶é—´ï¼Œå•ä½ï¼šæ¯«ç§’
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">startDelay&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * @property {number} backSpeed é€€æ ¼é€Ÿåº¦ï¼Œå•ä½ï¼šæ¯«ç§’
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">backSpeed&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * @property {boolean} smartBackspace åªé€€æ ¼ä¸å‰ä¸€ä¸ªå­—ç¬¦ä¸²ä¸åŒ¹é…çš„å†…å®¹
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">smartBackspace&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * @property {boolean} shuffle éšæœºæ’­æ”¾å­—ç¬¦ä¸²
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">shuffle&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * @property {number} backDelay é€€æ ¼å‰çš„å»¶è¿Ÿæ—¶é—´ï¼Œå•ä½ï¼šæ¯«ç§’
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">backDelay&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">700&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * @property {boolean} fadeOut ç”¨æ·¡å‡ºæ›¿ä»£é€€æ ¼
&lt;/span>&lt;span class="cm"> * @property {string} fadeOutClass æ·¡å‡ºåŠ¨ç”»
&lt;/span>&lt;span class="cm"> * @property {boolean} fadeOutDelay æ·¡å‡ºå»¶è¿Ÿï¼Œå•ä½ï¼šæ¯«ç§’
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">fadeOut&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">fadeOutClass&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;typed-fade-out&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">fadeOutDelay&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">500&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * @property {boolean} loop è¿›è¡Œå¾ªç¯æ’­æ”¾
&lt;/span>&lt;span class="cm"> * @property {number} loopCount å¾ªç¯æ’­æ”¾æ¬¡æ•°
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">loop&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">loopCount&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">Infinity&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * @property {boolean} showCursor æ˜¾ç¤ºå…‰æ ‡
&lt;/span>&lt;span class="cm"> * @property {string} cursorChar å…‰æ ‡å­—ç¬¦ä¸²ï¼Œä¸€èˆ¬ä¸º&amp;#39;|&amp;#39;ï¼Œæˆ‘ä¸ªäººæ¯”è¾ƒå–œæ¬¢è®¾ç½®ä¸ºèƒŒæ™¯å®šå®½
&lt;/span>&lt;span class="cm"> * @property {boolean} autoInsertCss æ’å…¥ CSS å…‰æ ‡å¹¶æ·¡å‡ºåˆ° HTML &amp;lt;head&amp;gt;
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">showCursor&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">cursorChar&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;|&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">autoInsertCss&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * @property {string} attr è¾“å‡ºçš„å­—ç¬¦ä¸²å±æ€§
&lt;/span>&lt;span class="cm"> * Ex: input placeholder, value, or just HTML text
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">attr&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * @property {boolean} bindInputFocusEvents å¦‚æœ el æ˜¯æ–‡æœ¬è¾“å…¥çš„è¯åˆ™ç»‘å®šåˆ°ç„¦ç‚¹å’Œæ¨¡ç³Š
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">bindInputFocusEvents&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * @property {string} contentType å†…å®¹ç±»å‹ä¸º html æˆ–è€… null
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">contentType&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;html&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * å¼€å§‹è¾“å…¥ä¹‹å‰æ‰§è¡Œ
&lt;/span>&lt;span class="cm"> * @param {Typed} self
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">onBegin&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">self&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{},&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * æ‰€æœ‰è¾“å…¥å®Œæˆæ‰§è¡Œ
&lt;/span>&lt;span class="cm"> * @param {Typed} self
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">onComplete&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">self&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{},&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * æ¯ä¸ªå­—ç¬¦ä¸²è¾“å…¥ä¹‹å‰æ‰§è¡Œ
&lt;/span>&lt;span class="cm"> * @param {number} arrayPos
&lt;/span>&lt;span class="cm"> * @param {Typed} self
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">preStringTyped&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">arrayPos&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">self&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{},&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * æ¯ä¸ªå­—ç¬¦ä¸²è¾“å…¥ä¹‹åæ‰§è¡Œ
&lt;/span>&lt;span class="cm"> * @param {number} arrayPos
&lt;/span>&lt;span class="cm"> * @param {Typed} self
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">onStringTyped&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">arrayPos&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">self&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{},&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * å¾ªç¯è¿‡ç¨‹ä¸­è¾“å…¥æœ€åä¸€ä¸ªå­—ç¬¦ä¸²åæ‰§è¡Œ
&lt;/span>&lt;span class="cm"> * @param {Typed} self
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">onLastStringBackspaced&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">self&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{},&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * è¾“å…¥åœæ­¢æ‰§è¡Œ
&lt;/span>&lt;span class="cm"> * @param {number} arrayPos
&lt;/span>&lt;span class="cm"> * @param {Typed} self
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">onTypingPaused&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">arrayPos&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">self&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{},&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * Typing has been started after being stopped
&lt;/span>&lt;span class="cm"> * @param {number} arrayPos
&lt;/span>&lt;span class="cm"> * @param {Typed} self
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">onTypingResumed&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">arrayPos&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">self&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{},&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * é‡ç½®ä¹‹åæ‰§è¡Œ
&lt;/span>&lt;span class="cm"> * @param {Typed} self
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">onReset&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">self&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{},&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * åœæ­¢ä¹‹åæ‰§è¡Œ
&lt;/span>&lt;span class="cm"> * @param {number} arrayPos
&lt;/span>&lt;span class="cm"> * @param {Typed} self
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">onStop&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">arrayPos&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">self&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{},&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * å¼€å§‹ä¹‹åæ‰§è¡Œ
&lt;/span>&lt;span class="cm"> * @param {number} arrayPos
&lt;/span>&lt;span class="cm"> * @param {Typed} self
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">onStart&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">arrayPos&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">self&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{},&lt;/span>
&lt;span class="cm">/**
&lt;/span>&lt;span class="cm"> * é”€æ¯ä¹‹å
&lt;/span>&lt;span class="cm"> * @param {Typed} self
&lt;/span>&lt;span class="cm"> */&lt;/span>
&lt;span class="nx">onDestroy&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">self&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;span class="p">});&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;h3 id="ä¸¾ä¾‹">ä¸¾ä¾‹&lt;/h3>
&lt;p>&lt;a href="http://mattboldt.github.io/typed.js/"target="_blank" rel="noopener noreferrer">http://mattboldt.github.io/typed.js/&lt;/a>
&lt;/p>
&lt;/br></description></item><item><title>[æ·±åº¦å­¦ä¹ ç¬”è®°] æ·±åº¦å­¦ä¹ ç¬¬ 5 ç¯‡â€”â€”æ­£å‘ä¼ æ’­ä¸åå‘ä¼ æ’­</title><link>https://yibocat.github.io/posts/dl/sdxx_5/</link><pubDate>Thu, 17 Feb 2022 21:48:32 +0800</pubDate><guid>https://yibocat.github.io/posts/dl/sdxx_5/</guid><description>&lt;p>ä»€ä¹ˆæ˜¯æ­£å‘ä¼ æ’­ï¼Ÿæ­£å‘ä¼ æ’­æ˜¯æŒ‰ç…§ç¥ç»ç½‘ç»œçš„è¾“å…¥åˆ°è¾“å‡ºçš„é¡ºåºï¼Œä¾æ¬¡è®¡ç®—ä»æ¨¡å‹ä¸­é—´å˜é‡çš„è¿‡ç¨‹ã€‚è€Œåå‘ä¼ æ’­åˆ™æ˜¯è®¡ç®—ç¥ç»ç½‘ç»œçš„å‚æ•°æ¢¯åº¦çš„è¿‡ç¨‹ã€‚åœ¨è®­ç»ƒç¥ç»ç½‘ç»œæ—¶ï¼Œæ­£å‘ä¼ æ’­ä¸åå‘ä¼ æ’­æ˜¯ç›¸äº’ä¾èµ–çš„ã€‚æ­£å‘ä¼ æ’­ä¾æ¬¡è®¡ç®—æ¨¡å‹ä¸­é—´å˜é‡ï¼Œåå‘ä¼ æ’­å†æ ¹æ®å˜é‡å¯¹å‚æ•°è¿›è¡Œæ¢¯åº¦æ±‚å¯¼ã€‚æ‰€ä»¥å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œåœ¨å‚æ•°è¿›è¡Œåˆå§‹åŒ–ä¹‹åå¯¹æ¨¡å‹è¿›è¡Œäº¤æ›¿çš„æ­£å‘ä¼ æ’­ä¸åå‘ä¼ æ’­ï¼Œå¹¶æ ¹æ®åå‘ä¼ æ’­è®¡ç®—çš„æ¢¯åº¦è¿­ä»£æ¨¡å‹å‚æ•°ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="æ­£å‘ä¼ æ’­">æ­£å‘ä¼ æ’­&lt;/h3>
&lt;p>å‰å‡ ç¯‡æ–‡ç« è®²çš„åŸºæœ¬ä¸Šéƒ½æ˜¯æ­£å‘ä¼ æ’­ï¼Œè¿™é‡Œæˆ‘ä»¬ç®€å•åœ°å†æ¨å¯¼ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>å‡è®¾è¾“å…¥ä¸º $x\in \mathbb{R}^d$ ï¼Œä¸è€ƒè™‘åå·®ï¼Œä¸­é—´å˜é‡ä¸º $z\in\mathbb{R}^h$ï¼Œ$\pmb{W}^{(1)}\in\mathbb{R}^{h\times d}$ ä¸ºéšè—å±‚çš„æƒé‡å‚æ•°ã€‚è®¾ $\phi()$ ä¸ºæ¿€æ´»å‡½æ•°ï¼Œåˆ™æœ‰
$$
z=\pmb{W}^{(1)}x,\newline
\pmb{h} = \phi(z)
$$
è¿™é‡Œ $\pmb{h}$ è¡¨ç¤ºå¾—åˆ°çš„éšè—å±‚å˜é‡ï¼Œä¹Ÿå°±æ˜¯ä¸­é—´å˜é‡ã€‚&lt;/p>
&lt;p>å‡è®¾è¾“å‡ºå±‚å‚æ•°ä¸º $\pmb{W}^{(2)}\in\mathbb{R}^{q\times h}$ ï¼Œåˆ™å¾—åˆ°çš„å‘é‡é•¿åº¦ä¸º $q$ çš„è¾“å‡ºå±‚å˜é‡ä¸º
$$
\pmb{o}=\pmb{W}^{(2)}\pmb{h}
$$
æˆ‘ä»¬å‡è®¾æŸå¤±å‡½æ•°ä¸º $\ell$ ï¼Œæ ·æœ¬æ ‡ç­¾ä¸º $y$ ï¼Œåˆ™æ ·æœ¬æŸå¤±é¡¹ä¸º
$$
L=\ell(\pmb{o},y)
$$
å¼•å…¥æ­£åˆ™åŒ–é¡¹ $s$
$$
s=\frac{\lambda}{2}(\vert\vert\pmb{W}^{(1)}\vert\vert^2_F+\vert\vert\pmb{W}^{(2)}\vert\vert^2_F)
$$
å¾—åˆ°æ¨¡å‹åœ¨ç»™å®šæ ·æœ¬ä¸Šçš„æŸå¤±ä¸º $J = L+s$ ï¼Œæˆ‘ä»¬ç§° $J$ ä¸ºç»™å®šæ ·æœ¬çš„&lt;strong>ç›®æ ‡å‡½æ•°&lt;/strong>ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="åå‘ä¼ æ’­">åå‘ä¼ æ’­&lt;/h3>
&lt;p>æˆ‘ä»¬è¯´åå‘ä¼ æ’­æ˜¯è®¡ç®—ç¥ç»ç½‘ç»œå‚æ•°æ¢¯åº¦çš„æ–¹æ³•ï¼Œå…¶åŸºæœ¬åŸç†æ˜¯å¾®ç§¯åˆ†ä¸­çš„é“¾å¼æ³•åˆ™ã€‚&lt;/p>
&lt;/br>
&lt;p>&lt;strong>é“¾å¼æ³•åˆ™&lt;/strong>&lt;/p>
&lt;p>å‡è®¾ $y=g(x)ï¼Œz=f(y)$ï¼Œåˆ™ $z=h(x)=f(g(x))$ ã€‚å¯¹è¿™ä¸¤ä¸ªå‡½æ•°åˆ†åˆ«æ±‚å¯¼æœ‰
$$
\frac{dy}{dx}=g'(x) \newline
\frac{dz}{dy}=f'(y)
$$
æ ¹æ®é“¾å¼æ³•åˆ™ï¼Œæœ‰
$$
h'(x)=\frac{dz}{dx}=\frac{dz}{dy}\cdot\frac{dy}{dx}
$$
å³å¤åˆå‡½æ•°æ±‚å¯¼ä½¿ç”¨&lt;strong>ä¹˜æ³•æ³•åˆ™&lt;/strong>ï¼Œæˆ–ç§°ä¸º&lt;strong>é“¾å¼æ³•åˆ™&lt;/strong>ã€‚åœ¨åå‘ä¼ æ’­ä¸­æˆ‘ä»¬å¯ä»¥å®Œç¾åœ°ä½¿ç”¨è¿™ä¸ªæ³•åˆ™ã€‚&lt;/p>
&lt;/br>
&lt;p>&lt;strong>åå‘ä¼ æ’­&lt;/strong>&lt;/p>
&lt;p>æˆ‘ä»¬å°†é“¾å¼æ³•åˆ™åº”ç”¨åˆ°åå‘ä¼ æ’­ä¸­ã€‚åœ¨ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬çš„æ¨¡å‹å‚æ•°ä¸º $\pmb{W}^{(1)}$ å’Œ $\pmb{W}^{(2)}$ ï¼Œå› æ­¤åå‘ä¼ æ’­æ‰€è¦ä½œçš„è®¡ç®—æ˜¯ $\frac{\partial J}{\partial\pmb{W}^{(1)}}$ å’Œ $\frac{\partial J}{\partial\pmb{W}^{(2)}}$ï¼Œåå‘ä¼ æ’­çš„è®¡ç®—æ¬¡åºä¸æ­£å‘ä¼ æ’­è®¡ç®—æ¬¡åºæ°æ°ç›¸åã€‚æˆ‘ä»¬æ±‚ç›®æ ‡å‡½æ•°å…³äº $L$ å’Œ $s$ çš„æ¢¯åº¦ï¼Œæœ‰
$$
\frac{\partial J}{\partial L}=1,\quad \frac{\partial J}{\partial s}=1
$$
ç„¶åæ ¹æ®é“¾å¼æ³•åˆ™è®¡ç®—ç›®æ ‡å‡½æ•°å¯¹äºè¾“å‡ºå±‚å˜é‡çš„æ¢¯åº¦
$$
\frac{\partial J}{\partial o}=\frac{\partial J}{\partial L}\cdot\frac{\partial L}{\partial o}=\frac{\partial L}{\partial o}
$$
æ¥ç€è®¡ç®—æ­£åˆ™åŒ–é¡¹å¯¹äºä¸¤ä¸ªå‚æ•°çš„æ¢¯åº¦
$$
\frac{\partial s}{\partial\pmb{W}^{(1)}}=\lambda\pmb{W}^{(1)},\quad
\frac{\partial s}{\partial\pmb{W}^{(2)}}=\lambda\pmb{W}^{(2)}
$$
ç„¶åå…ˆè®¡ç®—é è¿‘è¾“å‡ºå±‚å‚æ•°çš„æ¢¯åº¦ $\frac{\partial J}{\partial\pmb{W}^{(2)}}\in\mathbb{R}^{q\times h}$
$$
\begin{aligned}
\frac{\partial J}{\partial\pmb{W}^{(2)}} &amp;amp; = \frac{\partial J}{\partial o}\centerdot\frac{\partial o}{\partial\pmb{W}^{(2)}}+\frac{\partial J}{\partial s}\centerdot\frac{\partial s}{\partial \pmb{W}^{(2)}} \newline
&amp;amp; = \frac{\partial J}{\partial o}\pmb{h}^{\top}+\lambda\pmb{W}^{(2)}
\end{aligned}
$$
ç„¶åç»§ç»­æ²¿ç€è¾“å‡ºå±‚å‘éšè—å±‚åå‘ä¼ æ’­ï¼Œéšè—å±‚å˜é‡çš„æ¢¯åº¦ä¸º
$$
\frac{\partial J}{\partial \pmb{h}} = \frac{\partial J}{\partial o}\centerdot\frac{\partial o}{\partial\pmb{h}}={\pmb{W}^{(2)}}^{\top}\frac{\partial J}{\partial o}
$$
ç”±äºæ¿€æ´»å‡½æ•° $\phi$ æŒ‰å…ƒç´ è¿ç®—ï¼Œä¸­é—´å˜é‡ $z$ çš„æ¢¯åº¦ $\frac{\partial J}{\partial z}$ çš„è®¡ç®—éœ€è¦ä½¿ç”¨&lt;strong>æŒ‰å…ƒç´ ä¹˜æ³•&lt;/strong> ï¼Œç¬¦å·ä½ $\odot$
$$
\frac{\partial J}{\partial z}=\frac{\partial J}{\partial \pmb{h}}\cdot\frac{\partial \pmb{h}}{\partial z}=\frac{\partial J}{\partial\pmb{h}}\odot\phi'(z)
$$
æœ€åæˆ‘ä»¬å¾—åˆ°é è¿‘è¾“å…¥å±‚çš„æ¨¡å‹å‚æ•°çš„æ¢¯åº¦ $\frac{\partial J}{\partial\pmb{W}^{(1)}}$
$$
\begin{aligned}
\frac{\partial J}{\partial \pmb{W}^{(1)}} &amp;amp;= \frac{\partial J}{\partial z}\cdot\frac{\partial z}{\partial\pmb{W}^{(1)}}+\frac{\partial J}{\partial s}\cdot\frac{\partial s}{\partial \pmb{W}^{(1)}} \newline
&amp;amp; = \frac{\partial J}{\partial z}x^{\top}+\lambda\pmb{W}^{(1)}
\end{aligned}
$$
&lt;/br>&lt;/p>
&lt;h3 id="æ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒ">æ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒ&lt;/h3>
&lt;p>çœ‹äº†è¿™ä¹ˆäº›å…¬å¼å¯èƒ½éƒ½å¿˜è®°æˆ‘ä»¬æœ€åˆæ˜¯è¦å¹²ä»€ä¹ˆçš„ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç®—è¿™ä¹ˆäº›å…¬å¼ï¼Ÿæˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬è®­ç»ƒæ¨¡å‹çš„ç›®çš„æ˜¯ä¸ºäº†å¾—åˆ°æœ€ä¼˜çš„å‚æ•°ä»¥æ»¡è¶³æˆ‘ä»¬çš„æ¨¡å‹ï¼Œé‚£ä¹ˆä»€ä¹ˆæ ·çš„æ¨¡å‹æœ€ä¼˜å‘¢ï¼Ÿå¯ä»¥è®¤ä¸ºæ˜¯æŸå¤±å‡½æ•°æœ€å°çš„æ¨¡å‹å°±æ˜¯æœ€ä¼˜çš„ã€‚é‚£ä¹ˆå¦‚ä½•é™ä½æŸå¤±å‡½æ•°å‘¢ï¼Œæˆ‘ä»¬çŸ¥é“æ¨¡å‹åœ¨ç»™å®šæ ·æœ¬ä¸Šçš„æŸå¤±å‡½æ•°ä¸º $J$ ï¼Œæˆ‘ä»¬è¦è®©æŸå¤±å‡½æ•°æœ€å°åŒ–ï¼Œæ‰€ä»¥é€šè¿‡æ¢¯åº¦ä¸‹é™æ³•è¿­ä»£æœ€æ¥è¿‘çš„å‚æ•°ï¼Œä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•è¿›è¡Œè¿­ä»£å°±è¦é€šè¿‡åå‘ä¼ æ’­ç®—æ³•è®¡ç®—å‚æ•°æ¢¯åº¦ã€‚æˆ‘ä»¬å›å¿†ä¸€ä¸‹å¸¦æœ‰ $L2$ å‚æ•°æ­£åˆ™åŒ–é¡¹çš„å‚æ•°è¿­ä»£å…¬å¼
$$
\omega\gets(1-\frac{\eta\lambda}{\vert \mathcal{B}\vert})\omega-\frac{\eta}{\vert \mathcal{B}\vert}\sum_{i\in\mathcal{B}}\frac{\partial \ell^{(i)}(\omega,b)}{\partial \omega}
$$
è¿™ä¹ˆä¸€çœ‹ï¼Œåé¢çš„ä¸€é¡¹æ­£æ˜¯æˆ‘ä»¬æ‰€æ¨å¯¼çš„å‚æ•°è¿­ä»£å…¬å¼ã€‚è¿™å°±æ˜¯åå‘ä¼ æ’­ï¼&lt;/p>
&lt;/br>
&lt;p>ä¸€æ–¹é¢ï¼Œæ­£å‘ä¼ æ’­çš„è®¡ç®—å¯èƒ½ä¾èµ–äºæ¨¡å‹å‚æ•°çš„å½“å‰å€¼ï¼Œè€Œè¿™äº›æ¨¡å‹å‚æ•°æ˜¯åœ¨åå‘ä¼ æ’­çš„æ¢¯åº¦è®¡ç®—åé€šè¿‡ä¼˜åŒ–ç®—æ³•è¿­ä»£çš„ã€‚å¦ä¸€æ–¹é¢ï¼Œåå‘ä¼ æ’­çš„æ¢¯åº¦è®¡ç®—å¯èƒ½ä¾èµ–äºå„å˜é‡çš„å½“å‰å€¼ï¼Œè€Œè¿™äº›å˜é‡çš„å½“å‰å€¼æ˜¯é€šè¿‡æ­£å‘ä¼ æ’­è®¡ç®—å¾—åˆ°çš„ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œæ¨¡å‹å‚æ•°åˆå§‹åŒ–ä¹‹åï¼Œæˆ‘ä»¬äº¤æ›¿åœ°è¿›è¡Œæ­£å‘ä¼ æ’­å’Œåå‘ä¼ æ’­ï¼Œå¹¶æ ¹æ®åå‘ä¼ æ’­è®¡ç®—çš„æ¢¯åº¦è¿­ä»£æ¨¡å‹å‚æ•°ã€‚è€Œæ­£æ˜¯ç”±äºç¥ç»ç½‘ç»œçš„ç‰¹æ®Šæ€§ï¼Œæ­£å‘ä¼ æ’­ç»“æŸåä¸èƒ½ç«‹å³é‡Šæ”¾å˜é‡å†…å­˜ï¼Œä»è€Œå¯¼è‡´ç¥ç»ç½‘ç»œçš„è®­ç»ƒå¾€å¾€å ç”¨å¾ˆå¤§çš„å†…å­˜çš„åŸå› ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="å‚è€ƒ">å‚è€ƒ&lt;/h3>
&lt;p>&lt;a href="https://zhuanlan.zhihu.com/p/40378224"target="_blank" rel="noopener noreferrer">Back Propagationï¼ˆæ¢¯åº¦åå‘ä¼ æ’­ï¼‰å®ä¾‹è®²è§£ - HexUpçš„æ–‡ç« &lt;/a>
&lt;/p>
&lt;p>&lt;a href="https://tangshusen.me/Dive-into-DL-PyTorch/#/"target="_blank" rel="noopener noreferrer">ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹PyTorch ç‰ˆï¼Œé˜¿æ–¯é¡¿Â·å¼ ã€ææ²&lt;/a>
&lt;/p></description></item><item><title>[æ·±åº¦å­¦ä¹ ç¬”è®°] æ·±åº¦å­¦ä¹ ç¬¬ 4 ç¯‡â€”â€”æƒé‡è¡°å‡ä¸ä¸¢å¼ƒæ³•</title><link>https://yibocat.github.io/posts/dl/sdxx_4/</link><pubDate>Tue, 15 Feb 2022 14:26:12 +0800</pubDate><guid>https://yibocat.github.io/posts/dl/sdxx_4/</guid><description>&lt;p>æƒé‡è¡°å‡ä¸ä¸¢å¼ƒæ³•æ˜¯å¸¸ç”¨çš„æ­£åˆ™åŒ–æ–¹æ³•ï¼Œæœ¬ç¯‡æ–‡ç« æˆ‘ä»¬å°è¯•æ‰‹åŠ¨å®ç°æƒé‡è¡°å‡ä¸ä¸¢å¼ƒæ³•ï¼Œå¹¶ä¸”å¯¹å…¶è¿›è¡Œè¯„ä¼°ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="æƒé‡è¡°å‡">æƒé‡è¡°å‡&lt;/h3>
&lt;p>æˆ‘ä»¬çŸ¥é“é«˜å¤æ‚åº¦æ¨¡å‹ä¸æ ·æœ¬æ•°æ®ä¸åŒ¹é…æ—¶ä¼šå‘ç”Ÿè¿‡æ‹Ÿåˆä¸æ¬ æ‹Ÿåˆç°è±¡ï¼Œè€Œåº”å¯¹è¿‡æ‹Ÿåˆçš„æ–¹æ³•ï¼Œä¸€æ–¹é¢æ˜¯å¢å¤§è®­ç»ƒæ ·æœ¬æ•°æ®é‡ï¼Œå¦å¤–ä¸€ç§æ–¹æ³•æ˜¯é™åˆ¶æ¨¡å‹å¤æ‚åº¦ã€‚ä¸€èˆ¬æ¥è¯´å¢å¤§æ ·æœ¬æ•°æ®é‡æ¥åŒ¹é…ç¥ç»ç½‘ç»œæ¨¡å‹å¤æ‚åº¦çš„æ–¹æ³•å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½æ–¹æ³•ï¼Œè€Œä½¿ç”¨æ­£åˆ™åŒ–æ‰‹æ®µå¯¹æ¨¡å‹æ·»åŠ æ­£åˆ™åŒ–é¡¹å¯ä»¥æœ‰æ•ˆåœ°é™åˆ¶æ¨¡å‹å¤æ‚åº¦ä»è€Œé˜²æ­¢è¿‡æ‹Ÿåˆã€‚&lt;strong>æƒé‡è¡°å‡ï¼ˆWeight Decayï¼‰&lt;/strong> å°±æ˜¯ä¸€ç§æœ‰æ•ˆçš„æ­£åˆ™åŒ–æ–¹æ³•ï¼Œå³åœ¨æ¯æ¬¡å‚æ•°æ›´æ–°æ—¶ï¼Œå¼•å…¥ä¸€ä¸ªè¡°å‡ç³»æ•°ã€‚&lt;/p>
&lt;p>åœ¨æ ‡å‡†çš„éšæœºæ¢¯åº¦ä¸‹é™ä¸­ï¼Œæƒé‡è¡°å‡æ­£åˆ™åŒ–ä¸ $L2$ èŒƒæ•°æ­£åˆ™åŒ–ç­‰ä»·ï¼Œä½†æ˜¯åœ¨ä¸€äº›è¾ƒå¤æ‚çš„ä¼˜åŒ–æ–¹æ³•ä¸­ï¼ˆAdamï¼‰å¹¶ä¸ç­‰ä»·ã€‚è¿™é‡Œå›é¡¾ä¸€ä¸‹ $L2$ èŒƒæ•°æ­£åˆ™åŒ–ã€‚&lt;/p>
&lt;/br>
&lt;p>&lt;strong>$L2$ èŒƒæ•°æ­£åˆ™åŒ–&lt;/strong>&lt;/p>
&lt;p>$L2$ èŒƒæ•°æ­£åˆ™åŒ–åœ¨æ¨¡å‹åŸæŸå¤±å‡½æ•°çš„åŸºç¡€ä¸Šå¢åŠ äº† $L2$ èŒƒæ•°æ­£åˆ™åŒ–é¡¹ï¼Œä»¥æ­¤æ¥é™åˆ¶å‚æ•°ä»è€Œä½¿å¾—æ¨¡å‹å¤æ‚åº¦å°½å¯èƒ½ç®€å•ã€‚$L2$ èŒƒæ•°æ­£åˆ™åŒ–é¡¹æŒ‡çš„æ˜¯æ¨¡å‹æƒé‡å‚æ•°æ¯ä¸ªå…ƒç´ çš„å¹³æ–¹å’Œä¸ä¸€ä¸ªæ­£çš„å¸¸æ•°çš„ä¹˜ç§¯ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬çœ‹çº¿æ€§å›å½’æŸå¤±å‡½æ•°ä¸º
$$
\ell(\pmb{\omega},b)=\frac{1}{N}\sum_{i=1}^N\frac{1}{2}(\pmb{x}^{(i)}\pmb{\omega}+b-\pmb{y}^{(i)})^2
$$
å…¶ä¸­ $\pmb{\omega}$ ä¸ºæƒé‡å‚æ•°å‘é‡ï¼Œ$b$ ä¸ºåå·®å‚æ•°ï¼Œæ ·æœ¬ $i $ çš„è¾“å…¥ä¸º $\pmb{x}^{(i)}$ ï¼Œè¯¥æ ·æœ¬æ ‡ç­¾ä¸º $\pmb{y}^{(i)}$ ï¼Œæ ·æœ¬æ•°ç›®ä¸º $N$ ã€‚åˆ™å¸¦æœ‰ $L2$ èŒƒæ•°æ­£åˆ™åŒ–é¡¹çš„æŸå¤±å‡½æ•°ä¸º
$$
\ell(\pmb{\omega},b)+\frac{\lambda}{2N}\vert\vert\pmb{\omega}\vert\vert^2
$$
è¿™é‡Œ $\lambda&amp;gt;0$ ä¸ºè¶…å‚æ•°ã€‚å½“ $\lambda$ æ¥è¿‘ 0 æ—¶ï¼Œæ­£åˆ™åŒ–é¡¹å¯¹æŸå¤±å‡½æ•°çš„å½±å“å°†é€æ¸é™ä½ã€‚&lt;/p>
&lt;p>$L2$ èŒƒæ•°å¹³æ–¹ $\vert\vert\pmb{\omega}\vert\vert^2$ å±•å¼€åå¾—åˆ° $\sum_{i=1}^N\omega_i^2$ ã€‚æˆ‘ä»¬åœ¨å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ä¸­å°†çº¿æ€§å›å½’ä¸­çš„æƒé‡ $\pmb{\omega}$ çš„è¿­ä»£æ–¹å¼
$$
\omega \gets \omega-\frac{\eta}{|\mathcal{B}|}\sum_{i\in\mathcal{B}}\frac{\partial \ell^{(i)}(\omega,b)}{\partial \omega}
$$
æ›´æ”¹ä¸ºå¦‚ä¸‹æ–¹å¼
$$
\omega\gets(1-\frac{\eta\lambda}{\vert \mathcal{B}\vert})\omega-\frac{\eta}{\vert \mathcal{B}\vert}\sum_{i\in\mathcal{B}}\frac{\partial \ell^{(i)}(\omega,b)}{\partial \omega}
$$
å¯ä»¥çœ‹åˆ°ï¼Œ $L2$ èŒƒæ•°æ­£åˆ™åŒ–å°†æƒé‡ä¹˜ä»¥ä¸€ä¸ªå°äº 1 çš„æ•°åå†å‡å»ä¸å«æ­£åˆ™åŒ–é¡¹çš„æ¢¯åº¦ã€‚æ‰€ä»¥ $L2$ èŒƒæ•°æ­£åˆ™åŒ–ä¹Ÿå«åšæƒé‡è¡°å‡ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="æƒé‡è¡°å‡æ‰‹åŠ¨ç¼–ç å®éªŒ">æƒé‡è¡°å‡æ‰‹åŠ¨ç¼–ç å®éªŒ&lt;/h3>
&lt;p>&lt;strong>ç”Ÿæˆæ•°æ®é›†&lt;/strong>&lt;/p>
&lt;p>è®¾æ ·æœ¬æ•°æ®é›†ç‰¹å¾çš„ç»´åº¦ä¸º $p$ ï¼Œå¯¹äºæ•°æ®é›†ä¸­çš„æ ·æœ¬ä½¿ç”¨å¦‚ä¸‹çº¿æ€§æ¨¡å‹
$$
y = \sum_{i=1}^p0.01x_i+0.05+\epsilon
$$
è¿™é‡Œæƒé‡ä¸º 0.01ï¼Œ$\epsilon$ ä¸ºå™ªå£°é¡¹ï¼Œå…¶æœä»å‡å€¼ä¸º 0ï¼Œæ ‡å‡†å·®ä¸º0.01 çš„é«˜æ–¯åˆ†å¸ƒã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¸ºäº†æ›´å¥½çš„æ˜¾ç¤ºè¿‡æ‹Ÿåˆæ•ˆæœï¼Œè®¾ç½®ç»´åº¦ $p$ ä¸º 200ï¼Œè®­ç»ƒæ•°æ®é›†æ•°é‡è®¾ç½®ä¸º 20ã€‚&lt;/p>
&lt;p>å¯¼å…¥å¿…é¡»åŒ…&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="o">%&lt;/span>&lt;span class="n">matplotlib&lt;/span> &lt;span class="n">inline&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.nn&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">nn&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">numpy&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">np&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">sys&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">d2lzh_pytorch&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">d2l&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”Ÿæˆæ•°æ®é›†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">n_train&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n_test&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_imputs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">200&lt;/span>
&lt;span class="n">true_w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">true_b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ones&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">num_imputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mf">0.01&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.05&lt;/span>
&lt;span class="c1"># ç”Ÿæˆæ•°æ®é›†&lt;/span>
&lt;span class="n">features&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rand&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">n_train&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">n_test&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_imputs&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="n">labels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">matmul&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">features&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">true_w&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">true_b&lt;/span>
&lt;span class="n">labels&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.01&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">labels&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">()),&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">float&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">train_features&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">test_features&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">features&lt;/span>&lt;span class="p">[:&lt;/span>&lt;span class="n">n_train&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">:],&lt;/span> &lt;span class="n">features&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">n_train&lt;/span>&lt;span class="p">:,&lt;/span> &lt;span class="p">:]&lt;/span>
&lt;span class="n">train_labels&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">test_labels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="p">[:&lt;/span>&lt;span class="n">n_train&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">n_train&lt;/span>&lt;span class="p">:]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>åˆå§‹åŒ–æ¨¡å‹å‚æ•°&lt;/strong>&lt;/p>
&lt;p>å®šä¹‰ä¸€ä¸ªåˆå§‹åŒ–æ¨¡å‹å‚æ•°çš„å‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="k">def&lt;/span> &lt;span class="nf">init_params&lt;/span>&lt;span class="p">():&lt;/span>
&lt;span class="c1"># éšæœºåˆå§‹åŒ–å‚æ•°&lt;/span>
&lt;span class="n">w&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randn&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">num_inputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">requires_grad&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zeros&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">requires_grad&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>$L2$ èŒƒæ•°æ­£åˆ™åŒ–é¡¹&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="k">def&lt;/span> &lt;span class="nf">l2_penalty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">w&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">w&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>å®šä¹‰å’Œè®­ç»ƒæ¨¡å‹&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">batch_size&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_epochs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.003&lt;/span> &lt;span class="c1"># å°æ‰¹é‡ä¸º 1ï¼Œè¿­ä»£å‘¨æœŸ 100&lt;/span>
&lt;span class="n">net&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">d2l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">linreg&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">d2l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">squared_loss&lt;/span> &lt;span class="c1"># net ä½¿ç”¨çº¿æ€§å›å½’ï¼ŒæŸå¤±å‡½æ•°ä½¿ç”¨å¹³æ–¹å·®æŸå¤±&lt;/span>
&lt;span class="n">dataset&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">utils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">TensorDataset&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">train_features&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">train_labels&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">train_iter&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">utils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DataLoader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dataset&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">batch_size&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">shuffle&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">def&lt;/span> &lt;span class="nf">fit_and_plot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">lambd&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="n">w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">init_params&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">train_ls&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">test_ls&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[],&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">_&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">num_epochs&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">train_iter&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="c1"># æ·»åŠ äº†L2èŒƒæ•°æƒ©ç½šé¡¹&lt;/span>
&lt;span class="n">l&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">loss&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">lambd&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">l2_penalty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">w&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># å¢åŠ æ­£åˆ™åŒ–é¡¹çš„æŸå¤±å‡½æ•°&lt;/span>
&lt;span class="n">l&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">w&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span> &lt;span class="ow">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="kc">None&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="c1"># æ¢¯åº¦æ¸…é›¶&lt;/span>
&lt;span class="n">w&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">b&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># åå‘ä¼ æ’­è®¡ç®—&lt;/span>
&lt;span class="n">d2l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sgd&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="n">w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">batch_size&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># éšæœºæ¢¯åº¦ä¸‹é™æ³•&lt;/span>
&lt;span class="n">train_ls&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">loss&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">train_features&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">train_labels&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mean&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">())&lt;/span>
&lt;span class="n">test_ls&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">loss&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">test_features&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">test_labels&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mean&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">())&lt;/span>
&lt;span class="n">d2l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">semilogy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_epochs&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">train_ls&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;epochs&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;loss&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_epochs&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">test_ls&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;train&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;test&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span> &lt;span class="c1"># ç”»å›¾&lt;/span>
&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;L2 norm of w:&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">w&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">norm&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>è§‚å¯Ÿè¿‡æ‹Ÿåˆ&lt;/strong>&lt;/p>
&lt;p>é¦–å…ˆæˆ‘ä»¬è®© $\lambda=0.005$ ï¼Œå› ä¸º $\lambda$ æ¥è¿‘ 0ï¼Œæ‰€ä»¥æ­£åˆ™åŒ–é¡¹çš„å½±å“éå¸¸å°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">fit_and_plot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">lambd&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">0.005&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¾“å‡º&lt;/p>
&lt;pre tabindex="0">&lt;code>L2 norm of w: 12.12175464630127
&lt;/code>&lt;/pre>&lt;p style="text-align:center">&lt;img src="https://yibocat.github.io/images/dl/dl-20220215-06.png" style="width:50%;border:none;" />&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è®­ç»ƒè¯¯å·®è¿œè¿œå°äºæµ‹è¯•è¯¯å·®ï¼Œè¿™æ˜¯å¾ˆæ˜æ˜¾çš„è¿‡æ‹Ÿåˆã€‚&lt;/p>
&lt;p>ç„¶åæˆ‘ä»¬å¢å¤§ $\lambda$ ï¼Œè®¾ç½®ä¸º $\lambda=4$&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">fit_and_plot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">lambd&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¾“å‡º&lt;/p>
&lt;pre tabindex="0">&lt;code>L2 norm of w: 0.07619155943393707
&lt;/code>&lt;/pre>&lt;p style="text-align:center">&lt;img src="https://yibocat.github.io/images/dl/dl-20220215-07.png" style="width:50%;border:none;" />&lt;/p>
&lt;p>å¯ä»¥æ˜æ˜¾çš„çœ‹åˆ°æµ‹è¯•è¯¯å·®æœ‰æ‰€ä¸‹é™ï¼Œè¿‡æ‹Ÿåˆç°è±¡æœ‰æ‰€ç¼“è§£ã€‚å¦å¤–ï¼Œæƒé‡å‚æ•°çš„L2L_2&lt;em>L&lt;/em>2èŒƒæ•°æ¯”ä¸ä½¿ç”¨æƒé‡è¡°å‡æ—¶çš„æ›´å°ï¼Œæ­¤æ—¶çš„æƒé‡å‚æ•°æ›´æ¥è¿‘0ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="ä¸¢å¼ƒæ³•">ä¸¢å¼ƒæ³•&lt;/h3>
&lt;p style="text-align:center">&lt;img src="https://yibocat.github.io/images/dl/dl-20220215-08.png" style="width:50%;" />&lt;/p>
&lt;p>æˆ‘ä»¬å‡è®¾ä¸€ä¸ªæ¨¡å‹ï¼Œå…¶è¾“å…¥ä¸ªæ•°ä¸º 4 ä¸ªï¼Œéšè—å•å…ƒä¸º 5ï¼Œåˆ™éšè—å•å…ƒ $h_i$ çš„è®¡ç®—è¡¨è¾¾å¼ä¸º
$$
h_i=\phi(x_1\omega_{1i}+x_2\omega_{2i}+x_3\omega_{3i}+x_4\omega_{4i}+b_i)
$$
è¿™é‡Œ $\phi$ è¡¨ç¤ºæ¿€æ´»å‡½æ•°ã€‚å½“æˆ‘ä»¬å¯¹éšè—å±‚ä½¿ç”¨ä¸¢å¼ƒæ³•æ—¶ï¼Œè¯¥å±‚çš„éšè—å•å…ƒä¼šæœ‰ä¸€å®šçš„æ¦‚ç‡è¢«ä¸¢å¼ƒæ‰ï¼Œæˆ‘ä»¬è®¾ä¸¢å¼ƒæ¦‚ç‡ä¸º $p$ ï¼Œåˆ™ä¸€ä¸ªéšè—å•å…ƒæœ‰ $p$ æ¦‚ç‡ä¼šè¢«æ¸…é›¶ï¼Œæœ‰ $1-p$ çš„æ¦‚ç‡è¯¥éšè—å•å…ƒé™¤ä»¥ $1-p$ è¿›è¡Œæ‹‰ä¼¸ã€‚è€Œä¸¢å¼ƒæ¦‚ç‡æ˜¯è¶…å‚æ•°ã€‚&lt;/p>
&lt;p>è®¾éšæœºå˜é‡ $\xi_i$ ä¸º 0 å’Œ 1 çš„æ¦‚ç‡ä¸º $p$ å’Œ $1-p$ ï¼Œåˆ™è¯¥éšæœºå˜é‡æœä»ä¼¯åŠªåˆ©åˆ†å¸ƒã€‚æˆ‘ä»¬è®¾éšè—å•å…ƒ $h'_i$ ä¸º
$$
h'_i=\frac{\xi_i}{1-p}h_i
$$
å› ä¸º $\xi_i$ æœä»ä¼¯åŠªåˆ©åˆ†å¸ƒï¼Œæ‰€ä»¥å…¶æœŸæœ›ä¸º $E(\xi_i)=1-p$ ï¼Œæ‰€ä»¥
$$
E(h'_i)=\frac{E(\xi_i)}{1-p}h_i=h_i
$$
å¾—åˆ°ç»“è®ºï¼š&lt;strong>ä¸¢å¼ƒæ³•ä¸æ”¹å˜è¾“å…¥çš„æœŸæœ›å€¼&lt;/strong>ï¼&lt;/p>
&lt;p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸Šè¿°æ¨¡å‹ä½¿ç”¨ä¸¢å¼ƒæ³•åçš„ç¥ç»ç½‘ç»œç»“æ„&lt;/p>
&lt;p style="text-align:center">&lt;img src="https://yibocat.github.io/images/dl/dl-20220215-09.png" style="width:50%;" />&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ° $h_2$ å’Œ $h_5$ éƒ½è¢«æ¸…é›¶ï¼Œå› æ­¤åå‘ä¼ æ’­æ—¶ä¸ $h_2$ å’Œ $h_5$ ç›¸å…³çš„æƒé‡çš„æ¢¯åº¦ä¸º 0ã€‚&lt;/p>
&lt;p>ä¸ºä»€ä¹ˆä¸¢å¼ƒæ³•èµ·åˆ°æ­£åˆ™åŒ–çš„ä½œç”¨ï¼Ÿå’Œæ­£åˆ™åŒ–ä¸€æ ·ï¼Œä¸¢å¼ƒæ³•ä¹Ÿæ˜¯ä¸ºäº†ä»å‡å°æ¨¡å‹å¤æ‚åº¦å‡ºå‘æ¥é˜²æ­¢è¿‡æ‹Ÿåˆçš„ï¼Œå› ä¸ºéšæœºå‡å°‘éšè—å•å…ƒå’Œç¼©å°ç»´åº¦æ˜¯ä¸€æ ·çš„é“ç†ã€‚é‚±é”¡é¹æ•™æˆçš„ã€Šç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ ã€‹ä¸­ç»™å‡ºäº†ä¸¤ç§è§£é‡Šï¼š&lt;strong>é›†æˆå­¦ä¹ è§’åº¦&lt;/strong>çš„è§£é‡Šå’Œ&lt;strong>è´å¶æ–¯å­¦ä¹ è§’åº¦&lt;/strong>çš„è§£é‡Šã€‚&lt;/p>
&lt;/br>
&lt;p>&lt;strong>é›†æˆå­¦ä¹ è§’åº¦çš„è§£é‡Š&lt;/strong>&lt;/p>
&lt;p>æ¯åšä¸€æ¬¡ä¸¢å¼ƒï¼Œç›¸å½“äºä»åŸå§‹çš„ç½‘ç»œä¸­é‡‡æ ·å¾—åˆ°ä¸€ä¸ªå­ç½‘ç»œï¼Œè‹¥ä¸€ä¸ªç¥ç»ç½‘ç»œæœ‰ $n$ ä¸ªç¥ç»å…ƒï¼Œé‚£ä¹ˆæ€»å…±å¯ä»¥é‡‡æ ·å‡º $2^n$ ä¸ªå­ç½‘ç»œã€‚æ¯æ¬¡è¿­ä»£éƒ½ç›¸å½“äºè®­ç»ƒä¸€ä¸ªä¸åŒçš„å­ç½‘ç»œï¼Œè¿™äº›å­ç½‘ç»œéƒ½å…±äº«åŸå§‹ç½‘ç»œçš„å‚æ•°ï¼Œæ‰€ä»¥æœ€ç»ˆçš„ç½‘ç»œå¯ä»¥è¿‘ä¼¼çœ‹ä½œæ˜¯é›†æˆäº†æŒ‡æ•°çº§ä¸ªä¸åŒç½‘ç»œçš„ç»„åˆæ¨¡å‹ã€‚&lt;/p>
&lt;/br>
&lt;p>&lt;strong>è´å¶æ–¯å­¦ä¹ è§’åº¦çš„è§£é‡Š&lt;/strong>ï¼ˆä¸æ˜¯å¤ªæ˜ç™½&amp;hellip;&amp;hellip;ï¼‰&lt;/p>
&lt;p>ä¸¢å¼ƒæ³•å¯ä»¥è§£é‡Šä¸ºä¸€ç§è´å¶æ–¯å­¦ä¹ çš„è¿‘ä¼¼ï¼Œç”¨ $y=f(\pmb{x};\theta)$ æ¥è¡¨ç¤ºè¦å­¦ä¹ çš„ç¥ç»ç½‘ç»œï¼Œè´å¶æ–¯å­¦ä¹ æ—¶å‡è®¾å‚æ•° $\theta$ ä¸ºéšæœºå‘é‡ï¼Œå¹¶ä¸”å…ˆéªŒåˆ†å¸ƒä¸º $q(\theta)$ ï¼Œè´å¶æ–¯æ–¹æ³•çš„é¢„æµ‹ä¸º
$$
\mathbb{E}_{q(\theta)}[y]=\int_qf(\pmb{x};\theta)q(\theta)d\theta\approx\frac{1}{M} \sum^M f(\pmb{x},\theta_i)
$$
å…¶ä¸­ $f(\pmb{x},\theta_i)$ ä¸ºç¬¬ $i$ æ¬¡ä½¿ç”¨ä¸¢å¼ƒæ³•åçš„ç½‘ç»œï¼Œå…¶å‚æ•° $\theta_i$ ä¸ºå¯¹å…¨éƒ¨å‚æ•° $\theta$ çš„ä¸€æ¬¡é‡‡æ ·ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="æ‰‹åŠ¨å®ç°ä¸¢å¼ƒæ³•">æ‰‹åŠ¨å®ç°ä¸¢å¼ƒæ³•&lt;/h3>
&lt;p>å®šä¹‰ &lt;code>dropout()&lt;/code> å‡½æ•°ä»¥ &lt;code>drop_prob&lt;/code> çš„æ¦‚ç‡ä¸¢å¼ƒã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="k">def&lt;/span> &lt;span class="nf">dropout&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">drop_prob&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="n">X&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">X&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">float&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">assert&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">drop_prob&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;span class="n">keep_prob&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">drop_prob&lt;/span>
&lt;span class="c1"># è¿™ç§æƒ…å†µä¸‹æŠŠå…¨éƒ¨å…ƒç´ éƒ½ä¸¢å¼ƒ&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">keep_prob&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zeros_like&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">mask&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">shape&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">keep_prob&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">float&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="n">mask&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">X&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">keep_prob&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>å®šä¹‰æ¨¡å‹å‚æ•°&lt;/strong>&lt;/p>
&lt;p>è¿™é‡Œç»§ç»­ä½¿ç”¨åŸä¹¦ä¸­çš„ Fashion-MNIST æ•°æ®é›†ã€‚ç„¶åå®šä¹‰ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªéšè—å±‚çš„å¤šå±‚æ„ŸçŸ¥æœºï¼Œä¸”ä¸¤ä¸ªéšè—å±‚çš„è¾“å‡ºä¸ªæ•°å‡ä¸º 256ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">num_inputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_outputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_hiddens1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_hiddens2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">784&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">256&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">256&lt;/span>
&lt;span class="n">W1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.01&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">num_inputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_hiddens1&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">float&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">requires_grad&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">b1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zeros&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">num_hiddens1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">requires_grad&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">W2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.01&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">num_hiddens1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_hiddens2&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">float&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">requires_grad&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">b2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zeros&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">num_hiddens2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">requires_grad&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">W3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.01&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">num_hiddens2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_outputs&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">float&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">requires_grad&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">b3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zeros&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">num_outputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">requires_grad&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">params&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">W1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">W2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">W3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b3&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>å®šä¹‰æ¨¡å‹&lt;/strong>&lt;/p>
&lt;p>æ¨¡å‹å®šä¹‰éƒ¨åˆ†ä½¿ç”¨ &lt;code>ReLU&lt;/code> æ¿€æ´»å‡½æ•°ï¼Œç„¶åå¯¹æ¯ä¸ªæ¿€æ´»å‡½æ•°çš„è¾“å‡ºä½¿ç”¨ä¸¢å¼ƒæ³•ã€‚è¿™é‡Œæˆ‘ä»¬å°†ç¬¬ä¸€ä¸ªéšè—å±‚çš„ä¸¢å¼ƒæ¦‚ç‡è®¾ç½®ä¸º 0.1ï¼Œç¬¬äºŒä¸ªéšè—å±‚çš„ä¸¢å¼ƒæ¦‚ç‡è®¾ä¸º 0.6ï¼Œç„¶åé€šè¿‡å‚æ•° &lt;code>is_training&lt;/code> æ¥åˆ¤æ–­è¿è¡Œæ¨¡å¼æ˜¯è®­ç»ƒè¿˜æ˜¯æµ‹è¯•ï¼Œå¹¶åœ¨è®­ç»ƒæ¨¡å¼ä¸­ä½¿ç”¨ä¸¢å¼ƒæ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">drop_prob1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">drop_prob2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mf">0.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.6&lt;/span>
&lt;span class="k">def&lt;/span> &lt;span class="nf">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">is_training&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="n">X&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">X&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_inputs&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">H1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">matmul&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">W1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">b1&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">is_training&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="c1"># åªåœ¨è®­ç»ƒæ¨¡å‹æ—¶ä½¿ç”¨ä¸¢å¼ƒæ³•&lt;/span>
&lt;span class="n">H1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">dropout&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">H1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">drop_prob1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># åœ¨ç¬¬ä¸€å±‚å…¨è¿æ¥åæ·»åŠ ä¸¢å¼ƒå±‚&lt;/span>
&lt;span class="n">H2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">matmul&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">H1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">W2&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">b2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">is_training&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">H2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">dropout&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">H2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">drop_prob2&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># åœ¨ç¬¬äºŒå±‚å…¨è¿æ¥åæ·»åŠ ä¸¢å¼ƒå±‚&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">matmul&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">H2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">W3&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">b3&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>æ¨¡å‹è¯„ä¼°&lt;/strong>&lt;/p>
&lt;p>åœ¨å¯¹æ¨¡å‹è¿›è¡Œè¯„ä¼°çš„æ—¶å€™ä¸åº”è¯¥ä½¿ç”¨ä¸¢å¼ƒæ³•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="c1"># æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzh_pytorch&lt;/span>
&lt;span class="k">def&lt;/span> &lt;span class="nf">evaluate_accuracy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data_iter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="n">acc_sum&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">data_iter&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nb">isinstance&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Module&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">eval&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># è¯„ä¼°æ¨¡å¼, è¿™ä¼šå…³é—­dropout&lt;/span>
&lt;span class="n">acc_sum&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">argmax&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dim&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">float&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">train&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># æ”¹å›è®­ç»ƒæ¨¡å¼&lt;/span>
&lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="c1"># è‡ªå®šä¹‰çš„æ¨¡å‹&lt;/span>
&lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;is_training&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="vm">__code__&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">co_varnames&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="c1"># å¦‚æœæœ‰is_trainingè¿™ä¸ªå‚æ•°&lt;/span>
&lt;span class="c1"># å°†is_trainingè®¾ç½®æˆFalse&lt;/span>
&lt;span class="n">acc_sum&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">is_training&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">argmax&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dim&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">float&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">acc_sum&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">argmax&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dim&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">float&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">n&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">shape&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="n">acc_sum&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">n&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>è®­ç»ƒå’Œæµ‹è¯•&lt;/strong>&lt;/p>
&lt;p>æ¨¡å‹è®­ç»ƒ &lt;code>train_ch3()&lt;/code> ä½¿ç”¨å’Œå¤šå±‚æ„ŸçŸ¥æœºé‡Œä¸€æ ·çš„æ–¹æ³•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">num_epochs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.1&lt;/span>
&lt;span class="c1"># æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzhåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨&lt;/span>
&lt;span class="k">def&lt;/span> &lt;span class="nf">train_ch3&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">train_iter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">test_iter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">loss&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_epochs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">batch_size&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">params&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">optimizer&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">epoch&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">num_epochs&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="n">train_l_sum&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">train_acc_sum&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">train_iter&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">y_hat&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">l&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">loss&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">y_hat&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="c1"># æ¢¯åº¦æ¸…é›¶&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">optimizer&lt;/span> &lt;span class="ow">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="kc">None&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_grad&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">elif&lt;/span> &lt;span class="n">params&lt;/span> &lt;span class="ow">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="kc">None&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">params&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span> &lt;span class="ow">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="kc">None&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">param&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">params&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">param&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">optimizer&lt;/span> &lt;span class="ow">is&lt;/span> &lt;span class="kc">None&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">d2l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sgd&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">params&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">batch_size&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">step&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># â€œsoftmaxå›å½’çš„ç®€æ´å®ç°â€ä¸€èŠ‚å°†ç”¨åˆ°&lt;/span>
&lt;span class="n">train_l_sum&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">train_acc_sum&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">y_hat&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">argmax&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dim&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">n&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">shape&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>
&lt;span class="n">test_acc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">evaluate_accuracy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">test_iter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;epoch &lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s1">, loss &lt;/span>&lt;span class="si">%.4f&lt;/span>&lt;span class="s1">, train acc &lt;/span>&lt;span class="si">%.3f&lt;/span>&lt;span class="s1">, test acc &lt;/span>&lt;span class="si">%.3f&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>
&lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">epoch&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">train_l_sum&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">train_acc_sum&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">test_acc&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="n">train_ch3&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">train_iter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">test_iter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">cross_entropy&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_epochs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">batch_size&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">W&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">num_epochs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">batch_size&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">100.0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">256&lt;/span>
&lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CrossEntropyLoss&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">train_iter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">test_iter&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">d2l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">load_data_fashion_mnist&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">batch_size&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">d2l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">train_ch3&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">train_iter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">test_iter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">loss&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_epochs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">batch_size&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">params&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¾“å‡º&lt;/p>
&lt;pre tabindex="0">&lt;code>epoch 1, loss 0.0047, train acc 0.538, test acc 0.763
epoch 2, loss 0.0024, train acc 0.777, test acc 0.773
epoch 3, loss 0.0020, train acc 0.817, test acc 0.792
epoch 4, loss 0.0018, train acc 0.839, test acc 0.802
epoch 5, loss 0.0017, train acc 0.845, test acc 0.831
&lt;/code>&lt;/pre>&lt;/br>
&lt;p>æœ€åï¼ŒåŸä¹¦ä¸­è¿˜æœ‰ä¸¤ç§æ–¹æ³•çš„ç®€æ´å®ç°ï¼Œè¿™é‡Œä¸å†å†™äº†ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="å‚è€ƒ">å‚è€ƒ&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹PyTorch ç‰ˆï¼Œé˜¿æ–¯é¡¿Â·å¼ ã€ææ² &lt;a href="https://tangshusen.me/Dive-into-DL-PyTorch/#/"target="_blank" rel="noopener noreferrer">https://tangshusen.me/Dive-into-DL-PyTorch/#/&lt;/a>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ã€Šç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ ã€‹é‚±é”¡é¹ &lt;a href="https://nndl.github.io/"target="_blank" rel="noopener noreferrer">https://nndl.github.io&lt;/a>
&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>[æ·±åº¦å­¦ä¹ ç¬”è®°] æ·±åº¦å­¦ä¹ ç¬¬ 3 ç¯‡â€”â€”ç½‘ç»œæ­£åˆ™åŒ–</title><link>https://yibocat.github.io/posts/dl/sdxx_3/</link><pubDate>Mon, 14 Feb 2022 21:54:56 +0800</pubDate><guid>https://yibocat.github.io/posts/dl/sdxx_3/</guid><description>&lt;p>åœ¨å­¦ä¹ æ­£åˆ™åŒ–ä¹‹å‰ï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹&lt;strong>ç»éªŒè¯¯å·®&lt;/strong>å’Œ&lt;strong>æ³›åŒ–è¯¯å·®&lt;/strong>ä¸&lt;strong>è¿‡æ‹Ÿåˆ&lt;/strong>å’Œ&lt;strong>æ¬ æ‹Ÿåˆ&lt;/strong>ï¼Œç„¶åç»™å‡ºæ¨¡å‹å¤æ‚åº¦ç”¨æ¥åˆ¤å®šä¸€ä¸ªæ¨¡å‹çš„å¥½åï¼Œç„¶åå­¦ä¹ ç½‘ç»œæ­£åˆ™åŒ–ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="ç»éªŒè¯¯å·®ä¸æ³›åŒ–è¯¯å·®">ç»éªŒè¯¯å·®ä¸æ³›åŒ–è¯¯å·®&lt;/h3>
&lt;p>ä»€ä¹ˆæ˜¯ç»éªŒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®ï¼Ÿé€šä¿—çš„æ¥è®²ï¼Œç»éªŒè¯¯å·®ï¼ˆEmpirical Errorï¼‰å°±æ˜¯æŒ‡æ¨¡å‹åœ¨è®­ç»ƒæ•°æ®é›†ä¸Šçš„è¡¨ç°å‡ºæ¥çš„è¯¯å·®ï¼Œæ³›åŒ–è¯¯å·®ï¼ˆGeneralization Errorï¼‰æ˜¯æŒ‡æ¨¡å‹åœ¨ä»»æ„æ–°æ ·æœ¬ä¸Šçš„è¯¯å·®ã€‚&lt;/p>
&lt;/br>
&lt;p>å…·ä½“æ¥çœ‹ï¼Œç»™å®šä¸€ä¸ªæ¨¡å‹ $f(x;\theta)$ ï¼Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯è¿™ä¸ªæ¨¡å‹æœ‰ä¸€ä¸ªå°çš„æœŸæœ›è¯¯å·®ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“çœŸå®çš„æ•°æ®åˆ†å¸ƒå’Œæ˜ å°„å‡½æ•°ï¼Œæ‰€ä»¥æ— æ³•è®¡ç®—æœŸæœ›è¯¯å·®ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥è®¡ç®—çš„æ˜¯ç»éªŒè¯¯å·®ï¼Œå³æ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šçš„è¯¯å·®ï¼Œä¹Ÿå°±æ˜¯è®­ç»ƒé›†ä¸Šçš„&lt;strong>å¹³å‡æŸå¤±&lt;/strong>
$$
E_{D}^{emp}(\theta)=\frac{1}{m}\sum_{i=1}^m\mathbb{L}(y^{(i)},f(x^{(i)};\theta))
$$
è¿™é‡Œ $E_D^{emp}(\theta)$ è¡¨ç¤ºåœ¨è®­ç»ƒé›† $D$ ä¸Šçš„å‚æ•°ä¸º $\theta$ çš„å¹³å‡ç»éªŒè¯¯å·®ï¼Œå‡è®¾æœ‰ $m$ ä¸ªè®­ç»ƒæ•°æ®ï¼Œ$\mathbb{L}$ è¡¨ç¤ºæ¯ä¸ªè®­ç»ƒæ•°æ®é›†çš„çœŸå®æ ‡ç­¾ä¸æ¨¡å‹ $f(x^{(i)};\theta)$ å¾—åˆ°çš„æ ‡ç­¾ä¹‹é—´çš„è¯¯å·®å‡½æ•°ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬é¦–å…ˆå¸Œæœ›å¾—åˆ°çš„æ¨¡å‹ä¸€å®šæ˜¯æœ‰è¾ƒå°çš„å¹³å‡ç»éªŒè¯¯å·®ã€‚é€šä¿—çš„è®²ï¼Œæˆ‘ä»¬çš„æ¨¡å‹æœ€åŸºæœ¬çš„è¦æ±‚é¦–å…ˆæ˜¯è¦åœ¨è®­ç»ƒé›†ä¸Šçš„è¯¯å·®æœ€å°å§ï¼Œä¹Ÿå°±æ˜¯æš‚ä¸”è®©æ¨¡å‹æ»¡è¶³è®­ç»ƒé›†ä¸Šçš„æ•°æ®è¯¯å·®æœ€å°ï¼ˆæ‰¯äº†ä¸‰å¥å•°å—¦è¯ï¼Œå…¶å®æ˜¯ä¸€ä¸ªæ„æ€ï¼‰ã€‚è¿™ä¹Ÿå°±æ˜¯å¸¸è¯´çš„&lt;strong>ç»éªŒé£é™©æœ€å°åŒ–å‡†åˆ™ï¼ˆEmpirical Risk Minimization , ERMï¼‰&lt;/strong>ã€‚&lt;/p>
&lt;/br>
&lt;p>æ¥ç€æ¥çœ‹æ³›åŒ–è¯¯å·®ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å‡è®¾ä»»æ„æ ·æœ¬é›†ä¸º $\mathcal{D}$ ï¼Œåˆ™æ³›åŒ–è¯¯å·®çš„è¡¨ç¤ºä¸º
$$
E_{\mathcal{D}}(\theta) = P_{x\thicksim\mathcal{D}}(y\ne f(x;\theta))
$$
è¿™ä¸ªå…¬å¼å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œ$P_{x\thicksim\mathcal{D}}$ è¡¨ç¤º $x$ åœ¨ä»»æ„æ ·æœ¬ä¸‹çš„è¯¯å·®ï¼ˆæˆ–è€…è¯´å¹³å‡è¯¯å·®ï¼‰ï¼Œè€Œä»»æ„æ–°æ ·æœ¬çš„æ ‡ç­¾ä¸ç­‰äºè¯¥æ¨¡å‹å¯¹è¯¥æ ·æœ¬æ•°æ®ä¸‹çš„æ ‡ç­¾ï¼ˆå…¬å¼å¯èƒ½ä¸å¤ªæ­£ç¡®ï¼Œå¤§æ¦‚æ„æ€æ˜¯ä¸€æ ·çš„ï¼‰ã€‚&lt;/p>
&lt;/br>
&lt;p>ä»¥ä¸Šæˆ‘ä»¬çŸ¥é“äº†ä»€ä¹ˆæ˜¯ç»éªŒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®ã€‚æˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªæ¨¡å‹å¯ä»¥æ»¡è¶³ ERMã€‚&lt;/p>
&lt;p>ä½†æ˜¯ï¼ä½†æ˜¯ï¼ï¼ï¼æˆ‘ä»¬ä¸èƒ½è®©ç»éªŒé£é™©æ— ç©·å°ï¼ˆå¤¸å¼ ï¼‰ï¼è¿‡å°çš„ç»éªŒé£é™©è™½ç„¶ä¼šè®©æ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šçš„è¡¨ç°éå¸¸å¥½ï¼Œä½†æ˜¯ä¼šé€ æˆè¿‡æ‹Ÿåˆï¼è¿™æ„å‘³ç€æˆ‘ä»¬çš„æ¨¡å‹é€‚åˆä¸”ä»…é€‚åˆè®­ç»ƒæ•°æ®é›†ï¼å¤ªå¥½äº†ä¹Ÿä¸æ˜¯ä»¶å¥½äº‹ï¼Œæ‰€è°“ç‰©æå¿…åã€‚&lt;/p>
&lt;p>è¿™ä¹Ÿå°±é€ æˆäº†è¿‡æ‹Ÿåˆç°è±¡ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="è¿‡æ‹Ÿåˆä¸æ¬ æ‹Ÿåˆ">è¿‡æ‹Ÿåˆä¸æ¬ æ‹Ÿåˆ&lt;/h3>
&lt;p>ä¸Šæ–‡è®²è¿‡ï¼Œè¿‡æ‹Ÿåˆçš„æ„æ€å°±æ˜¯ä¸€ä¸ªè®­ç»ƒå¥½çš„æ¨¡å‹åªåœ¨è®­ç»ƒé›†ä¸Šè¡¨ç°éå¸¸å¥½ï¼Œä½†æ˜¯æ— æ³•ç”¨åœ¨æ–°çš„æ•°æ®é›†ï¼Œæˆ–è€…è¯´æµ‹è¯•é›†ä¸Šã€‚é€šå¸¸é€ æˆè¿‡æ‹Ÿåˆçš„åŸå› æ˜¯è®­ç»ƒæ•°æ®é›†è¿‡å°‘ï¼Œæˆ–è€…å¯ä»¥è¿™ä¹ˆè¯´ï¼Œè¿‡æ‹Ÿåˆäº§ç”Ÿçš„åŸå› æ˜¯æ•°æ®é›†ä¸æ¨¡å‹å¤æ‚åº¦ä¸åŒ¹é…ï¼Œå³è®­ç»ƒæ•°æ®é›†çš„æ•°é‡æ— æ³•æ”¯æ’‘é«˜å¤æ‚åº¦çš„æ¨¡å‹ã€‚è€Œç¥ç»ç½‘ç»œé€šå¸¸æ˜¯ä¸€ä¸ªè¶…é«˜å¤æ‚åº¦çš„æ¨¡å‹ï¼Œè¿‡å°‘çš„æ•°æ®é›†å¾ˆå®¹æ˜“é€ æˆè¿‡æ‹Ÿåˆç°è±¡ã€‚&lt;/p>
&lt;p>æ¬ æ‹Ÿåˆåˆ™å¾ˆå¥½ç†è§£ï¼ŒæŒ‡çš„æ˜¯æ¨¡å‹è¾ƒå¼±çš„å­¦ä¹ èƒ½åŠ›å½¢æˆçš„å¯¼è‡´æ³›åŒ–èƒ½åŠ›ä¸é«˜çš„ç°è±¡ã€‚æ€»çš„æ¥è¯´ï¼Œè¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆéƒ½æ˜¯ç”±äºæ¨¡å‹å¤æ‚åº¦ä¸æ•°æ®é›†ä¸åŒ¹é…é€ æˆçš„ã€‚&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä»¬çœ‹ä¸€ä¸‹ä»€ä¹ˆæ˜¯æ¨¡å‹å¤æ‚åº¦è¿™ä¸ªæ¦‚å¿µã€‚&lt;/p>
&lt;/br>
&lt;h3 id="æ¨¡å‹å¤æ‚åº¦">æ¨¡å‹å¤æ‚åº¦&lt;/h3>
&lt;p>é¦–å…ˆæˆ‘ä»¬ä»¥å¤šé¡¹å¼æ‹Ÿåˆä¸ºä¾‹ã€‚ç»™å®šä¸€ä¸ªç”±æ ‡é‡æ•°æ®ç‰¹å¾ $x$ å’Œå¯¹åº”çš„æ ‡é‡æ ‡ç­¾ $y$ ç»„æˆçš„è®­ç»ƒæ•°æ®é›†ï¼Œå¤šé¡¹å¼å‡½æ•°æ‹Ÿåˆçš„ç›®æ ‡æ˜¯æ‰¾åˆ°ä¸€ä¸ª $K$ é˜¶å¤šé¡¹å¼å‡½æ•°
$$
\hat{y}=b+\sum_{k=1}^Kx^k\omega_k
$$
æ¥è¿‘ä¼¼ $y$ã€‚ä¸Šå¼ä¸­ï¼Œ$\omega_k$ è¡¨ç¤ºæ¨¡å‹çš„æƒé‡å‚æ•°ï¼Œ$b$ è¡¨ç¤ºåå·®å‚æ•°ã€‚è€Œå¤šé¡¹å¼å‡½æ•°æ‹Ÿåˆä¹Ÿæ˜¯ç”¨å¹³æ–¹æŸå¤±å‡½æ•°ã€‚ç‰¹åˆ«çš„ï¼Œä¸€é˜¶å¤šé¡¹å¼å‡½æ•°æ‹Ÿåˆåˆå«çº¿æ€§å‡½æ•°æ‹Ÿåˆã€‚&lt;/p>
&lt;p>ä»ä¸Šå¼å¯ä»¥çœ‹åˆ°ï¼Œéšç€ $k$ è¶Šæ¥è¶Šå¤§ï¼Œæ¨¡å‹çš„å‚æ•°ä¹Ÿå°±è¶Šæ¥è¶Šå¤šï¼Œæ¨¡å‹å‡½æ•°çš„é€‰æ‹©ç©ºé—´æ›´å¤§ï¼Œæ‰€ä»¥é«˜é˜¶å¤šé¡¹å¼å‡½æ•°æ¯”ä½é˜¶å¤šé¡¹å¼å‡½æ•°çš„å¤æ‚åº¦æ›´é«˜ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€é«˜é˜¶å¤šé¡¹å¼å‡½æ•°æ¯”ä½é˜¶å¤šé¡¹å¼å‡½æ•°æ›´å®¹æ˜“åœ¨ç›¸åŒçš„è®­ç»ƒæ•°æ®é›†ä¸Šå¾—åˆ°æ›´ä½çš„è®­ç»ƒè¯¯å·®ã€‚è¿™ä¹Ÿå°±æ˜¯æ¨¡å‹å¤æ‚åº¦ã€‚&lt;/p>
&lt;p>ä¸‹å›¾å¯ä»¥å¾ˆæ¸…æ™°çš„çœ‹å‡ºï¼Œæ¨¡å‹å¤æ‚åº¦ä¸è¯¯å·®çš„å…³ç³»ä»¥åŠä»€ä¹ˆæ˜¯æ¬ æ‹Ÿåˆä¸è¿‡æ‹Ÿåˆ&lt;/p>
&lt;p style="text-align:center">&lt;img src="https://yibocat.github.io/images/dl/dl-20220214-07.png" style="width:50%;" />&lt;/p>
&lt;p>å…³äºè¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆçš„å®éªŒï¼Œå¯ä»¥æŸ¥çœ‹åŸä¹¦&lt;a href="https://tangshusen.me/Dive-into-DL-PyTorch/#/chapter03_DL-basics/3.11_underfit-overfit"target="_blank" rel="noopener noreferrer">https://tangshusen.me/Dive-into-DL-PyTorch/#/chapter03_DL-basics/3.11_underfit-overfit&lt;/a>
&lt;/p>
&lt;h3 id="æ­£åˆ™åŒ–">æ­£åˆ™åŒ–&lt;/h3>
&lt;p>ç¥ç»ç½‘ç»œå› å…¶éå¸¸å¼ºçš„æ‹Ÿåˆèƒ½åŠ›å¾€å¾€ä½¿å¾—ç»éªŒè¯¯å·®å¯ä»¥é™åˆ°éå¸¸ä½ï¼Œä»è€Œé€ æˆè¿‡æ‹Ÿåˆç°è±¡ã€‚æ‰€ä»¥å¦‚ä½•æé«˜ç¥ç»ç½‘ç»œçš„æ³›åŒ–èƒ½åŠ›æ˜¯éå¸¸é‡è¦çš„ã€‚&lt;/p>
&lt;p>ä»ä¸Šæ–‡å¾—çŸ¥ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆå¯ä»¥ä»æ•°æ®å…¥æ‰‹ï¼Œå¢åŠ æ•°æ®é›†çš„æ•°é‡ï¼Œä½†æ˜¯å› ç¥ç»ç½‘ç»œå¼ºå¤§çš„æ‹Ÿåˆèƒ½åŠ›å¯ä»¥çŸ¥é“å…¶å¿…ç„¶æ˜¯ä¸€ä¸ªæ¨¡å‹å¤æ‚åº¦éå¸¸é«˜çš„æ¨¡å‹ï¼Œè¿™æ„å‘³ç€æ•°æ®é›†çš„é‡å‘ˆæŒ‡æ•°å¢é•¿ä»è€Œæ— æ³•æ»¡è¶³ç¥ç»ç½‘ç»œè¶…é«˜çš„å¤æ‚åº¦ï¼Œæ‰€ä»¥å¢åŠ æ•°æ®é›†çš„é‡æ˜¾ç„¶å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„æ–¹æ³•ã€‚æ‰€ä»¥åªèƒ½ä»å¦ä¸€ä¸ªè§’åº¦æ¥è€ƒè™‘ï¼Œå³é™åˆ¶æ¨¡å‹å¤æ‚åº¦ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„ç½‘ç»œæ­£åˆ™åŒ–ã€‚&lt;/p>
&lt;p>&lt;strong>æ­£åˆ™åŒ–ï¼ˆRegularizationï¼‰&lt;/strong> æ˜¯ä¸€ç§é€šè¿‡&lt;strong>é™åˆ¶æ¨¡å‹å¤æ‚åº¦&lt;/strong>æ¥é¿å…è¿‡æ‹Ÿåˆçš„æ–¹æ³•ï¼Œå¸¸ç”¨çš„æ­£åˆ™åŒ–æ–¹æ³•æœ‰æƒé‡è¡°å‡ã€ä¸¢å¼ƒæ³•ç­‰ã€‚&lt;/p>
&lt;/br>
&lt;p>&lt;strong>$\ell_1,\ell_2$ æ­£åˆ™åŒ–&lt;/strong>&lt;/p>
&lt;p>$\ell_1,\ell_2$ æ­£åˆ™åŒ–ä¹Ÿç§°ä½œèŒƒæ•°æ­£åˆ™åŒ–ï¼Œæ˜¯æœºå™¨å­¦ä¹ ä¸­æœ€å¸¸ç”¨çš„æ­£åˆ™åŒ–æ–¹æ³•ã€‚å…¶é€šè¿‡çº¦æŸå‚æ•°çš„ $\ell_1$ å’Œ $\ell_2$ èŒƒæ•°æ¥å‡å°æ¨¡å‹åœ¨è®­ç»ƒæ•°æ®é›†ä¸Šçš„è¿‡æ‹Ÿåˆç°è±¡ã€‚æˆ‘ä»¬å°† $\ell_1$ å’Œ $\ell_2$ åŠ å…¥åˆ°ä¼˜åŒ–é—®é¢˜ä¸­
$$
\mathcal{J}(\theta) = arg\min_{\theta}\frac{1}{N}\sum_{n=1}^N\mathcal{L}(y^{(n)},f(x^{(n)};\theta))+\lambda\ell_p(\theta)
$$
$\mathcal{L}()$ è¡¨ç¤ºæŸå¤±å‡½æ•°ï¼Œ$N$ ä¸ºè®­ç»ƒæ ·æœ¬æ•°é‡ï¼Œ$f()$ è¡¨ç¤ºå¾…å­¦ä¹ çš„ç¥ç»ç½‘ç»œï¼Œ$\ell_p$ è¡¨ç¤ºèŒƒæ•°å‡½æ•°ï¼Œè¿™é‡Œ $p$ è¡¨ç¤ºç¬¬ $p$ èŒƒæ•°ï¼Œè¿™é‡Œå–å€¼ä¸º ${1,2}$ è¡¨ç¤º $\ell_1,\ell_2$ èŒƒæ•°ï¼Œ$\lambda$ ä¸ºæ­£åˆ™åŒ–ç³»æ•°ã€‚&lt;/p>
&lt;/br>
&lt;p>æ€ä¹ˆç†è§£è¿™ä¸ªå¼å­å‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬çœ‹ç­‰å¼å³è¾¹çš„å‰åŠéƒ¨åˆ†ï¼Œè¿™å…¶å®å°±æ˜¯ä¸Šæ–‡ä¸­æ‰€æåˆ°çš„ç»éªŒè¯¯å·®æœ€å°åŒ–å¼å­ã€‚æˆ‘ä»¬å‡è®¾ $\lambda$ æ— é™å°äº 0 å³ç­‰ä»·äº 0 ï¼Œæ­¤æ—¶è¯¥å¼å­é€€åŒ–ä¸ºç»éªŒè¯¯å·®æœ€å°åŒ–ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„åªè€ƒè™‘å¢å¤§è®­ç»ƒé›†æ•°æ®é‡æ¥é˜²æ­¢è¿‡æ‹Ÿåˆã€‚è€ŒåŠ å…¥æ­£åˆ™åŒ–é¡¹åï¼Œéšç€ $\lambda$ çš„å€¼è¶Šæ¥è¶Šå¤§ï¼ŒèŒƒæ•°å‡½æ•°åœ¨ç­‰å¼ä¸­çš„ä½œç”¨è¶Šæ¥è¶Šå¤§ï¼Œè€Œè¯¥å‡½æ•°æ­£æ˜¯æ¥é™åˆ¶æ¨¡å‹å¤æ‚åº¦çš„ï¼Œæ‰€ä»¥è¯¥å¼å­é€šè¿‡åŠ å…¥äº†æ­£åˆ™é¡¹ï¼Œæ¥é™åˆ¶æ¨¡å‹çš„å¤æ‚åº¦ã€‚&lt;/p>
&lt;p>è‡³äº $\ell_1$ å’Œ $\ell_2$ æ˜¯å¦‚ä½•é™åˆ¶æ¨¡å‹çš„ï¼Œè¿™æ¶‰åŠåˆ°æ•°å­¦é—®é¢˜äº†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚&lt;/p>
&lt;/br>
&lt;p>ç®—äº†&amp;hellip;åšç¬”è®° &amp;hellip; è¿˜æ˜¯è¯¦ç»†ä¸€ç‚¹ &amp;hellip;&lt;/p>
&lt;/br>
&lt;p>&lt;strong>æ­£åˆ™åŒ–é¡¹å¦‚ä½•å½±å“æ¨¡å‹&lt;/strong>&lt;/p>
&lt;p>æˆ‘ä»¬å°†ä¸Šå¼ç­‰å¼çš„å³è¾¹ç¬¬ä¸€éƒ¨åˆ†ç®€åŒ–ä¸€ä¸‹ï¼Œç”¨ $E^{emp}(\theta)$ è¡¨ç¤ºï¼Œåˆ™ä¼˜åŒ–é—®é¢˜å¯ä»¥å†™æˆ
$$
\mathcal{J}(\theta)=E^{emp}(\theta)+\lambda\ell_p(\theta)
$$
é¦–å…ˆçœ‹è¿™ä¸ªå¼å­ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯ä¸ºäº†è®© $\mathcal{J}(\theta)$ æœ€å°åŒ–ï¼Œåœ¨ä¸è€ƒè™‘æ­£åˆ™åŒ–é¡¹çš„æ—¶å€™ï¼Œ$\mathcal{J}(\theta)$ ç­‰ä»·äºç»éªŒè¯¯å·®æœ€å°åŒ–ã€‚è€ŒåŠ å…¥æ­£åˆ™åŒ–é¡¹ä¹‹åå°±è¦ç»¼åˆè€ƒè™‘ä¸¤é¡¹äº†ï¼ˆè¿™é‡Œçœ‹ä¼¼åºŸè¯ï¼Œå®åˆ™æ˜¯å¾ªåºæ¸è¿›ï¼‰ã€‚è€Œä¸ºäº†ä½¿å¾— $\mathcal{J}(\theta)$ æœ€å°åŒ–ï¼Œæ­£åˆ™åŒ–é¡¹ä¹Ÿè¦è¶Šå°è¶Šå¥½ã€‚&lt;/p>
&lt;p>è¿™é‡Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ 1-èŒƒæ•°å’Œ 2-èŒƒæ•°çš„å®šä¹‰&lt;/p>
&lt;blockquote>
&lt;p>å‘é‡çš„ 1-èŒƒæ•°ï¼š$\vert\vert X\vert\vert_1 = \sum_{i=1}^n\vert x_i\vert$ ï¼Œè¡¨ç¤ºå‘é‡å†…å„å…ƒç´ çš„ç»å¯¹å€¼ä¹‹å’Œ&lt;/p>
&lt;p>å‘é‡çš„ 2-èŒƒæ•°ï¼š$\vert\vert X\vert\vert_2=(\sum_{i=1}^nx_i^2)^{\frac{1}{2}}$ ï¼Œè¡¨ç¤ºå…ƒç´ çš„å¹³æ–¹å’Œå†å¼€å¹³æ–¹&lt;/p>
&lt;/blockquote>
&lt;/br>
&lt;p>è¿™æ—¶å€™æˆ‘ä»¬å†çœ‹ï¼Œ1-èŒƒæ•°ä¸ºä¾‹ï¼Œæˆ‘ä»¬è¦è®©æ­£åˆ™åŒ–é¡¹è¶Šå°ï¼Œæ„å‘³ç€ $\theta$ è¦è®© $\sum_{i=1}^n\vert\theta_i\vert$ å°½å¯èƒ½å°ï¼Œè¿™æ · $\theta_i$ å°±è¢«é™åˆ¶ä½äº†ã€‚è€Œ $\theta_i$ æ˜¯ä»€ä¹ˆï¼Ÿä¸å°±æ˜¯å‚æ•°å—ï¼Ÿæˆ‘ä»¬ä¸å…‰è¦è®©å‚æ•°å°½å¯èƒ½å°ï¼Œè€Œä¸”è¿˜è¦è®©å‚æ•°çš„æ•°é‡å°½å¯èƒ½å¾—å°‘ï¼$\theta_i$ è¢«é™åˆ¶ä½ï¼Œæ›²çº¿ä¹Ÿå°±ä¸ä¼šå¤ªè¿‡é™¡å³­ã€‚è¿™ç§æ­£åˆ™åŒ–çš„æ–¹å¼è¢«ç§°ä¸º&lt;/p>
&lt;p>&lt;strong>Lasso å›å½’ï¼ˆLeast Absolute Shrinkage and Selection operator Regression)&lt;/strong> ã€‚&lt;/p>
&lt;/br>
&lt;p>&lt;strong>1-èŒƒæ•°æ­£åˆ™åŒ–&lt;/strong>&lt;/p>
&lt;p>L1 æ­£åˆ™åŒ–é¡¹ä¸ç¨€ç–æ€§æœ‰å…³ï¼Œå³ L1 æ­£åˆ™åŒ–å¯ä»¥ä½¿å¾—å‚æ•°ç¨€ç–åŒ–ä»è€Œå‡å°æ¨¡å‹å¤æ‚åº¦ã€‚ä»€ä¹ˆæ˜¯ç¨€ç–æ€§ï¼Ÿé€šå¸¸ç¥ç»ç½‘ç»œä¸­çš„ç‰¹å¾ä¼šè¾¾åˆ°ä¸€ä¸ªéå¸¸å¤§çš„æ•°é‡ï¼Œå¦‚æœæ¨¡å‹çš„å‚æ•°æœ‰éå¸¸å¤šçš„ 0ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†å¾ˆå¤šçš„å‚æ•°ç¨€ç–æ‰ã€‚è€Œ L1 æ­£åˆ™åŒ–é¡¹ç›¸å½“äºå¯¹æ¨¡å‹è¿›è¡Œäº†ä¸€æ¬¡ç‰¹å¾é€‰æ‹©ï¼Œåªç•™ä¸‹é‡è¦çš„ç‰¹å¾ï¼Œä»è€Œæé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆã€‚&lt;/p>
&lt;/br>
&lt;p>æˆ‘ä»¬å‡è®¾ä¸€ä¸ªäºŒç»´å‚æ•°ç©ºé—´ï¼ŒæŸå¤±å‡½æ•°çš„ç­‰é«˜çº¿å¦‚ä¸‹æ‰€ç¤º&lt;/p>
&lt;p style="text-align:center">&lt;img src="https://yibocat.github.io/images/dl/dl-20220215-01.jpeg" style="width:40%" />&lt;/p>
&lt;p>è¿™æ—¶ L1 æ­£åˆ™åŒ–ä¸º $\vert \theta_1\vert+\vert\theta_2\vert$ ï¼Œå¯¹åº”çš„ç­‰é«˜çº¿æ˜¯ä¸€ä¸ªè±å½¢ã€‚å½“ä¸åŠ å¦‚æ­£åˆ™åŒ–é¡¹çš„æ—¶å€™ï¼Œä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•ä¼˜åŒ–æŸå¤±å‡½æ•°ï¼Œä»–ä¼šæ²¿ç€æ¢¯åº¦æ–¹å‘ä¸‹é™è€Œå¾—åˆ°ä¸€ä¸ªè¿‘ä¼¼çš„æœ€ä¼˜è§£&lt;/p>
&lt;p style="text-align:center">&lt;img src="https://yibocat.github.io/images/dl/dl-20220215-02.jpeg" style="width:40%" />&lt;/p>
&lt;p>è€ŒåŠ å…¥L1æ­£åˆ™åŒ–åï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚$P,Q$ ä¸¤ç‚¹åœ¨åŒä¸€ç­‰é«˜çº¿ä¸Šï¼Œå³ $P$ å’Œ $Q$ ä¸¤ä¸ªç‚¹çš„æŸå¤±å‡½æ•°æ˜¯ç­‰ä»·çš„ã€‚ä½†æ˜¯ï¼Œ$OP$ çš„è·ç¦»å¤§äº $OQ$ çš„è·ç¦»&lt;/p>
&lt;p style="text-align:center">&lt;img src="https://yibocat.github.io/images/dl/dl-20220215-03.jpeg" style="width:40%" />&lt;/p>
&lt;p>å› æ­¤å¯ä»¥å¾—åˆ° $P$ ç‚¹çš„ç»éªŒæŸå¤±å‡½æ•°å¤§äº $Q$ ç‚¹çš„ç»éªŒæŸå¤±å‡½æ•°ï¼Œå› ä¸º $Q$ ç‚¹çš„ L1 èŒƒæ•°å°äº $P$ ç‚¹çš„ L1 èŒƒæ•°ï¼Œæ‰€ä»¥é€‰æ‹© $Q$ ç‚¹ï¼Œå…¶æ¬¡ï¼Œå½“æˆ‘ä»¬é€‰æ‹© $Q$ ç‚¹æ—¶ï¼Œå¯¹åº”çš„ $\theta_1=0$ ï¼Œè¿™æ°å¥½å°† $\theta_1$ å»æ‰äº†ï¼Œå¹¶ä¸”å¯¹åŸæ¨¡å‹å¹¶æ²¡æœ‰å½±å“ã€‚&lt;/p>
&lt;p>æ‰€ä»¥å¯ä»¥å¾—å‡ºç»“è®ºï¼Œå³åŠ ä¸Šæ­£åˆ™åŒ–é¡¹ï¼Œå‚æ•°ç©ºé—´ä¼šè¢«ç¼©å°ï¼Œä»è€Œå‡å°æ¨¡å‹å¤æ‚åº¦ã€‚&lt;/p>
&lt;/br>
&lt;p>&lt;strong>2-èŒƒæ•°æ­£åˆ™åŒ–&lt;/strong>&lt;/p>
&lt;p>å’Œ L1 æ­£åˆ™åŒ–æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å‡è®¾ä¸€ä¸ªäºŒç»´çš„å‚æ•°ç©ºé—´ï¼ŒL2 æ­£åˆ™åŒ–ä¸º $\theta_1^2+\theta_2^2$ ï¼Œè¿™æ—¶ L2 ç­‰é«˜çº¿æ˜¯ä¸€ä¸ªåŒå¿ƒåœ†&lt;/p>
&lt;p style="text-align:center">&lt;img src="https://yibocat.github.io/images/dl/dl-20220215-04.jpeg" style="width:40%" />&lt;/p>
&lt;p>åŒæ ·æˆ‘ä»¬ä½¿ç”¨ä¸Šè¿°æŸå¤±å‡½æ•°ä¸æŸå¤±å‡½æ•°ç­‰é«˜çº¿ï¼Œå¦‚å›¾æ‰€ç¤ºï¼ŒL2 æ­£åˆ™ä¸æŸå¤±ç­‰é«˜çº¿äº¤äº $P,Q$ ä¸¤ç‚¹ï¼Œå¯ä»¥çœ‹åˆ° $P$ ç‚¹è·ç¦» $Q$ ç‚¹æ›´æ¥è¿‘åŸç‚¹ï¼Œå³è·ç¦»çŸ­ã€‚ä½†æ˜¯æ­¤æ—¶ $\theta_1,\theta_2$ å‡ä¸ä¸º 0 ã€‚æ‰€ä»¥æˆ‘ä»¬è¯´ 2-èŒƒæ•°æ­£åˆ™åŒ–å¯ä»¥å¾—åˆ°å°½å¯èƒ½å°çš„è§£ï¼Œä½†æ˜¯ä¸å…·æœ‰ç¨€ç–æ€§ã€‚è€Œ L2 æ­£åˆ™åŒ–æ–¹æ³•ä¹Ÿæ˜¯å²­å›å½’æ–¹æ³•ã€‚&lt;/p>
&lt;p style="text-align:center">&lt;img src="https://yibocat.github.io/images/dl/dl-20220215-05.jpeg" style="width:40%" />&lt;/p>
&lt;p>åˆ°è¿™ï¼Œæˆ‘ä»¬äº†è§£äº†æ­£åˆ™åŒ–é¡¹æ˜¯å¦‚ä½•å½±å“åˆ°æ¨¡å‹çš„å¤æ‚åº¦çš„ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="æ€»ç»“">æ€»ç»“&lt;/h3>
&lt;p>è®­ç»ƒæ¨¡å‹çš„ç›®çš„æ˜¯ä¸ºäº†ç»éªŒé£é™©æœ€å°åŒ–ï¼Œè€Œè¿‡äºè¿½æ±‚ç»éªŒé£é™©æœ€å°åŒ–ä¼šé€ æˆè¿‡æ‹Ÿåˆã€‚&lt;/p>
&lt;/br>
&lt;p>ä¸è®ºæ˜¯è¿‡æ‹Ÿåˆè¿˜æ˜¯æ¬ æ‹Ÿåˆï¼Œå…¶äº§ç”Ÿçš„åŸå› æ˜¯ç”±äºæ¨¡å‹å¤æ‚åº¦ä¸æ•°æ®é›†ä¸åŒ¹é…é€ æˆçš„ï¼Œè§£å†³æ–¹æ³•æœ‰ä¸¤ä¸ªï¼š1.ä»æ•°æ®é›†å…¥æ‰‹ï¼ˆä¸æ¨èï¼‰ï¼›2.ä»æ¨¡å‹å¤æ‚åº¦å…¥æ‰‹ï¼ˆæ­£åˆ™åŒ–ï¼‰&lt;/p>
&lt;/br>
&lt;p>æ­£åˆ™åŒ–é€šè¿‡æ·»åŠ æ­£åˆ™é¡¹æ¥å¯¹æ¨¡å‹å¤æ‚åº¦åŠ ä»¥é™åˆ¶ï¼Œä»è€Œé¿å…è¿‡æ‹Ÿåˆ&lt;/p>
&lt;/br>
&lt;p>æ­£åˆ™åŒ–å¦‚ä½•å½±å“æ¨¡å‹å¤æ‚åº¦ï¼šLasso å›å½’ï¼ˆå…·æœ‰ç¨€ç–æ€§ï¼‰ä¸å²­å›å½’ï¼ˆä¸å…·æœ‰ç¨€ç–æ€§ï¼‰ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="å‚è€ƒ">å‚è€ƒ&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>ã€Šæœºå™¨å­¦ä¹ ã€‹å‘¨å¿—å&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹PyTorch ç‰ˆï¼Œé˜¿æ–¯é¡¿Â·å¼ ã€ææ² &lt;a href="https://tangshusen.me/Dive-into-DL-PyTorch/#/"target="_blank" rel="noopener noreferrer">https://tangshusen.me/Dive-into-DL-PyTorch/#/&lt;/a>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ã€Šç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ ã€‹é‚±é”¡é¹ &lt;a href="https://nndl.github.io/"target="_blank" rel="noopener noreferrer">https://nndl.github.io&lt;/a>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¦‚ç‡è¿‘ä¼¼æ­£ç¡®ï¼Ÿï¼ï¼ˆPAC Learningï¼‰ - Haoran Jiangçš„æ–‡ç«  - çŸ¥ä¹ &lt;a href="https://zhuanlan.zhihu.com/p/44589648"target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/44589648&lt;/a>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>[è®¡ç®—å­¦ä¹ ç†è®º] PAC (Probably Approximately Correct)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ï¼ˆç†è®º+ä»£ç ï¼‰ç†è§£æ¨¡å‹æ­£åˆ™åŒ–ï¼šL1æ­£åˆ™ã€L2æ­£åˆ™ - é¥¼å¹²Japsonçš„æ–‡ç«  - çŸ¥ä¹ &lt;a href="https://zhuanlan.zhihu.com/p/113373391"target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/113373391&lt;/a>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Lassoâ€”åŸç†åŠæœ€ä¼˜è§£ - é£ç£çš„æ–‡ç«  - çŸ¥ä¹ &lt;a href="https://zhuanlan.zhihu.com/p/116869931"target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/116869931&lt;/a>
&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>[æ·±åº¦å­¦ä¹ ç¬”è®°] æ·±åº¦å­¦ä¹ ç¬¬ 2 ç¯‡â€”â€”å¤šå±‚æ„ŸçŸ¥æœº</title><link>https://yibocat.github.io/posts/dl/sdxx_2/</link><pubDate>Mon, 14 Feb 2022 12:12:13 +0800</pubDate><guid>https://yibocat.github.io/posts/dl/sdxx_2/</guid><description>&lt;p>å…¶å®æ„ŸçŸ¥æœºä¹Ÿå°±æ˜¯ä¸Šä¸€ç¯‡æ‰€è®²çš„æœ€ç®€å•çš„å•å±‚ç¥ç»ç½‘ç»œï¼Œå³ç®€å•çº¿æ€§å›å½’æ¨¡å‹ï¼Œä¹Ÿæ˜¯å±äºä¸€ä¸ªç®€å•äºŒåˆ†ç±»æˆ–å¤šåˆ†ç±»æ¨¡å‹ã€‚&lt;/p>
&lt;p style="text-align:center">&lt;img src="https://yibocat.github.io/images/dl/dl-20220214-01.png" style="zoom:16%;" />&lt;/p>
&lt;h3 id="æ¨¡å‹è®¾è®¡">æ¨¡å‹è®¾è®¡&lt;/h3>
&lt;p>å¤šå±‚æ„ŸçŸ¥æœºå°±æ˜¯åœ¨åŸæœ¬æ„ŸçŸ¥æœºçš„åŸºç¡€ä¸Šå¢åŠ äº†è‹¥å¹²å±‚éšè—å±‚ã€‚ç”±äºè¾“å…¥å±‚ä¸å‚ä¸åˆ°è®¡ç®—ï¼Œæ‰€ä»¥ä¸‹å›¾å±•ç¤ºçš„æ˜¯ä¸€ä¸ªäºŒå±‚çš„ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚&lt;/p>
&lt;p style="text-align:center">&lt;img src="https://yibocat.github.io/images/dl/dl-20220214-02.png" style="zoom:50%;" />&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥å¤šå±‚æ„ŸçŸ¥æœºåŒ…å« 5 ä¸ªéšè—å•å…ƒï¼Œå¹¶ä¸”éšè—å±‚ä¸­çš„æ¯ä¸ªå•å…ƒå’Œè¾“å…¥å±‚çš„å„ä¸ªè¾“å…¥æ˜¯å…¨è¿æ¥çš„ï¼Œè¾“å‡ºå±‚çš„ç¥ç»å…ƒå’Œéšè—å±‚ä¸­çš„å„ä¸ªå•å…ƒä¹Ÿæ˜¯å…¨è¿æ¥çš„ï¼Œæ‰€ä»¥å¤šå±‚æ„ŸçŸ¥æœºä¸­çš„éšè—å±‚å’Œè¾“å‡ºå±‚éƒ½æ˜¯å…¨è¿æ¥å±‚ã€‚&lt;/p>
&lt;/br>
&lt;p>æˆ‘ä»¬è®¾ä¸€ä¸ªå°æ‰¹é‡æ ·æœ¬ $X\in \mathbb{R}^{n\times d}$ ï¼Œæ‰¹é‡å¤§å°ä¸º $n$ ï¼Œè¾“å…¥ä¸ªæ•°ä¸º $d$ ã€‚éšè—å±‚å±‚æ•°ä¸ºä¸€å±‚ï¼Œéšå±‚å•å…ƒæ•°ä¸º $h$ ï¼Œéšè—å±‚è¾“å‡ºä¸º $H\in \mathbb{R}^{n\times h}$ ï¼ˆä¹Ÿå¯ä»¥è®°ä¸ºéšè—å±‚å˜é‡ï¼‰ã€‚&lt;/p>
&lt;p>è®¾éšè—å±‚&lt;strong>æƒé‡å‚æ•°&lt;/strong>å’Œ&lt;strong>åå·®&lt;/strong>åˆ†åˆ«ä¸º $W_h\in\mathbb{R}^{d\times h}$ å’Œ $b_h\in\mathbb{R}^{l \times h}$ï¼Œè¾“å‡ºå±‚&lt;strong>æƒé‡&lt;/strong>å’Œ&lt;strong>åå·®&lt;/strong>åˆ†åˆ«ä¸º $W_o\in\mathbb{R}^{h\times q}$ å’Œ $b_o\in\mathbb{R}^{l\times q}$ ã€‚ç”±çº¿æ€§å›å½’çš„å…¬å¼å¯ä»¥å¾—åˆ°å¤šå±‚æ„ŸçŸ¥æœºçš„è®¾è®¡æ¨¡å‹
$$
H=XW_h+b_h \newline
O=HW_o+b_o
$$
å°†ä¸¤ä¸ªå¼å­è”ç«‹èµ·æ¥ï¼Œå¯ä»¥å¾—åˆ°
$$
O = (XW_h+b_h)W_o+b_o = XW_hW_o+b_hW_o+b_o
$$
å¯ä»¥çœ‹åˆ°ï¼Œå¤šå±‚æ„ŸçŸ¥æœºçš„æ¨¡å‹å…¶å®å’Œå•å±‚ç¥ç»ç½‘ç»œæ˜¯ç­‰ä»·çš„ï¼Œåªä¸è¿‡è¾“å‡ºå±‚æƒé‡å˜æˆäº† $W_hW_o$ ï¼Œåå·®å˜æˆäº† $b_hW_o+b_o$ ã€‚&lt;/p>
&lt;h3 id="æ¿€æ´»å‡½æ•°">æ¿€æ´»å‡½æ•°&lt;/h3>
&lt;p>ç”±ä¸Šé¢çš„æ¨å¯¼æˆ‘ä»¬çŸ¥é“çº¿æ€§å˜æ¢åªæ˜¯å¯¹æ•°æ®è¿›è¡Œäº†&lt;strong>ä»¿å°„å˜æ¢(affine transformation)&lt;/strong> ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥æ ¹æ®å…¶ä»¿å°„å˜æ¢å¾—åˆ°æƒ³è¦çš„è¾“å‡ºåˆ†ç±»ï¼Œæ‰€ä»¥éœ€è¦å¼•å…¥éçº¿æ€§å˜æ¢â€”â€”&lt;strong>æ¿€æ´»å‡½æ•°&lt;/strong>ã€‚&lt;/p>
&lt;p>ç¥ç»ç½‘ç»œä¸­æœ‰å¾ˆå¤šä¸åŒçš„æ¿€æ´»å‡½æ•°&lt;/p>
&lt;/br>
&lt;p>&lt;strong>ReLUå‡½æ•°&lt;/strong>&lt;/p>
&lt;p>ReLU å‡½æ•°ï¼ˆRectified Linear Unitï¼Œä¿®æ­£çº¿æ€§å•å…ƒï¼‰ï¼Œä¹Ÿå« Rectifier å‡½æ•°ï¼Œæ˜¯ç›®å‰æ·±åº¦ç¥ç»ç½‘ç»œä¸­ç»å¸¸ä½¿ç”¨çš„æ¿€æ´»å‡½æ•°ï¼Œè¯¥å‡½æ•°å®šä¹‰ä¸º
$$
ReLU(x)=\max(0,x)
$$
å…¶å›¾åƒå¦‚ä¸‹æ‰€ç¤º&lt;/p>
&lt;p style="text-align:center">&lt;img src="https://yibocat.github.io/images/dl/dl-20220214-03.png" style="zoom:36%;border:none;"/>&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œå½“è¾“å…¥ä¸ºè´Ÿæ•°æ—¶å¯¼æ•°ä¸º 0 ï¼Œå½“è¾“å…¥ä¸ºæ­£æ•°æ—¶å¯¼æ•°ä¸º 1ã€‚&lt;/p>
&lt;/br>
&lt;p>&lt;strong>Sigmoid å‡½æ•°&lt;/strong>&lt;/p>
&lt;p>Sigmoid å‡½æ•°å¯ä»¥å°†å…ƒç´ çš„å€¼å˜æ¢åˆ° 0 å’Œ 1 ä¹‹é—´ï¼Œè¯¥å‡½æ•°å¦‚ä¸‹å®šä¹‰ï¼š
$$
Sigmoid(x) = \frac{1}{1+\exp(-x)}
$$
å…¶å›¾åƒå¦‚ä¸‹æ‰€ç¤º&lt;/p>
&lt;p style="text-align:center">&lt;img src="https://yibocat.github.io/images/dl/dl-20220214-04.png" style="zoom:36%;border:none;"/>&lt;/p>
&lt;/br>
&lt;p>&lt;strong>Tanh å‡½æ•°&lt;/strong>&lt;/p>
&lt;p>Tanh å‡½æ•°æ˜¯ä¸€ç§ Sigmoid å‹å‡½æ•°ï¼Œä¹Ÿå«åšåŒæ­£åˆ‡å‡½æ•°ï¼Œå…¶å®šä¹‰ä¸º
$$
tanh(x)=\frac{\exp(x)-\exp(-x)}{\exp(x)+\exp(-x)}
$$
Tanh å‡½æ•°å¯ä»¥çœ‹æˆæ˜¯æ”¾å¤§å¹¶å¹³ç§»çš„ Sigmoid å‡½æ•°ï¼Œå…¶å½¢çŠ¶å’Œ Sigmoid å‡½æ•°çœ‹èµ·æ¥å¾ˆåƒï¼Œä½†æ˜¯å€¼åŸŸæ˜¯ (-1,1)ã€‚&lt;/p>
&lt;p style="text-align:center">&lt;img src="https://yibocat.github.io/images/dl/dl-20220214-06.png" style="zoom:36%;border:none;"/>&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥å¯¹æ¯”ä¸€ä¸‹ Logistic å‹ Sigmoid å‡½æ•°å’Œ Tanh å‡½æ•°çš„å›¾åƒ&lt;/p>
&lt;p style="text-align:center">&lt;img src="https://yibocat.github.io/images/dl/dl-20220214-05.png" style="zoom:32%;"/>&lt;/p>
&lt;h3 id="å¤šå±‚æ„ŸçŸ¥æœºåŠ å…¥æ¿€æ´»å‡½æ•°">å¤šå±‚æ„ŸçŸ¥æœºåŠ å…¥æ¿€æ´»å‡½æ•°&lt;/h3>
&lt;p>é€šè¿‡ä¸Šæ–‡å·²ç»çŸ¥é“ï¼Œå¤šå±‚æ„ŸçŸ¥æœºå°±æ˜¯å«æœ‰è‡³å°‘ä¸€ä¸ªéšè—å±‚çš„å…¨è¿æ¥ç¥ç»ç½‘ç»œï¼Œæ¯ä¸ªéšè—å±‚çš„è¾“å‡ºç”±æ¿€æ´»å‡½æ•°è¿›è¡Œå˜æ¢ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¿€æ´»å‡½æ•°å®šä¹‰ä¸º $\phi(x)$ ï¼Œé‚£ä¹ˆå¤šå±‚æ„ŸçŸ¥æœºçš„æ¨¡å‹å¦‚ä¸‹æ‰€ç¤º
$$
H=\phi(XW_h+b_h) \newline
O=HW_o+b_o
$$
&lt;/br>&lt;/p>
&lt;h3 id="æ‰‹åŠ¨å®ç°">æ‰‹åŠ¨å®ç°&lt;/h3>
&lt;p>è¿™éƒ¨åˆ†å¯ä»¥å‚è€ƒåŸä¹¦&lt;a href="https://tangshusen.me/Dive-into-DL-PyTorch/#/chapter03_DL-basics/3.9_mlp-scratch"target="_blank" rel="noopener noreferrer">https://tangshusen.me/Dive-into-DL-PyTorch/#/chapter03_DL-basics/3.9_mlp-scratch&lt;/a>
æˆ–è€… Github &lt;a href="https://github.com/ShusenTang/Dive-into-DL-PyTorch/blob/master/code/chapter03_DL-basics/3.9_mlp-scratch.ipynb"target="_blank" rel="noopener noreferrer">https://github.com/ShusenTang/Dive-into-DL-PyTorch/blob/master/code/chapter03_DL-basics/3.9_mlp-scratch.ipynb&lt;/a>
ã€‚&lt;/p>
&lt;p>è·å–æ•°æ®å’Œè¯»å–æ•°æ®ç›´æ¥ä½¿ç”¨åŸä¹¦ä¸­æ‰€ç»™çš„ Fashion-MNIST æ•°æ®é›†ï¼Œè¿™æ˜¯ä¸€ä¸ªå›¾åƒå¤šåˆ†ç±»é—®é¢˜ï¼Œæˆ‘ä»¬å‡è®¾å°æ‰¹é‡æ•°æ®é›†çš„æ•°é‡ä¸º &lt;code>batch_size = 256&lt;/code> ï¼Œå¹¶ä¸”é€šè¿‡ &lt;code>d2l.load_data_fashion_mnist()&lt;/code> æ–¹æ³•å¾—åˆ°äº†è®­ç»ƒæ•°æ®é›†åˆæµ‹è¯•æ•°æ®é›†ï¼Œè¯¥å‡½æ•°æ˜¯åŸä¹¦ä¸­å›¾åƒå¤šåˆ†ç±»é—®é¢˜çš„è¯»å–æ•°æ®é›†çš„å‡½æ•° ã€‚ä»£ç å¦‚ä¸‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">batch_size&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">256&lt;/span>
&lt;span class="n">train_iter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">test_iter&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">d2l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">load_data_fashion_mnist&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">batch_size&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>å®šä¹‰å‚æ•°æ¨¡å‹&lt;/strong>&lt;/p>
&lt;p>åŸæ•°æ®é›†ä¸­çš„å›¾åƒå½¢çŠ¶ä¸º 28$\times$28 ï¼Œä¸€å…±æœ‰ 10 ä¸ªç±»åˆ«ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ $28\times 28=784$ å‘é‡é•¿åº¦æ¥è¡¨ç¤ºä¸€ä¸ªå›¾åƒã€‚æ‰€ä»¥ è¾“å…¥ä¸ªæ•°ä¸º 784ï¼Œè¾“å‡ºä¸ªæ•°ä¸º 10ã€‚å› ä¸ºæˆ‘ä»¬çš„æ•°æ®é›†çš„å°æ‰¹é‡æ•°æ®æ•°ä¸º 256ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¾ç½®éšè—å•å…ƒæ•°ä¸º 256ã€‚æ³¨æ„ï¼šéšè—å•å…ƒæ•°æ˜¯è¶…å‚æ•°ã€‚&lt;/p>
&lt;p>ç„¶åå¯¹å‚æ•°è¿›è¡Œåˆå§‹åŒ–ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">num_inputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_outputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_hiddens&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">784&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">256&lt;/span>
&lt;span class="n">W1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.01&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">num_inputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_hiddens&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">float&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">b1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zeros&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">num_hiddens&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">float&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">W2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.01&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">num_hiddens&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_outputs&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">float&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">b2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zeros&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">num_outputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">float&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">params&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">W1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">W2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b2&lt;/span>&lt;span class="p">]&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">param&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">params&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">param&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">requires_grad_&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requires_grad&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>å®šä¹‰æ¿€æ´»å‡½æ•°&lt;/strong>&lt;/p>
&lt;p>&lt;code>PyTorch&lt;/code> å·²ç»æœ‰äº† ReLU å‡½æ•°ï¼Œå®ç°èµ·æ¥å¾ˆç®€å•ã€‚åœ¨æ‰‹åŠ¨å®ç°æ—¶æˆ‘ä»¬æœ€å¥½è‡ªå·±å†™ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="k">def&lt;/span> &lt;span class="nf">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">max&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">input&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">other&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>å®šä¹‰æ¨¡å‹&lt;/strong>&lt;/p>
&lt;p>å®šä¹‰æ¨¡å‹çš„ç¬¬ä¸€æ­¥éœ€è¦å°†æ¯å¼ å›¾åƒçš„å½¢çŠ¶æ”¹ä¸ºé•¿åº¦ä¸º &lt;code>num_inputs&lt;/code> çš„å‘é‡ï¼Œä»¥æ–¹ä¾¿å°†å…¶å¯¼å…¥åˆ°è¾“å…¥å±‚ï¼Œç„¶åæ ¹æ®ä¸Šæ–‡ä¸­çš„è¡¨è¾¾å¼å»ºç«‹æ¨¡å‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="k">def&lt;/span> &lt;span class="nf">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="n">X&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">X&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_inputs&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="n">H&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">matmul&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">W1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">b1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">matmul&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">H&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">W2&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">b2&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>.view()&lt;/code> å‡½æ•°è¡¨ç¤ºé‡å¡‘å½¢çŠ¶ï¼Œè¿™ä¸ªå‡½æ•°å’Œ &lt;code>sklearn&lt;/code> ä¸­çš„ &lt;code>reshape()&lt;/code> çš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œè€Œ &lt;code>view(-1,1)&lt;/code> è¡¨ç¤ºé‡å¡‘æˆåˆ—å‘é‡ã€‚åŒç†ï¼Œ&lt;code>view(1,-1)&lt;/code> è¡¨ç¤ºé‡å¡‘æˆè¡Œå‘é‡ã€‚ è€Œ &lt;code>torch.matmul()&lt;/code> æ˜¯çŸ©é˜µç›¸ä¹˜æ–¹æ³•ã€‚&lt;/p>
&lt;/br>
&lt;p>&lt;strong>å®šä¹‰æŸå¤±å‡½æ•°&lt;/strong>&lt;/p>
&lt;p>æŸå¤±å‡½æ•°ç›´æ¥ä½¿ç”¨ &lt;code>PyTorch&lt;/code> ä¸­çš„äº¤å‰ç†µæŸå¤±å‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CrossEntropyLoss&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>è®­ç»ƒæ¨¡å‹&lt;/strong>&lt;/p>
&lt;p>æˆ‘ä»¬è®¾ç½®ä¸¤ä¸ªè¶…å‚æ•°ï¼Œè¿­ä»£å‘¨æœŸå’Œå­¦ä¹ ç‡ï¼Œåˆ†åˆ«ä¸º 5 å’Œ 100.0&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">num_epochs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">100.0&lt;/span>
&lt;span class="c1"># æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzhåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨&lt;/span>
&lt;span class="k">def&lt;/span> &lt;span class="nf">train_ch3&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">train_iter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">test_iter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">loss&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_epochs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">batch_size&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">params&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">optimizer&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">epoch&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">num_epochs&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="n">train_l_sum&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">train_acc_sum&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">train_iter&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">y_hat&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">l&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">loss&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">y_hat&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="c1"># æ¢¯åº¦æ¸…é›¶&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">optimizer&lt;/span> &lt;span class="ow">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="kc">None&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_grad&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">elif&lt;/span> &lt;span class="n">params&lt;/span> &lt;span class="ow">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="kc">None&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">params&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span> &lt;span class="ow">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="kc">None&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">param&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">params&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">param&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">optimizer&lt;/span> &lt;span class="ow">is&lt;/span> &lt;span class="kc">None&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">d2l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sgd&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">params&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">batch_size&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">step&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># â€œsoftmaxå›å½’çš„ç®€æ´å®ç°â€ä¸€èŠ‚å°†ç”¨åˆ°&lt;/span>
&lt;span class="n">train_l_sum&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">train_acc_sum&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">y_hat&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">argmax&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dim&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">n&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">shape&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>
&lt;span class="n">test_acc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">evaluate_accuracy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">test_iter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;epoch &lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s1">, loss &lt;/span>&lt;span class="si">%.4f&lt;/span>&lt;span class="s1">, train acc &lt;/span>&lt;span class="si">%.3f&lt;/span>&lt;span class="s1">, test acc &lt;/span>&lt;span class="si">%.3f&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>
&lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">epoch&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">train_l_sum&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">train_acc_sum&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">test_acc&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">train_ch3&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">train_iter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">test_iter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">loss&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_epochs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">batch_size&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">params&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ€åå¾—åˆ°è¾“å‡ºå¦‚ä¸‹&lt;/p>
&lt;pre tabindex="0">&lt;code>epoch 1, loss 0.0030, train acc 0.714, test acc 0.753
epoch 2, loss 0.0019, train acc 0.821, test acc 0.777
epoch 3, loss 0.0017, train acc 0.842, test acc 0.834
epoch 4, loss 0.0015, train acc 0.857, test acc 0.839
epoch 5, loss 0.0014, train acc 0.865, test acc 0.845
&lt;/code>&lt;/pre>&lt;/br>
&lt;p>å…¨éƒ¨æ‰‹å·¥å®ç°å¤šå±‚æ„ŸçŸ¥æœºå¦‚ä¸Šæ‰€ç¤ºï¼Œä½†æ˜¯è¿™æ ·æ‰‹åŠ¨å®ç°å…¶å®å¾ˆå®¹æ˜“å‡ºç°é”™è¯¯ï¼Œä¸”æ•ˆç‡ä¸é«˜ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code>PyTorch&lt;/code> æ›´ç®€æ´åœ°å®ç°å¤šå±‚æ„ŸçŸ¥æœºã€‚&lt;/p>
&lt;/br>
&lt;h3 id="ç®€æ´å®ç°">ç®€æ´å®ç°&lt;/h3>
&lt;p>&lt;strong>æ¨¡å‹å®šä¹‰&lt;/strong>&lt;/p>
&lt;p>æ¨¡å‹å®šä¹‰å¯ä»¥ç›´æ¥ä½¿ç”¨ &lt;code>PyTorch&lt;/code> ä¸­çš„ &lt;code>nn.Sequential&lt;/code> æ¥å®ç°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">num_inputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_outputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_hiddens&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">784&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">256&lt;/span>
&lt;span class="n">net&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Sequential&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="n">d2l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">FlattenLayer&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">num_inputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_hiddens&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="c1"># è¾“å…¥å±‚&lt;/span>
&lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ReLU&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="c1"># æ¿€æ´»å‡½æ•°&lt;/span>
&lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">num_hiddens&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_outputs&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="c1"># è¾“å‡ºå±‚&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">params&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parameters&lt;/span>&lt;span class="p">():&lt;/span> &lt;span class="c1"># åˆå§‹åŒ–å‚æ•°&lt;/span>
&lt;span class="n">init&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normal_&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">params&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">mean&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">0.01&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¨¡å‹ä»ä¸Šå¾€ä¸‹ä¸ºè¾“å…¥å±‚ï¼Œæ¿€æ´»å‡½æ•°ï¼Œè¾“å‡ºå±‚ã€‚&lt;/p>
&lt;/br>
&lt;p>&lt;strong>è¯»å–æ•°æ®è®­ç»ƒæ¨¡å‹&lt;/strong>&lt;/p>
&lt;p>è¿™é‡Œä¼˜åŒ–ç›´æ¥ä½¿ç”¨ &lt;code>Pytorch&lt;/code> ä¸­çš„ &lt;code>SGD&lt;/code> æ¢¯åº¦ä¸‹é™ç®—æ³•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">batch_size&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">256&lt;/span> &lt;span class="c1"># å°æ‰¹é‡å¤§å°\éšè—å•å…ƒæ•°é‡&lt;/span>
&lt;span class="n">train_iter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">test_iter&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">d2l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">load_data_fashion_mnist&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">batch_size&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># è¯»å–æ•°æ®&lt;/span>
&lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CrossEntropyLoss&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># æŸå¤±å‡½æ•°&lt;/span>
&lt;span class="n">optimizer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">optim&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SGD&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parameters&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">0.5&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># ä¼˜åŒ–æ–¹æ³•&lt;/span>
&lt;span class="n">num_epochs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="c1"># è¿­ä»£å‘¨æœŸ&lt;/span>
&lt;span class="n">train_ch3&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">train_iter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">test_iter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">loss&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_epochs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">batch_size&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">None&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">None&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">optimizer&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1"># è®­ç»ƒæ¨¡å‹&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ€åè¾“å‡º&lt;/p>
&lt;pre tabindex="0">&lt;code>epoch 1, loss 0.0030, train acc 0.712, test acc 0.744
epoch 2, loss 0.0019, train acc 0.823, test acc 0.821
epoch 3, loss 0.0017, train acc 0.844, test acc 0.842
epoch 4, loss 0.0015, train acc 0.856, test acc 0.842
epoch 5, loss 0.0014, train acc 0.864, test acc 0.818
&lt;/code>&lt;/pre>&lt;/br>
&lt;h3 id="å‚è€ƒ">å‚è€ƒ&lt;/h3>
&lt;p>&lt;a href="https://tangshusen.me/Dive-into-DL-PyTorch/#/"target="_blank" rel="noopener noreferrer">ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹PyTorch ç‰ˆ&lt;/a>
&lt;/p>
&lt;p>&lt;a href="https://nndl.github.io"target="_blank" rel="noopener noreferrer">ã€Šç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ ã€‹é‚±é”¡é¹æ•™æˆ&lt;/a>
&lt;/p></description></item><item><title>[æ·±åº¦å­¦ä¹ ç¬”è®°] æ·±åº¦å­¦ä¹ ç¬¬ 1 ç¯‡â€”â€”ç®€å•çº¿æ€§å›å½’</title><link>https://yibocat.github.io/posts/dl/sdxx_1/</link><pubDate>Tue, 08 Feb 2022 22:06:10 +0800</pubDate><guid>https://yibocat.github.io/posts/dl/sdxx_1/</guid><description>&lt;p>çº¿æ€§æ¨¡å‹ï¼ˆLinear Modelï¼‰æ˜¯æœºå™¨å­¦ä¹ ä¸­åº”ç”¨æœ€å¹¿æ³›çš„æ¨¡å‹ï¼ŒæŒ‡é€šè¿‡æ ·æœ¬ç‰¹å¾çš„çº¿æ€§ç»„åˆæ¥è¿›è¡Œé¢„æµ‹çš„æ¨¡å‹ã€‚çº¿æ€§å›å½’æ˜¯å•å±‚ç¥ç»ç½‘ç»œï¼Œå…¶æ¶‰åŠçš„æ¦‚å¿µå’ŒæŠ€æœ¯é€‚ç”¨äºå¤§å¤šæ•°æ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="çº¿æ€§å›å½’">çº¿æ€§å›å½’&lt;/h3>
&lt;p>&lt;strong>æ¨¡å‹å®šä¹‰&lt;/strong>&lt;/p>
&lt;p>ç»™å®šä¸€ä¸ª $ D $ ç»´æ ·æœ¬ $ x=[x_1,x_2,\cdots,x_D]^T $ å…¶çº¿æ€§ç»„åˆå‡½æ•°ä¸º
$$
f(x;\omega)=\omega^Tx+b
$$
æˆ‘ä»¬è¯´ $ \omega $ æ˜¯ä¸€ä¸ªæƒé‡çŸ©é˜µï¼ˆå¯ä»¥ç†è§£ä¸ºæ–œç‡ï¼‰ï¼Œ $ b $ ä¸ºåå·®ï¼ˆå¯ä»¥ç†è§£ä¸ºæˆªè·ï¼‰ï¼Œå…¶å‡ä¸ºæ ‡é‡ã€‚è¿™ä¸¤ä¸ªå‚æ•°ç§°ä¸ºçº¿æ€§å›å½’æ¨¡å‹çš„å‚æ•°ï¼Œè€Œæˆ‘ä»¬çš„ç›®çš„å°±æ˜¯é€šè¿‡è®­ç»ƒæ¨¡å‹ï¼Œå¾—åˆ°æœ€ä½³çš„å‚æ•°ä¼°è®¡ã€‚&lt;/p>
&lt;/br>
&lt;p>&lt;strong>æŸå¤±å‡½æ•°&lt;/strong>&lt;/p>
&lt;p>æ¨¡å‹è®­ç»ƒå‡ºçš„é¢„æµ‹å€¼é€šå¸¸éœ€è¦å’ŒçœŸå®å€¼è¿›è¡Œæ¯”å¯¹ï¼Œè¿™ç§æ¯”å¯¹ä¹Ÿå°±æ˜¯&lt;strong>è¯¯å·®&lt;/strong>ã€‚åœ¨æœºå™¨å­¦ä¹ é‡ŒæŠŠè¡¡é‡è¯¯å·®çš„å‡½æ•°ç§°ä¸º&lt;strong>æŸå¤±å‡½æ•°ï¼ˆloss functionï¼‰&lt;/strong>ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å¹³æ–¹è¯¯å·®å‡½æ•°ï¼Œå•ä¸ªæ ·æœ¬çš„å¹³æ–¹æŸå¤±å‡½æ•°å¯ä»¥å¦‚ä¸‹è¡¨ç¤º
$$
l^{(i)}(\omega,b) = \frac{1}{2}(\hat{y}-y)^2
$$
è¿™é‡Œ $ \hat{y} $ è¡¨ç¤ºè®­ç»ƒçš„é¢„æµ‹å€¼ï¼Œ$ y $ è¡¨ç¤ºçœŸå®å€¼ï¼Œ$ \frac{1}{2} $ æ˜¯ä¸ºäº†åœ¨æ±‚å¯¼æ—¶æ–¹ä¾¿åŒ–ç®€ã€‚è®­ç»ƒé›†ä¸­æ‰€æœ‰æ ·æœ¬çš„è¯¯å·®çš„å¹³å‡æ¥è¡¡é‡æ¨¡å‹é¢„æµ‹çš„è´¨é‡ï¼Œå³
$$
l(\omega,b)=\frac{1}{n}\sum_{i=1}^nl^{(i)}(\omega,b)
$$
æ­£å¦‚ä¸Šæ–‡æåˆ°çš„ï¼Œæ·±åº¦å­¦ä¹ çš„ä»»åŠ¡å°±æ˜¯æ‰¾åˆ°ä¸€ç»„æ¨¡å‹å‚æ•°ï¼Œä½¿å¾—è®­ç»ƒæ ·æœ¬çš„æŸå¤±æœ€å°ã€‚&lt;/p>
&lt;/br>
&lt;p>&lt;strong>ç®—æ³•ä¼˜åŒ–&lt;/strong>&lt;/p>
&lt;p>æ±‚è§£æ•°å€¼è§£çš„ä¼˜åŒ–ç®—æ³•ä¸­ï¼Œ&lt;strong>å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™æ³•ï¼ˆmini-batch stochastic gradient descent&lt;/strong> åœ¨æ·±åº¦å­¦ä¹ ä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å½“æ¨¡å‹å’ŒæŸå¤±å‡½æ•°å½¢å¼è¾ƒä¸ºç®€å•æ—¶ï¼Œä¸Šé¢çš„è¯¯å·®æœ€å°åŒ–é—®é¢˜çš„è§£å¯ä»¥ç›´æ¥ç”¨å…¬å¼è¡¨è¾¾å‡ºæ¥ã€‚è¿™ç±»è§£å«ä½œè§£æè§£ï¼ˆanalytical solutionï¼‰ã€‚æœ¬èŠ‚ä½¿ç”¨çš„çº¿æ€§å›å½’å’Œå¹³æ–¹è¯¯å·®åˆšå¥½å±äºè¿™ä¸ªèŒƒç•´ã€‚ç„¶è€Œï¼Œå¤§å¤šæ•°æ·±åº¦å­¦ä¹ æ¨¡å‹å¹¶æ²¡æœ‰è§£æè§£ï¼Œåªèƒ½é€šè¿‡ä¼˜åŒ–ç®—æ³•æœ‰é™æ¬¡è¿­ä»£æ¨¡å‹å‚æ•°æ¥å°½å¯èƒ½é™ä½æŸå¤±å‡½æ•°çš„å€¼ã€‚è¿™ç±»è§£å«ä½œæ•°å€¼è§£ï¼ˆnumerical solutionï¼‰ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>åœ¨çº¿æ€§å›å½’æ¨¡å‹ä¸­ï¼Œæ¨¡å‹çš„æ¯ä¸ªå‚æ•°çš„è¿­ä»£å¦‚ä¸‹æ‰€ç¤º:
$$
\omega \gets \omega-\frac{\eta}{|\mathcal{B}|}\sum_{i\in\mathcal{B}}\frac{\partial l^{(i)}(\omega,b)}{\partial \omega} \newline
b\gets b-\frac{\eta}{|\mathcal{B}|}\sum_{i\in\mathcal{B}}\frac{\partial l^{(i)}(\omega,b)}{\partial b}
$$
è¿™é‡Œ $ |\mathcal{B}| $ è¡¨ç¤ºæ¯ä¸ªå°æ‰¹é‡çš„æ ·æœ¬ä¸ªæ•°ï¼Œ$\eta$ ä¸ºå­¦ä¹ ç‡ã€‚è€Œè¿™é‡Œçš„å°æ‰¹é‡æ ·æœ¬æ•°å’Œå­¦ä¹ ç‡æ˜¯äººä¸ºè®¾å®šçš„è€Œä¸æ˜¯å­¦ä¹ å¾—æ¥çš„ï¼Œæ‰€ä»¥è¢«ç§°ä¸ºè¶…å‚æ•°ï¼ˆhyperparameterï¼‰ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="çº¿æ€§å›å½’å®ç°">çº¿æ€§å›å½’å®ç°&lt;/h3>
&lt;/br>
&lt;p>çº¿æ€§å›å½’çš„å®ç°æ€»ä½“ä¸Šåˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š&lt;/p>
&lt;ol>
&lt;li>æ•°æ®é›†çš„å‡†å¤‡&lt;/li>
&lt;li>åˆå§‹åŒ–æ¨¡å‹å‚æ•°&lt;/li>
&lt;li>å®šä¹‰æ¨¡å‹&lt;/li>
&lt;li>å®šä¹‰æŸå¤±å‡½æ•°&lt;/li>
&lt;li>å®šä¹‰ä¼˜åŒ–ç®—æ³•ã€&lt;/li>
&lt;li>è®­ç»ƒæ¨¡å‹&lt;/li>
&lt;/ol>
&lt;p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”Ÿæˆç‰¹å¾æ ‡ç­¾çš„æ•£ç‚¹å›¾ï¼Œè¿™æ ·å¯ä»¥æ›´ç›´æ¥åœ°è§‚å¯Ÿä¸¤è€…é—´çš„çº¿æ€§å…³ç³»ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="k">def&lt;/span> &lt;span class="nf">use_svg_display&lt;/span>&lt;span class="p">():&lt;/span>
&lt;span class="c1"># ç”¨çŸ¢é‡å›¾æ˜¾ç¤º&lt;/span>
&lt;span class="n">display&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">set_matplotlib_formats&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;svg&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">def&lt;/span> &lt;span class="nf">set_figsize&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">figsize&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">3.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">2.5&lt;/span>&lt;span class="p">)):&lt;/span>
&lt;span class="n">use_svg_display&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="c1"># è®¾ç½®å›¾çš„å°ºå¯¸&lt;/span>
&lt;span class="n">plt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rcParams&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;figure.figsize&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">figsize&lt;/span>
&lt;span class="c1">#æ‰“å°æ•£ç‚¹å›¾&lt;/span>
&lt;span class="n">set_figsize&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">plt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">scatter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">features&lt;/span>&lt;span class="p">[:,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">numpy&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">numpy&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>è¯»å–æ•°æ®&lt;/strong>&lt;/p>
&lt;p>è®­ç»ƒæ¨¡å‹çš„æ—¶å€™éœ€è¦ä¸æ–­è¯»å–å°æ‰¹é‡æ•°æ®æ ·æœ¬ï¼Œæ‰€ä»¥å¯ä»¥å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥è¿”å›å°æ‰¹é‡çš„éšæœºæ ·æœ¬çš„ç‰¹å¾å’Œæ ‡ç­¾&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="k">def&lt;/span> &lt;span class="nf">data_iter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">batch_size&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">features&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="c1"># batch_size è¡¨ç¤ºæ‰¹é‡å¤§å°&lt;/span>
&lt;span class="n">num_examples&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">features&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">indices&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">num_examples&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">shuffle&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">indices&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># æ ·æœ¬çš„è¯»å–é¡ºåºæ˜¯éšæœºçš„&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_examples&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">batch_size&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="n">j&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">LongTensor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">indices&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">min&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">batch_size&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_examples&lt;/span>&lt;span class="p">)])&lt;/span> &lt;span class="c1"># æœ€åä¸€æ¬¡å¯èƒ½ä¸è¶³ä¸€ä¸ªbatch&lt;/span>
&lt;span class="k">yield&lt;/span> &lt;span class="n">features&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">index_select&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">j&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">index_select&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">j&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">batch_size&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">data_iter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">batch_size&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">features&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="c1"># æ‰“å°&lt;/span>
&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">break&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>åˆå§‹åŒ–æ¨¡å‹å‚æ•°&lt;/strong>&lt;/p>
&lt;p>æƒé‡åˆå§‹åŒ–æˆå‡å€¼ä¸º 0 ï¼Œæ ‡å‡†å·®ä¸º 0.01 çš„æ­£å¤ªéšæœºæ•°ï¼Œåå·®åˆå§‹åŒ–ä¸º 0ã€‚ç„¶åå› ä¸ºå‚æ•°éœ€è¦æ±‚æ¢¯åº¦æ¥è¿­ä»£ï¼Œæ‰€ä»¥è®¾ç½® &lt;code>requires_grad=True&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">w&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.01&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">num_inputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">float32&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zeros&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">float32&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">w&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">requires_grad_&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requires_grad&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">b&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">requires_grad_&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requires_grad&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>å®šä¹‰æ¨¡å‹&lt;/strong>&lt;/p>
&lt;p>æˆ‘ä»¬å·²ç»çŸ¥é“äº†çº¿æ€§å›å½’çš„æ¨¡å‹è¡¨è¾¾å¼ï¼Œä½¿ç”¨ &lt;code>torch.mm&lt;/code> è¿›è¡ŒçŸ©é˜µä¹˜æ³•è¿ç®—&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="k">def&lt;/span> &lt;span class="nf">linreg&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mm&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">w&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">b&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>å®šä¹‰æŸå¤±å‡½æ•°&lt;/strong>&lt;/p>
&lt;p>æŸå¤±å‡½æ•°æˆ‘ä»¬ä½¿ç”¨å¹³æ–¹æŸå¤±å‡½æ•°ã€‚æ³¨æ„ï¼šç”±äº $\hat{y}-y$ ä¸­ï¼Œ$\hat{y}$ å’Œ $y$ çš„å½¢çŠ¶æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ &lt;code>y.view&lt;/code> å°† $y$ çš„å½¢çŠ¶å˜æˆé¢„æµ‹å€¼ $\hat{y}$ çš„å½¢çŠ¶ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="k">def&lt;/span> &lt;span class="nf">squared_loss&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">y_hat&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="c1"># æ³¨æ„è¿™é‡Œè¿”å›çš„æ˜¯å‘é‡, å¦å¤–, pytorché‡Œçš„MSELosså¹¶æ²¡æœ‰é™¤ä»¥ 2&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">y_hat&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">y_hat&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">()))&lt;/span> &lt;span class="o">**&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>å®šä¹‰ä¼˜åŒ–ç®—æ³•&lt;/strong>&lt;/p>
&lt;p>ä¼˜åŒ–ç®—æ³•æ ¹æ®ä¸Šæ–‡æåˆ°çš„ä½¿ç”¨å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ç®—æ³•ï¼Œå…¶é€šè¿‡ä¸æ–­è¿­ä»£æ¨¡å‹å‚æ•°æ¥ä¼˜åŒ–æŸå¤±å‡½æ•°ã€‚è¿™é‡Œ &lt;code>lr&lt;/code> ä¸ºè¿­ä»£æ­¥é•¿ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="k">def&lt;/span> &lt;span class="nf">sgd&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">params&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">batch_size&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">param&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">params&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">param&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span> &lt;span class="o">-=&lt;/span> &lt;span class="n">lr&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">param&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">batch_size&lt;/span> &lt;span class="c1"># æ³¨æ„è¿™é‡Œæ›´æ”¹paramæ—¶ç”¨çš„param.data&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>è®­ç»ƒæ¨¡å‹&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">lr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mf">0.03&lt;/span> &lt;span class="c1"># è¿­ä»£æ­¥é•¿&lt;/span>
&lt;span class="n">num_epochs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="c1"># è¿­ä»£å‘¨æœŸ&lt;/span>
&lt;span class="n">net&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">linreg&lt;/span> &lt;span class="c1"># ä½¿ç”¨çº¿æ€§æ¨¡å‹&lt;/span>
&lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">squared_loss&lt;/span> &lt;span class="c1"># æŸå¤±å‡½æ•°&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">epoch&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">num_epochs&lt;/span>&lt;span class="p">):&lt;/span> &lt;span class="c1"># è®­ç»ƒæ¨¡å‹ä¸€å…±éœ€è¦num_epochsä¸ªè¿­ä»£å‘¨æœŸ&lt;/span>
&lt;span class="c1"># åœ¨æ¯ä¸€ä¸ªè¿­ä»£å‘¨æœŸä¸­ï¼Œä¼šä½¿ç”¨è®­ç»ƒæ•°æ®é›†ä¸­æ‰€æœ‰æ ·æœ¬ä¸€æ¬¡ï¼ˆå‡è®¾æ ·æœ¬æ•°èƒ½å¤Ÿè¢«æ‰¹é‡å¤§å°æ•´é™¤ï¼‰ã€‚X&lt;/span>
&lt;span class="c1"># å’Œyåˆ†åˆ«æ˜¯å°æ‰¹é‡æ ·æœ¬çš„ç‰¹å¾å’Œæ ‡ç­¾&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">data_iter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">batch_size&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">features&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="n">l&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">loss&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># læ˜¯æœ‰å…³å°æ‰¹é‡Xå’Œyçš„æŸå¤±&lt;/span>
&lt;span class="n">l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># å°æ‰¹é‡çš„æŸå¤±å¯¹æ¨¡å‹å‚æ•°æ±‚æ¢¯åº¦&lt;/span>
&lt;span class="n">sgd&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="n">w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">batch_size&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># ä½¿ç”¨å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™è¿­ä»£æ¨¡å‹å‚æ•°&lt;/span>
&lt;span class="c1"># ä¸è¦å¿˜äº†æ¢¯åº¦æ¸…é›¶&lt;/span>
&lt;span class="n">w&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">b&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">train_l&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">loss&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">features&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;epoch &lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s1">, loss &lt;/span>&lt;span class="si">%f&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">epoch&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">train_l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mean&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()))&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œæˆ‘ä»¬è®¾ç½®è¿­ä»£æ­¥é•¿ä¸º 0.03ï¼Œè¿­ä»£å‘¨æœŸä¸º 3ï¼Œæ¯æ¬¡è¿­ä»£å‘¨æœŸä¸­éƒ½ä¼šé€šè¿‡ &lt;code>data_iter&lt;/code> è¯»å–å°æ‰¹é‡æ•°æ®æ ·æœ¬ï¼Œç„¶åè®¾ç½®æŸå¤±å‡½æ•°æ—¶ï¼Œç”±äº &lt;code>l&lt;/code> å¹¶ä¸æ˜¯æ ‡é‡ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡ &lt;code>sum()&lt;/code> æ–¹æ³•æ±‚å’Œå¾—åˆ°æ ‡é‡ï¼Œå†ä½¿ç”¨ &lt;code>l.backward()&lt;/code> å¾—åˆ°æ¨¡å‹å‚æ•°çš„æ¢¯åº¦ï¼Œç„¶åä½¿ç”¨å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™æ³•è¿­ä»£æ¨¡å‹å‚æ•°ã€‚æ³¨æ„ï¼šæ¯æ¬¡è¿­ä»£å®Œéœ€è¦å¯¹æ¢¯åº¦æ¸…é›¶ã€‚&lt;/p>
&lt;/br>
&lt;p>ä»¥ä¸Šå°±æ˜¯å…¨äººå·¥å®ç°äº†ä¸€ä¸ªç®€å•çš„çº¿æ€§å›å½’æ¨¡å‹ã€‚å½“ç„¶ï¼Œ&lt;code>PyTorch&lt;/code> æä¾›äº†ç®€ä¾¿çš„æ¨¡å‹æ„é€ æ–¹æ³•å’Œå¤šç§æŸå¤±å‡½æ•°ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="çº¿æ€§å›å½’ç®€æ´å®ç°">çº¿æ€§å›å½’ç®€æ´å®ç°&lt;/h3>
&lt;/br>
&lt;p>&lt;strong>è¯»å–æ•°æ®&lt;/strong>&lt;/p>
&lt;p>&lt;code>PyTorch&lt;/code> æä¾›äº† &lt;code>data&lt;/code> åŒ…è¯»å–æ•°æ®ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.utils.data&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">Data&lt;/span>
&lt;span class="n">batch_size&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;span class="c1"># å°†è®­ç»ƒæ•°æ®çš„ç‰¹å¾å’Œæ ‡ç­¾ç»„åˆ&lt;/span>
&lt;span class="n">dataset&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">TensorDataset&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">features&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1"># éšæœºè¯»å–å°æ‰¹é‡&lt;/span>
&lt;span class="n">data_iter&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DataLoader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dataset&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">batch_size&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">shuffle&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">data_iter&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="c1"># æ‰“å°&lt;/span>
&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">break&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>å®šä¹‰æ¨¡å‹&lt;/strong>&lt;/p>
&lt;p>&lt;code>PyTorch&lt;/code> æä¾›äº†å¤§é‡é¢„å®šä¹‰çš„å±‚ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥å¾ˆç®€æ´çš„å®ç°æ¨¡å‹çš„æ„é€ ã€‚&lt;/p>
&lt;p>å¯¼å…¥ &lt;code>torch.nn&lt;/code> æ¨¡å—ï¼Œ&lt;code>nn&lt;/code>çš„æ ¸å¿ƒæ•°æ®ç»“æ„æ˜¯ &lt;code>Module&lt;/code> ã€‚&lt;code>Module&lt;/code> æ˜¯ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œæ—¢å¯ä»¥è¡¨ç¤ºä¸€ä¸ªå±‚ï¼Œåˆå¯ä»¥è¡¨ç¤ºä¸€ä¸ªå¾ˆå¤šå±‚çš„ç¥ç»ç½‘ç»œï¼Œå…¶å®å®ƒæœ¬èº«å°±æ˜¯æ‰€æœ‰å±‚çš„ä¸€ä¸ªåŸºç±»ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="k">class&lt;/span> &lt;span class="nc">LinearNet&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Module&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="k">def&lt;/span> &lt;span class="fm">__init__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n_feature&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="nb">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">LinearNet&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="fm">__init__&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">linear&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n_feature&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1"># forward å®šä¹‰å‰å‘ä¼ æ’­&lt;/span>
&lt;span class="k">def&lt;/span> &lt;span class="nf">forward&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="n">y&lt;/span>
&lt;span class="n">net&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">LinearNet&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">num_inputs&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># ä½¿ç”¨printå¯ä»¥æ‰“å°å‡ºç½‘ç»œçš„ç»“æ„&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>forward()&lt;/code> å®šä¹‰äº†æ¨¡å‹çš„å‰å‘ä¼ æ’­è®¡ç®—æ–¹å¼ã€‚&lt;/p>
&lt;p>å…¶å® &lt;code>PyTorch&lt;/code> è¿˜æœ‰æ›´åŠ ç®€ä¾¿çš„ç½‘ç»œæ­å»ºæ–¹æ³•ï¼Œå¦‚ &lt;code>nn.Sequential&lt;/code>, è¿™é‡Œä¸å†èµ˜è¿°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">net&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Sequential&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">num_inputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1"># æ­¤å¤„è¿˜å¯ä»¥ä¼ å…¥å…¶ä»–å±‚&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>åˆå§‹åŒ–æ¨¡å‹å‚æ•°&lt;/strong>&lt;/p>
&lt;p>&lt;code>PyTorch&lt;/code> åœ¨ &lt;code>init&lt;/code> æ¨¡å—ä¸­æä¾›äº†å¾ˆå¤šå‚æ•°åˆå§‹åŒ–çš„æ–¹æ³•ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡ &lt;code>init.normal_&lt;/code> å°†æƒé‡å‚æ•°æ¯ä¸ªå…ƒç´ åˆå§‹åŒ–ä¸ºéšæœºé‡‡æ ·äºå‡å€¼ä¸º0ã€æ ‡å‡†å·®ä¸º0.01çš„æ­£æ€åˆ†å¸ƒï¼Œåå·®ä¼šåˆå§‹åŒ–ä¸ºé›¶ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="kn">from&lt;/span> &lt;span class="nn">torch.nn&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">init&lt;/span>
&lt;span class="n">init&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normal_&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">weight&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">mean&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">0.01&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">init&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">constant_&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">bias&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">val&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹biasçš„data: net[0].bias.data.fill_(0)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>å®šä¹‰æŸå¤±å‡½æ•°&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">MSELoss&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>å®šä¹‰ä¼˜åŒ–ç®—æ³•&lt;/strong>&lt;/p>
&lt;p>&lt;code>torch.optim&lt;/code>æ¨¡å—æä¾›äº†å¾ˆå¤šå¸¸ç”¨çš„ä¼˜åŒ–ç®—æ³•æ¯”å¦‚SGDã€Adamå’ŒRMSPropç­‰ï¼Œæ‰€ä»¥ä¸ç”¨å†è‡ªå·±å®ç°å°æ‰¹é‡æ¢¯åº¦ä¸‹é™ç®—æ³•äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.optim&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">optim&lt;/span>
&lt;span class="n">optimizer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">optim&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SGD&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parameters&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">0.03&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">optimizer&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¾“å‡ºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">SGD&lt;/span> &lt;span class="p">(&lt;/span>
&lt;span class="n">Parameter&lt;/span> &lt;span class="n">Group&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;span class="n">dampening&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;span class="n">lr&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">0.03&lt;/span>
&lt;span class="n">momentum&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;span class="n">nesterov&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">False&lt;/span>
&lt;span class="n">weight_decay&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>&lt;strong>è®­ç»ƒæ¨¡å‹&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">num_epochs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">3&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">epoch&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_epochs&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">data_iter&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">output&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">l&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">loss&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">output&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_grad&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># æ¢¯åº¦æ¸…é›¶ï¼Œç­‰ä»·äºnet.zero_grad()&lt;/span>
&lt;span class="n">l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">step&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;epoch &lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s1">, loss: &lt;/span>&lt;span class="si">%f&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">epoch&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()))&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/br>
&lt;p>ä»¥ä¸Šå°±æ˜¯å…³äºç®€å•çº¿æ€§æ¨¡å‹çš„å®ç°ï¼ŒåŒ…æ‹¬æ‰€æœ‰ä»£ç çš„æ‰‹å·¥å®ç°ä»¥åŠä½¿ç”¨ &lt;code>PyTorch&lt;/code> æä¾›çš„æ¨¡å—çš„å®ç°ã€‚å†…å®¹åŸºæœ¬ä¸Šéƒ½æ˜¯æ ¹æ®ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹ï¼ˆPyTorchç‰ˆï¼‰æ¥ç¼–å†™çš„ï¼Œä»£ç ä¹Ÿæ˜¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåº”è¯¥å°½å¯èƒ½é‡‡ç”¨çŸ¢é‡è®¡ç®—ï¼Œä»¥æå‡è®¡ç®—æ•ˆç‡ã€‚&lt;code>torch.utils.data&lt;/code>æ¨¡å—æä¾›äº†æœ‰å…³æ•°æ®å¤„ç†çš„å·¥å…·ï¼Œ&lt;code>torch.nn&lt;/code>æ¨¡å—å®šä¹‰äº†å¤§é‡ç¥ç»ç½‘ç»œçš„å±‚ï¼Œ&lt;code>torch.nn.init&lt;/code>æ¨¡å—å®šä¹‰äº†å„ç§åˆå§‹åŒ–æ–¹æ³•ï¼Œ&lt;code>torch.optim&lt;/code>æ¨¡å—æä¾›äº†å¾ˆå¤šå¸¸ç”¨çš„ä¼˜åŒ–ç®—æ³•ã€‚&lt;/p>
&lt;/br>
&lt;h3 id="å‚è€ƒ">å‚è€ƒ&lt;/h3>
&lt;p>&lt;a href="https://tangshusen.me/Dive-into-DL-PyTorch/#/chapter03_DL-basics/3.1_linear-regression"target="_blank" rel="noopener noreferrer">ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹(PyTorch)&lt;/a>
&lt;/p></description></item><item><title>[Python ç¬”è®°æœ¬] è¿œç¨‹æ­å»º jupyter æœåŠ¡å™¨</title><link>https://yibocat.github.io/posts/fwq/fwq_jupyter/</link><pubDate>Wed, 02 Feb 2022 21:47:35 +0800</pubDate><guid>https://yibocat.github.io/posts/fwq/fwq_jupyter/</guid><description>&lt;p>æœ¬æ–‡é€šè¿‡æ­å»ºä¸€ä¸ªç®€å•çš„è¿œç¨‹ &lt;code>Jupyter&lt;/code> æœåŠ¡ç«¯ï¼Œå¯ä»¥å®ç°ä¸åˆ†åœºåˆä¸æ—¶é—´è¿è¡Œä»£ç ï¼Œæˆ–è€…è¯´æ˜¯å±•ç¤ºä»£ç ï¼Œè¿™æä¾›äº†æå¤§çš„æ–¹ä¾¿ã€‚&lt;/p>
&lt;h3 id="æ­å»º-jupyter-æœåŠ¡å™¨">æ­å»º &lt;code>Jupyter&lt;/code> æœåŠ¡å™¨&lt;/h3>
&lt;p>&lt;code>ssh&lt;/code> è¿œç¨‹ç™»å½•æœåŠ¡å™¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">ssh root@xxx.xxx.xxx.xxx
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸‹è½½å¹¶å®‰è£… &lt;code>miniconda&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3-latest-Linux-x86_64.sh
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åè®¾ç½®è™šæ‹Ÿ &lt;code>conda&lt;/code> ç¯å¢ƒï¼Œè¿™é‡Œæˆ‘ä»¬çš„ç¯å¢ƒä½¿ç”¨ &lt;code>python 3.9&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">conda create -n myenvname &lt;span class="nv">python&lt;/span>&lt;span class="o">=&lt;/span>3.9
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ‡æ¢ç¯å¢ƒä¸åœç”¨ç¯å¢ƒ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">conda activate myenvname
conda deactivate
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å®‰è£…-jupyter-å’Œé…ç½®">å®‰è£… &lt;code>Jupyter&lt;/code> å’Œé…ç½®&lt;/h3>
&lt;p>å®‰è£… &lt;code>jupyter&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">conda install -c conda-forge jupyterlab
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”Ÿæˆé…ç½®æ–‡ä»¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">jupyter notebook --generate-config
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿›å…¥ &lt;code>IPython&lt;/code> ï¼Œè®¾ç½®è®°ä½å“ˆå¸Œå¯†ç ï¼ˆè¿™é‡Œä¼šå°†ç™»å½•å¯†ç è½¬æ¢ä¸ºå“ˆå¸Œå¯†ç ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">Ipython
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">In&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]:&lt;/span> &lt;span class="kn">from&lt;/span> &lt;span class="nn">notebook.auth&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">passwd&lt;/span>
&lt;span class="n">In&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]:&lt;/span> &lt;span class="n">passwd&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">Enter&lt;/span> &lt;span class="n">password&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">Verify&lt;/span> &lt;span class="n">password&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">Out&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]:&lt;/span> &lt;span class="s1">&amp;#39;argon2:$argon2id$v=19$m=10240,t=10,p=8$1Hk7hXkmqH0KUC3JswHy8A$W2Ya&amp;#39;&lt;/span>
&lt;span class="n">In&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">]:&lt;/span> &lt;span class="n">exit&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶">ä¿®æ”¹é…ç½®æ–‡ä»¶&lt;/h3>
&lt;p>é€šè¿‡ FTP ç™»å½•åˆ°æœåŠ¡å™¨ï¼Œæ‰¾åˆ°é…ç½®æ–‡ä»¶ &lt;code>jupyter_notebook_config.py&lt;/code> ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹åˆ°æ–‡ä»¶æœ«å°¾&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">NotebookApp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">password&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sa">u&lt;/span>&lt;span class="s1">&amp;#39;argon2:$argon2id$v=19$m=10240,t=10,p=8$1Hk7hXkmqH0KUC3JswHy8A$W2Ya&amp;#39;&lt;/span>
&lt;span class="c1">#å°±æ˜¯åˆšæ‰éœ€è¦è®°ä¸‹çš„å“ˆå¸Œå¯†ç &lt;/span>
&lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">NotebookApp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">port&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">9999&lt;/span>
&lt;span class="c1">#æŒ‡å®šjupyter lab è¿è¡Œç«¯å£ï¼Œå†™ä¸€ä¸ªä¸å†²çªçš„ç«¯å£å³å¯ &lt;/span>
&lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">NotebookApp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">allow_remote_access&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">True&lt;/span>
&lt;span class="c1"># å…è®¸è¿œç¨‹è®¿é—® &lt;/span>
&lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">NotebookApp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ip&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;*&amp;#39;&lt;/span>
&lt;span class="c1"># å°±æ˜¯è®¾ç½®æ‰€æœ‰ipçš†å¯è®¿é—® &lt;/span>
&lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">NotebookApp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">open_browser&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">False&lt;/span>
&lt;span class="c1"># ç¦æ­¢è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ &lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>æ³¨æ„ï¼šè¿™é‡Œéœ€è¦å°†ç«¯å£æ”¾è¡Œï¼Œå¦åˆ™æ— æ³•è¿æ¥ç™»å½•&lt;/p>
&lt;/blockquote>
&lt;h3 id="æœåŠ¡å™¨å¼€å¯-jupyterlab">æœåŠ¡å™¨å¼€å¯ &lt;code>Jupyterlab&lt;/code>&lt;/h3>
&lt;p>è¾“å…¥ä»£ç æ‰“å¼€ &lt;code>Jupyterlab&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">jupyter lab --allow-root
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ­¤æ—¶å·²ç»å¯ä»¥åœ¨æµè§ˆå™¨ä¸ŠæŸ¥çœ‹è¿œç¨‹ &lt;code>Jupyterlab&lt;/code> äº†ï¼Œä½†æ˜¯å½“å…³é—­ç»ˆç«¯æ—¶ &lt;code>Jupyter&lt;/code> ä¹Ÿä¼šç›¸åº”å…³é—­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®© &lt;code>Jupyter&lt;/code> ä¿æŒåœ¨åå°è¿è¡Œ&lt;/p>
&lt;p>åå°è¿è¡Œï¼Œå¹¶å°†æ ‡å‡†è¾“å‡ºå†™å…¥åˆ° &lt;code>jupyter.log&lt;/code> ä¸­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">nohup jupyter notebook --allow-root &amp;gt; jupyter.log 2&amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="p">&amp;amp;&lt;/span>
nohup jupyter lab --allow-root &amp;gt; jupyter.log 2&amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="p">&amp;amp;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>nobup&lt;/code> è¡¨ç¤º &lt;code>no hang up&lt;/code>ï¼Œå°±æ˜¯ä¸æŒ‚èµ·ï¼Œé€€å‡ºç»ˆç«¯åä¾ç„¶å¯ä»¥è¿è¡Œã€‚&lt;/p>
&lt;p>ç„¶åæ‰¾åˆ° &lt;code>jupyter&lt;/code> è¿›ç¨‹ï¼Œç»ˆæ­¢è¯¥è¿›ç¨‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">ps -a
&lt;span class="nb">kill&lt;/span> -9 pid
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æµè§ˆå™¨ä¸­è¾“å…¥ &lt;code>xxx.xxx.xxx.xxx:9999&lt;/code> è¿›å…¥ &lt;code>jupyter notebook&lt;/code>&lt;/p>
&lt;p>æµè§ˆå™¨ä¸­è¾“å…¥ &lt;code>xxx.xxx.xxx.xxx:9999/lab&lt;/code> è¿›å…¥ &lt;code>jupyterlab&lt;/code>&lt;/p>
&lt;h3 id="æ—¥å¸¸ç™»é™†-jupyter-åŠæœåŠ¡å™¨æ“ä½œ">æ—¥å¸¸ç™»é™† &lt;code>Jupyter&lt;/code> åŠæœåŠ¡å™¨æ“ä½œ&lt;/h3>
&lt;p>è¿œç¨‹ç™»å½•æœåŠ¡å™¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">ssh root@xxx.xxx.xxx.xxx
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ‡æ¢ç¯å¢ƒ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">conda activate myenvname
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿è¡Œ &lt;code>jupyterlab&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">jupyter lab --allow-root
&lt;/code>&lt;/pre>&lt;/div>&lt;p>éæŒ‚èµ·è¿è¡Œ &lt;code>JupyterLab&lt;/code> ï¼ˆå¯å…³é—­ç»ˆç«¯ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">nohup jupyter notebook --allow-root &amp;gt; jupyter.log 2&amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="p">&amp;amp;&lt;/span>
nohup jupyter lab --allow-root &amp;gt; jupyter.log 2&amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="p">&amp;amp;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŸ¥çœ‹è¿è¡Œè¿›ç¨‹ï¼Œå¹¶æ€æ­»è¿›ç¨‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">ps -a
&lt;span class="nb">kill&lt;/span> &lt;span class="m">1000&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æµè§ˆå™¨ä¸­è¾“å…¥ &lt;code>xxx.xxx.xxx.xxx:9999&lt;/code> è¿›å…¥ &lt;code>jupyter notebook&lt;/code>&lt;/p>
&lt;p>æµè§ˆå™¨ä¸­è¾“å…¥ &lt;code>xxx.xxx.xxx.xxx:9999/lab&lt;/code> è¿›å…¥ &lt;code>jupyterlab&lt;/code>&lt;/p></description></item><item><title>[Git æ—¥è®°] Git å¿½ç•¥ .DS_Store ä¸å…¨å±€å¿½ç•¥</title><link>https://yibocat.github.io/posts/git/git_ignore/</link><pubDate>Tue, 01 Feb 2022 10:53:07 +0800</pubDate><guid>https://yibocat.github.io/posts/git/git_ignore/</guid><description>&lt;p>Mac OS çš„æ¯ä¸ªæ–‡ä»¶å¤¹ä¸‹éƒ½æœ‰ä¸€ä¸ªéšè—æ–‡ä»¶ .DS_Storeï¼Œè¯¥æ–‡ä»¶ä¿å­˜çš„æ˜¯å½“å‰æ–‡ä»¶å¤¹çš„å±æ€§ï¼Œå¦‚å›¾æ ‡ä½ç½®ã€èƒŒæ™¯ç­‰ã€‚&lt;/p>
&lt;p>ä½†æ˜¯æ¯æ¬¡ä½¿ç”¨ Git æäº¤æ›´æ”¹æ—¶ï¼Œéƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆ .DS_Store æ›´æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡æäº¤åˆ°ç‰ˆæœ¬åº“å’Œ &lt;code>push&lt;/code> åˆ° Github æ€»æ˜¯å¾ˆéº»çƒ¦ã€‚æ‰€ä»¥ .DS_Store æ˜¯æ²¡æœ‰å¿…è¦æäº¤åˆ°ç‰ˆæœ¬åº“çš„ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨ git.gitignore æ¥å¿½ç•¥æ­¤ç±»æ–‡ä»¶ã€‚&lt;/p>
&lt;h3 id="å¿½ç•¥å½“å‰ç›®å½•ä¸‹çš„-ds_store">å¿½ç•¥å½“å‰ç›®å½•ä¸‹çš„ .DS_Store&lt;/h3>
&lt;p>æˆ‘ä»¬åœ¨æ‰€è¦å¿½ç•¥ .DS_Store çš„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª &lt;code>.gitignore&lt;/code> æ–‡ä»¶ï¼Œç„¶åå°†è¦å¿½ç•¥çš„æ–‡ä»¶åå†™å…¥è¿›å»&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">touch .gitignore
&lt;/code>&lt;/pre>&lt;/div>&lt;p style="text-align:center">&lt;img src="https://yibocat.github.io/images/git/git-20220201-1.png" style="width:90%" />&lt;/p>
&lt;p>æ¯æ¬¡å¿½ç•¥ä»»ä½•æ–‡ä»¶åªéœ€å°†è¦å¿½ç•¥çš„æ–‡ä»¶æ·»åŠ åˆ° &lt;code>.gitignore&lt;/code> æ–‡ä»¶å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;p>ä½†æ˜¯æ¯æ¬¡æ›´æ”¹å®Œ &lt;code>.gitignore&lt;/code> æ–‡ä»¶ä¹‹åï¼Œéƒ½éœ€è¦è¿è¡Œä»¥ä¸‹ä»£ç ï¼Œå¦åˆ™ &lt;code>.gitignore&lt;/code> æ˜¯ä¸ç”Ÿæ•ˆçš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">git rm -r --cached .
git add .
git commit -m &lt;span class="s1">&amp;#39;update .gitignore&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="git-å…¨å±€å¿½ç•¥">git å…¨å±€å¿½ç•¥&lt;/h3>
&lt;p>é¦–å…ˆåœ¨ç»ˆç«¯è¾“å…¥å¦‚ä¸‹ä»£ç æŸ¥çœ‹ git ç°æœ‰çš„å…¨å±€é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">git config --list
&lt;/code>&lt;/pre>&lt;/div>&lt;p>git å…¨å±€é…ç½®éƒ½åœ¨ä¸€ä¸ª &lt;code>.gitconfig&lt;/code> æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ git å…¨å±€é…ç½®è¿›è¡Œå…¨å±€å¿½ç•¥ .DS_Store ã€‚&lt;/p>
&lt;p>å…·ä½“æ­¥éª¤æ˜¯åœ¨æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª &lt;code>.gitignore_global&lt;/code> æ–‡ä»¶ï¼ŒæŠŠè¦å¿½ç•¥çš„æ–‡ä»¶ç›´æ¥æ·»åŠ åˆ°è¯¥æ–‡ä»¶ä¸­ï¼Œå’Œä¸Šæ–‡ä¸­çš„å½“å‰ç›®å½•æ·»åŠ æ˜¯ä¸€æ ·çš„&lt;/p>
&lt;p>ç„¶ååœ¨ç»ˆç«¯è¾“å…¥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">git config --global core.excludesfile/Users/reon/.gitignore_global
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…ç›´æ¥åœ¨ &lt;code>.gitconfig&lt;/code> ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="o">[&lt;/span>core&lt;span class="o">]&lt;/span>
&lt;span class="nv">excludefile&lt;/span> &lt;span class="o">=&lt;/span> /Users/xiaqunfeng/.gitignore_global
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å‚è€ƒ">å‚è€ƒ&lt;/h3>
&lt;ol>
&lt;li>&lt;a href="http://xiaqunfeng.cc/2018/04/24/git-ignore-ds-store/#%E5%88%A0%E9%99%A4github%E4%B8%8A%E6%96%87%E4%BB%B6"target="_blank" rel="noopener noreferrer">http://xiaqunfeng.cc/2018/04/24/git-ignore-ds-store/#%E5%88%A0%E9%99%A4github%E4%B8%8A%E6%96%87%E4%BB%B6&lt;/a>
&lt;/li>
&lt;li>&lt;a href="https://blog.csdn.net/allanGold/article/details/73132606"target="_blank" rel="noopener noreferrer">https://blog.csdn.net/allanGold/article/details/73132606&lt;/a>
&lt;/li>
&lt;/ol></description></item><item><title>[å»ºç«™æ—¥è®°] Hugoä»£ç æ‹·è´æ’ä»¶</title><link>https://yibocat.github.io/posts/jzrj/jzrj_2/</link><pubDate>Sun, 30 Jan 2022 17:26:21 +0800</pubDate><guid>https://yibocat.github.io/posts/jzrj/jzrj_2/</guid><description>&lt;p>åšå®¢æ˜¯å»ºå¥½äº†ï¼Œä½†æ˜¯æ€»æ˜¯æƒ³æ·»åŠ ä¸€ä¸ªä»£ç ä¸€é”®å¤åˆ¶çš„åŠŸèƒ½ã€‚ä¸€å¼€å§‹æ˜¯æƒ³å» html æ ‡ç­¾ä¸­ç›´æ¥æ·»åŠ ä¸€ä¸ª &lt;code>button&lt;/code> ï¼Œä½†æ˜¯å‘ç°å¥½åƒå¹¶æ²¡æœ‰é‚£ä¹ˆç®€å•ã€‚æŸ¥é˜…äº† Hugo çš„å†…ç½®åŠŸèƒ½ä¹Ÿæ²¡æœ‰å‘ç°ï¼Œå¾ˆå¹¸è¿æ‰¾åˆ°äº†ä¸€ç¯‡åšå®¢ &lt;a href="https://huangzhongde.cn/"target="_blank" rel="noopener noreferrer">é»„å¿ å¾·çš„åšå®¢&lt;/a>
ï¼Œæ­£å¥½è§£å†³äº†æˆ‘çš„éœ€æ±‚ã€‚æ‰€ä»¥ä¹Ÿè®°å½•ä¸€ä¸‹ã€‚&lt;/p>
&lt;h3 id="æ€è€ƒ">æ€è€ƒ&lt;/h3>
&lt;p>æˆ‘ä»¬çŸ¥é“ï¼Œä»£ç ç‰‡æ®µæ˜¯ä½¿ç”¨ markdown code fences æ¥ç¼–å†™çš„&lt;/p>
&lt;pre tabindex="0">&lt;code>``` jsx
import React from 'react';
```
&lt;/code>&lt;/pre>&lt;p>ä»¥ä¸Šä»£ç åœ¨ Hugo ç¼–è¯‘ä¸‹çš„ Html å°†å±•ç¤ºæˆå¦‚ä¸‹å½¢å¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;highlight&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">pre&lt;/span> &lt;span class="na">style&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;background-color:#f0f0f0;tab-size:4&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">code&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;language-jsx&amp;#34;&lt;/span> &lt;span class="na">data-lang&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;jsx&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">span&lt;/span> &lt;span class="na">style&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;color:#007020;font-weight:bold&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>import&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">span&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> React from &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">span&lt;/span> &lt;span class="na">style&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;color:#4070a0&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&amp;#39;react&amp;#39;&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">span&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>;
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">code&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">pre&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>æœç´¢æ‰€æœ‰çªå‡ºæ˜¾ç¤ºçš„ä»£ç å—ï¼Œç‰¹åˆ«æ˜¯æ‰€æœ‰å…·æœ‰ç±» &lt;code>highlight&lt;/code> çš„å…ƒç´ ï¼›&lt;/strong>&lt;/li>
&lt;li>&lt;strong>å¦‚ä½•åˆ›å»ºæŒ‰é’®æ”¾åœ¨ä»£ç æ¡†ä¸­ï¼›&lt;/strong>&lt;/li>
&lt;li>&lt;strong>ç»™æŒ‰é’®æ·»åŠ ä¸€ä¸ªäº‹ä»¶ï¼Œç”¨äºå°†ä»£ç å—ä¸­çš„ä»£ç å¤åˆ¶åˆ°å‰ªè´´æ¿ã€‚&lt;/strong>&lt;/li>
&lt;/ol>
&lt;h3 id="ä»£ç ">ä»£ç &lt;/h3>
&lt;h4 id="æ£€æŸ¥å¤åˆ¶æ”¯æŒ">æ£€æŸ¥å¤åˆ¶æ”¯æŒ&lt;/h4>
&lt;p>è¿›è¡Œå¤åˆ¶ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å¯¹æµè§ˆå™¨æ˜¯å¦å¯ä»¥ä½¿ç”¨ &lt;code>document.execCommand('copy')&lt;/code> è¿™ä¸ªåŠŸèƒ½ï¼Œå› ä¸ºè¿™æ®µä»£ç æ­£æ˜¯æˆ‘ä»¬è¦ä½¿ç”¨çš„å¤åˆ¶è°ƒç”¨ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‘½ä»¤æ¥æ£€æŸ¥ä¸€ä¸‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">queryCommandSupported&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;copy&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½†æ˜¯ &lt;code>queryCommandSupported&lt;/code> æ–¹æ³•ä¼¼ä¹å·²ç»å¼ƒç”¨ï¼Œæ‰€ä»¥å…¶å®æ˜¯ä¸ç”¨æ·»åŠ çš„ã€‚&lt;/p>
&lt;img src="https://yibocat.github.io/images/jzrj/jzrj-20220129-20.png" alt="jzrj-20220129-20" style="zoom:50%;" />
&lt;h4 id="é€‰æ‹©çªå‡ºæ˜¾ç¤ºçš„ä»£ç å—">é€‰æ‹©çªå‡ºæ˜¾ç¤ºçš„ä»£ç å—&lt;/h4>
&lt;p>ä¸Šæ–‡æåˆ°ï¼Œçªå‡ºæ˜¾ç¤ºçš„ä»£ç å—æ˜¯åŒ…å«åœ¨ç±» &lt;code>highlight&lt;/code> ä¸­çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å†…ç½®çš„ DOM API æ¥æ£€æŸ¥æ‰€æœ‰çš„åœ¨ &lt;code>highlight&lt;/code> å†…å®¹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="kd">var&lt;/span> &lt;span class="nx">highlightBlocks&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getElementsByClassName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;highlight&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ·»åŠ æŒ‰é’®">æ·»åŠ æŒ‰é’®&lt;/h4>
&lt;p>ç”±äº Hugo çš„è‡ªåŠ¨ç¼–è¯‘ä½¿å¾—æˆ‘ä»¬æ— æ³•ç›´æ¥åœ¨ html ä¸­æ·»åŠ æŒ‰é’®ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä¸€å¼€å§‹çš„ç–‘é—®ä¹‹å¤„ã€‚ä½†æ˜¯å¯ä»¥ä½¿ç”¨ js åˆ›å»ºä¸€ä¸ªç‰¹å®šçš„å‡½æ•°æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ç„¶ååœ¨ &lt;code>for&lt;/code> å¾ªç¯ä¸­è°ƒç”¨è¿™ä¸ªå‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="kd">function&lt;/span> &lt;span class="nx">addCopyButton&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">containerEl&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">copyBtn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">createElement&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;button&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nx">copyBtn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">className&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;highlight-copy-btn&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="nx">copyBtn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">textContent&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;Copy&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="nx">containerEl&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">appendChild&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">copyBtn&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kd">var&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="nx">highlightBlocks&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">length&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">addCopyButton&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">highlightBlocks&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">]);&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å¤åˆ¶å“åº”">å¤åˆ¶å“åº”&lt;/h4>
&lt;p>ç‚¹å‡»æŒ‰é’®ï¼Œä½¿ç”¨ &lt;code>document.execCommand()&lt;/code> æ–¹æ³•å°†ä»£ç å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼ŒåŒæ—¶è¿˜è¦ä¿æŒä»£ç çš„æ ¼å¼ã€‚æ‰€ä»¥åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥é€‰æ‹©ç»™å®šçš„ html ä¸­çš„æ‰€æœ‰æ–‡æœ¬&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="kd">function&lt;/span> &lt;span class="nx">selectText&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">node&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">selection&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getSelection&lt;/span>&lt;span class="p">();&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">range&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">createRange&lt;/span>&lt;span class="p">();&lt;/span>
&lt;span class="nx">range&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">selectNodeContents&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">node&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nx">selection&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">removeAllRanges&lt;/span>&lt;span class="p">();&lt;/span>
&lt;span class="nx">selection&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">addRange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">range&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">selection&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å› ä¸ºä»£ç èŠ‚ç‚¹æ˜¯åœ¨ &lt;code> &amp;lt;pre&amp;gt;&lt;/code> æ‰€ä»¥ä½¿ç”¨ &lt;code>.firstElementChild&lt;/code> æ¥è·å–èŠ‚ç‚¹ï¼Œé€‰æ‹©æ–‡æœ¬åæ·»åŠ åˆ°å‰ªè´´æ¿ï¼Œç„¶ååˆ é™¤æ‰€æœ‰é€‰æ‹©&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="kd">var&lt;/span> &lt;span class="nx">codeEl&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">containerEl&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">firstElementChild&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="nx">copyBtn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">addEventListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;click&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">selection&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">selectText&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">codeEl&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">execCommand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;copy&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nx">selection&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">removeAllRanges&lt;/span>&lt;span class="p">();&lt;/span>
&lt;span class="p">});&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ·»åŠ æ ·å¼">æ·»åŠ æ ·å¼&lt;/h4>
&lt;p>è¿™éƒ¨åˆ†æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œç›´æ¥æ”¾ä»£ç äº†ï¼Œä¹‹åå¯ä»¥è‡ªå·±è°ƒè¯•ä»£ç æŒ‰é’®æ ·å¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-css" data-lang="css">&lt;span class="p">.&lt;/span>&lt;span class="nc">highlight&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">position&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">relative&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">.&lt;/span>&lt;span class="nc">highlight&lt;/span> &lt;span class="nt">pre&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">padding-right&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">75&lt;/span>&lt;span class="kt">px&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">.&lt;/span>&lt;span class="nc">highlight-copy-btn&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">position&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">absolute&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">top&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">7&lt;/span>&lt;span class="kt">px&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">right&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">7&lt;/span>&lt;span class="kt">px&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">border&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">border-radius&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="kt">px&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">padding&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="kt">px&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">font-size&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">0.7&lt;/span>&lt;span class="kt">em&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">line-height&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">1.8&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">color&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">#fff&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">background-color&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">#777&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">min-width&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">55&lt;/span>&lt;span class="kt">px&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">text-align&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">center&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">.&lt;/span>&lt;span class="nc">highlight-copy-btn&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nd">hover&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">background-color&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">#666&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ä»£ç æ¡†çš„å³ä¸Šæ–¹æ·»åŠ äº†ä¸€ä¸ªç°è‰²çš„æŒ‰é’®ã€‚&lt;/p>
&lt;h4 id="å·²å¤åˆ¶å“åº”">å·²å¤åˆ¶å“åº”&lt;/h4>
&lt;p>æ‰€æœ‰åŠŸèƒ½å…¶å®éƒ½å·²ç»å®Œæˆäº†ï¼Œä¸ºäº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œåœ¨ç‚¹å‡»æŒ‰é’®åéœ€è¦æœ‰ä¸€ä¸ªå·²å¤åˆ¶çš„å“åº”è¿”å›ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="kd">function&lt;/span> &lt;span class="nx">flashCopyMessage&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">el&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">msg&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">el&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">textContent&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">msg&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="nx">setTimeout&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">el&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">textContent&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;Copy&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">},&lt;/span> &lt;span class="mi">1000&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">selection&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">selectText&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">codeEl&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">execCommand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;copy&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nx">selection&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">removeAllRanges&lt;/span>&lt;span class="p">();&lt;/span>
&lt;span class="nx">flashCopyMessage&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">copyBtn&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;Copied!&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">e&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">console&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">e&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nx">flashCopyMessage&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">copyBtn&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;Failed :\&amp;#39;(&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ‰€æœ‰ä»£ç ">æ‰€æœ‰ä»£ç &lt;/h3>
&lt;p>&lt;code>copy-to-clipboard.css&lt;/code> :&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-css" data-lang="css">&lt;span class="p">.&lt;/span>&lt;span class="nc">highlight&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">position&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">relative&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">.&lt;/span>&lt;span class="nc">highlight&lt;/span> &lt;span class="nt">pre&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">padding-right&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">75&lt;/span>&lt;span class="kt">px&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">.&lt;/span>&lt;span class="nc">highlight-copy-btn&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">position&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">absolute&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">top&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">7&lt;/span>&lt;span class="kt">px&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">right&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">7&lt;/span>&lt;span class="kt">px&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">border&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">border-radius&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="kt">px&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">padding&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="kt">px&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">font-size&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">0.7&lt;/span>&lt;span class="kt">em&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">line-height&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">1.8&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">color&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">#fff&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">background-color&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">#777&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">min-width&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">55&lt;/span>&lt;span class="kt">px&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">text-align&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">center&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">.&lt;/span>&lt;span class="nc">highlight-copy-btn&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nd">hover&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">background-color&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">#666&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>copy-to-clipboard.js&lt;/code> :&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="p">(&lt;/span>&lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="s1">&amp;#39;use strict&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">queryCommandSupported&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;copy&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">function&lt;/span> &lt;span class="nx">flashCopyMessage&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">el&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">msg&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">el&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">textContent&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">msg&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="nx">setTimeout&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">el&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">textContent&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;Copy&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">},&lt;/span> &lt;span class="mi">1000&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">function&lt;/span> &lt;span class="nx">selectText&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">node&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">selection&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getSelection&lt;/span>&lt;span class="p">();&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">range&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">createRange&lt;/span>&lt;span class="p">();&lt;/span>
&lt;span class="nx">range&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">selectNodeContents&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">node&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nx">selection&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">removeAllRanges&lt;/span>&lt;span class="p">();&lt;/span>
&lt;span class="nx">selection&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">addRange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">range&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">selection&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">function&lt;/span> &lt;span class="nx">addCopyButton&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">containerEl&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">copyBtn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">createElement&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;button&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nx">copyBtn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">className&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;highlight-copy-btn&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="nx">copyBtn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">textContent&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;Copy&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">codeEl&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">containerEl&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">firstElementChild&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="nx">copyBtn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">addEventListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;click&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">selection&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">selectText&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">codeEl&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">execCommand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;copy&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nx">selection&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">removeAllRanges&lt;/span>&lt;span class="p">();&lt;/span>
&lt;span class="nx">flashCopyMessage&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">copyBtn&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;Copied!&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">e&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">console&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">e&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nx">flashCopyMessage&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">copyBtn&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;Failed :\&amp;#39;(&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">});&lt;/span>
&lt;span class="nx">containerEl&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">appendChild&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">copyBtn&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// Add copy button to code blocks
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="kd">var&lt;/span> &lt;span class="nx">highlightBlocks&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getElementsByClassName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;highlight&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nb">Array&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">prototype&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">forEach&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">highlightBlocks&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">addCopyButton&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="p">})();&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å°†è¿™ä¸¤ä¸ªæ–‡ä»¶åˆ†åˆ«æ”¾åœ¨ &lt;code>assets/css&lt;/code> å’Œ &lt;code>assets/js&lt;/code> ä¸‹ï¼Œç„¶ååœ¨é…ç½®æ–‡ä»¶ &lt;code>config.toml&lt;/code> ä¸­ä¿®æ”¹è‡ªå®šä¹‰ css å’Œ jsï¼Œæˆ–è€…æ‰‹åŠ¨æ·»åŠ åˆ° &lt;code>head.html&lt;/code> å¤´æ–‡ä»¶ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="nx">custom_css&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;css/copy-to-clipboard.css&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;span class="nx">custom_js&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;js/copy-to-clipboard.js&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å‚è€ƒ">å‚è€ƒ&lt;/h3>
&lt;ol>
&lt;li>&lt;a href="https://huangzhongde.cn/post/2020-02-21-hugo-code-copy-to-clipboard/"target="_blank" rel="noopener noreferrer">https://huangzhongde.cn/post/2020-02-21-hugo-code-copy-to-clipboard/&lt;/a>
&lt;/li>
&lt;li>&lt;a href="https://www.tomspencer.dev/blog/2018/09/14/adding-click-to-copy-buttons-to-a-hugo-powered-blog/"target="_blank" rel="noopener noreferrer">https://www.tomspencer.dev/blog/2018/09/14/adding-click-to-copy-buttons-to-a-hugo-powered-blog/&lt;/a>
&lt;/li>
&lt;/ol></description></item></channel></rss>