{{ define "main"}}

<h1>{{ .Title }}</h1>

{{- $pages := where site.RegularPages "Type" "in" site.Params.mainSections }}

{{- if .Site.Params.ShowAllPagesInArchive }}
{{- $pages = site.RegularPages }}
{{- end }}

{{ range $pages.GroupByPublishDate "2006" }}

{{ if ne .Key "0001" }}
  <div class="archives-year">
    <h2 class="archive-year-header">
        {{ replace .Key "0001" "" }}<sup class="archive-count">&nbsp;&nbsp;{{ len .Pages }}</sup>
    </h2>
    {{ range .Pages.GroupByDate "January" }}
        <div class="archive-month">
            <h3 class="archive-month-header">{{- .Key }}<sup class="archive-count">&nbsp;&nbsp;{{ len .Pages }}</sup></h3>
            <div class="archive-posts">
                {{ range .Pages }}
                {{ if eq .Kind "page" }}
                    <a class="archive-entry" href="{{ .Permalink }}">
                        <h3 class="archive-entry-title">
                            {{ .Title | markdownify }}
                            {{ if .Draft }}<sup><span class="entry-isdraft">&nbsp;&nbsp;[draft]</span></sup>{{- end }} 
                        </h3>
                        <div class="archive-meta">
                            {{ partial "article-meta.html" . -}}
                        </div>
                    </a>
                {{ end }}
                {{ end }}
            </div>
        </div>
    {{ end }}
  </div>
{{ end }}

{{ end }}
{{ end }}
